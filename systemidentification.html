

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>System Identification &mdash; Human Control of a Bicycle: Jason K. Moore</title>
    
    <link rel="stylesheet" href="_static/haiku.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="_static/print.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '',
        VERSION:     '1.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/javascript" src="_static/theme_extras.js"></script>
    <link rel="top" title="Human Control of a Bicycle: Jason K. Moore" href="index.html" />
    <link rel="next" title="References" href="zreferences.html" />
    <link rel="prev" title="Control" href="control.html" />
 

<!-- Google Scholar metadata -->
<meta name="citation_title" content="Human Control of a Bicycle"/>
<meta name="citation_author" content="Moore, Jason Keith"/>
<meta name="resource_type" content="Dissertation"/>
<meta name="citation_dissertation_institution" content="University of California, Davis"/>
<meta name="citation_publication_date" content="2012/08/21"/>
<meta name="citation_pdf_url" content="http://mae.ucdavis.edu/~biosport/jkm/dissertation/HumanControlofaBicycle.pdf"/>

<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-15966419-5']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>

  </head>
  <body>
      <div class="header"><h1 class="heading"><a href="index.html">
          <span>Human Control of a Bicycle: Jason K. Moore</span></a></h1>
        <h2 class="heading"><span>System Identification</span></h2>
      </div>
      <div class="topnav">
      
        <p>
        «&#160;&#160;<a href="control.html">Control</a>
        &#160;&#160;::&#160;&#160;
        <a class="uplink" href="index.html">Contents</a>
        &#160;&#160;::&#160;&#160;
        <a href="zreferences.html">References</a>&#160;&#160;»
        </p>

      </div>
      <div class="content">
        
        

  <div class="section" id="system-identification">
<span id="systemidentification"></span><h1>System Identification<a class="headerlink" href="#system-identification" title="Permalink to this headline">¶</a></h1>
<div class="section" id="preface">
<h2>Preface<a class="headerlink" href="#preface" title="Permalink to this headline">¶</a></h2>
<p>I started to think about system identification when I arrived at Delft and the
discussions began with Arend and Jodi. I hadn&#8217;t much clue about the formal
field and theory of system identification. My first look at it was when Arend
presented me with a light introduction by Ljung, so I credit Arend and his
cohorts for the ideas that have been implemented in this chapter. We talked
about it here and there but never really put together a solid experimental plan
to do anything about it. Karl Åström visited us in Delft in late 2008 and we
talked some with him about system identification of the bicycle. I mainly recall
him focusing on how to excite the system in a very controlled manner with an
oscillating mass on the bicycle. Some of these ideas propagated through Arend
to Peter and can be seen in the final sections of his thesis <a class="reference internal" href="zreferences.html#lange2011">[DL11]</a>. Many
of these ideas influenced our NSF proposal and ultimately the final portion of
what I was to do for my dissertation work.</p>
<p>Once I had gotten back to Davis we now had the resources available from NSF
funding to make something happen. My goal had basically formalized into
creating a instrumented bicycle to be controlled by a person that was capable of
measuring all of the kinematics and kinetics involved in regulated control
tasks. We also originally had hoped to be able to vary the dynamics of the
bicycle, but the reduced funding nixed that idea. It took some time into the
project to really understand what we might be able to accomplish with that but it
finally materialized into validating Ron&#8217;s theoretic control model which is
discussed in <a class="reference internal" href="zreferences.html#hess2012">[HMH12]</a> and Chapter <a class="reference internal" href="control.html#control"><em>Control</em></a> with data collected via the
instrumented bicycle. After our first experiments, over a year into the project
timeline it became apparent that simple tasks with measured lateral
perturbations would provide the best chance of validating his model.
Unfortunately, I had not thought a great deal about how to provide and measure
these lateral perturbations but the manually excited perturbations seemed to do
the trick.</p>
<p>We ran a lot of preliminary system identification analyses on the first set of
trial data, but it quickly became apparent that we had little understanding of
the subject. The early analyses did give confidence that the data was of good
enough quality to do something with, but our goal of identifying the parameters
of the controller were still far from our reach.</p>
<p>We performed the final set of experiments around August and September of 2011
to get a large sample of data for the final analyses. The NSF grant was to end
at the end of September and I still had to figure out how to analyze all of
the data, not to mention write up a ton of work for my dissertation. We ended
up extending the NSF grant another year (as seems to be typical with these
things). I look back to our original proposal and in hindsight the scope was
way too large (accurately predicted by Arend). We nixed the handling qualities
parts when the funding was lowered, but I now see that what we hoped to do
really took another 6-12 months longer than we had intended.</p>
<p>The final analyses have forced me to figure out what system identification is
all about and I&#8217;ve learned a great deal rapidly and much on my own. At this
stage we weren&#8217;t able to find any local experts on the subject to help us along
but I&#8217;ve gotten some great insight from both the single track vehicle dynamics
email list and from personal communication with Karl Åström. I still feel
very weak in the subject but it is more clear how difficult identifying complex
systems is, especially trying to nail down physical parameters.</p>
<p>As many doctoral students probably hope when starting their long trek to the
PhD, I hoped for some grand findings to arise from this work. But I&#8217;ve been
humbled a lot in that quest. I present here the work I&#8217;ve done with regards to
identifying the bicycle and rider system with what I think are good results,
but I hope that it can be a guide for others to see some of the difficulties
in executing this kind of analysis with some ideas to better structure it.</p>
</div>
<div class="section" id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h2>
<p>The work presented in this Chapter is intended to be the icing on the cake that
takes into account all of the theory presented in the previous chapters and
evaluates it with a large set of data taken with the instrumented bicycle
described in Chapter <a class="reference internal" href="davisbicycle.html#davisbicycle"><em>Davis Instrumented Bicycle</em></a>. It is also the overarching
deliverable I was responsible for under the NSF grant. This chapter details
system identification of a bicycle and rider system. It is broken in two main
parts, the first goal being to identify the passive bicycle rider system and
the second to identify the active portion, i.e. the rider&#8217;s control system. The
literature review gives an introduction to other&#8217;s efforts in both these
analyses with respect to single track vehicles.</p>
<p>Two important concepts need to be mentioned briefly before proceeding. The
first is a review of the terms used to categorize model structures in the
system identification field: white box, black box, and grey box. System
identification is the process of identifying a model that best predicts a
particular input/output relationship. If we develop a model entirely from first
principles<a class="footnote-reference" href="#firstprinciples" id="id3">[1]</a>, e.g. using Newton&#8217;s laws to describe the
motion of an object, when all of the parameters and states are known then this
is called a white box model because we know everything about it a priori. The
second case, the black box model, describes a model in which one only knows the
structure, i.e. order, of the underlying equations but all the coefficients are
unknown. Finally, the grey box model falls in between the first two in that one
may have more knowledge of the structure of the coefficients based on first
principles, e.g. one may know that some model coefficients are zero or that
the model may be parameterized by some known and some unknown physical
characteristics.</p>
<p>The second concept regards the notion of process and measurement noise in a
dynamic system. Dynamic systems have states that evolve dynamically through
time, but a real system has elements that are not purely deterministic which
are typically called noise. The noise can be broken up into the  process noise,
the noise due to errors in, or random inputs into, the model, and the
measurement noise, the noise due to errors in the measurements. The ability to
characterize these two types of noise plays a large role in the accurate
identification of dynamic systems.</p>
</div>
<div class="section" id="literature">
<h2>Literature<a class="headerlink" href="#literature" title="Permalink to this headline">¶</a></h2>
<p>There is a rich history of bicycle and motorcycle mathematical model
development. This has been able to explain many of the more dynamically
fascinating phenomena, from countersteering and stability to speedman’s wobble
and gyroscopic effects. But the amount of experimental validation of these
idealized models pales in comparison, with the motorcycle experimentation
outdistancing that done with bicycles.</p>
<p>Basic bicycle and motorcycle identification is typically done on data collected
by exciting the vehicle through force/torque perturbations in either roll or
steer. These experiments can be done when the bicycle is under closed loop
control or when the bicycle is stable, the former being a requirement for
speeds outside of the stable speed range. But, the mode excitation methods are
limited to the frequency band around that mode of motion. Manual excitation
under closed loop control gives better excitation bandwidth and a pairing with
modern system identification techniques can provide richer models.</p>
<div class="section" id="passive-vehicle-and-rider-identification">
<h3>Passive Vehicle and Rider Identification<a class="headerlink" href="#passive-vehicle-and-rider-identification" title="Permalink to this headline">¶</a></h3>
<p>Identification of passive, open loop vehicle-rider models is more prevalent
than the identification of the controller. It is indeed a requirement to have a
very good vehicle model before attempting to identify the control system a
human employs while controlling the system. The bicycle and motorcycle are
excellent choices for manual control experiment design due to the fact that
they are relatively economical systems that require a broad range of human
control skills to stabilize and direct the vehicle, but they have the
disadvantage that first principles models are somewhat more difficult to
develop and have smaller pool of prior research as say cars or aircraft. The
approaches to identifying the passive model include mode excitation techniques
to system identification under more general inputs.</p>
<div class="section" id="calspan">
<h4>CALSPAN<a class="headerlink" href="#calspan" title="Permalink to this headline">¶</a></h4>
<p>The earliest comprehensive bicycle model validation began at CALSPAN in the
late 60’s. This included several revolutionary studies, in one of which they
made use of a rocket to apply know step torques to an uncontrolled riderless
bicycle. In another, simulations of slalom maneuvers were visually compared
with video footage <a class="reference internal" href="zreferences.html#roland1971">[RM71]</a>.</p>
</div>
<div class="section" id="eaton">
<h4>Eaton<a class="headerlink" href="#eaton" title="Permalink to this headline">¶</a></h4>
<p>David Eaton&#8217;s work (<a class="reference internal" href="zreferences.html#eaton1973">[Eat73b]</a>, <a class="reference internal" href="zreferences.html#eaton1973a">[Eat73a]</a>, <a class="reference internal" href="zreferences.html#eaton1973b">[ES73]</a>)
may be the closest example to the work presented in this chapter. He did his
PhD work at the University of Michigan under the Highway Safety Research
Institute. His dissertation focused on the experimental validation of the
motorcycle modeling work of <a class="reference internal" href="zreferences.html#sharp1971">[Sha71]</a> and the human controller modeling
work of <a class="reference internal" href="zreferences.html#weir1972">[Wei72]</a>. He did this with two sets of experiments: 1)
identification of the uncontrolled dynamics of the motorcycle under
perturbations, and 2) identification of the rider controller during roll
stabilization tasks. The latter of which will be discussed in the next section.</p>
<p>His initial experiments were aimed at validating and identifying the passive
motorcycle system. During these experiments, his subjects road a motorcycle
with their bodies rigidly braced to the frame and hands-free at speeds of 15,
30, and 45 mph (6.7, 13.4, and 20.1 m/s) along side a pace car which recorded
the output from roll angle, roll rate, and steer angle sensors. The brace and
open loop response allowed rigid rider modeling assumptions to be used.
Weights were dropped from one side of the motorcycle to induce a step roll
torque and the rider used a single pulse in steering torque to the handlebars
to right the motorcycle in roll after the drop. These experiments were
impressively dangerous and would be hard pressed for approval by the
Institutional Review Board if done today, but well designed for the typical
modeling assumptions. The resulting time histories of the measured system
outputs were compared to simulations of Sharp&#8217;s model <a class="reference internal" href="zreferences.html#sharp1971">[Sha71]</a>
augmented with a variety of tire models of Eaton&#8217;s design. He found good
agreement between the experiments and the models for higher speeds, but felt
that a more complex tire model was needed to predict the wobble mode in slower
speed runs.</p>
<p>The second set of experiments were more tame. The three riders simply balanced
the motorcycle on a straight path at two speeds, 15 mph and 30 mph, for a total
of 38 runs. He added a steer torque transducer bar above the handlebars. The
rider controlled the motorcycle with one hand and the rider applied torque was
recorded along with the other signals. No perturbations were necessary, as the
rider&#8217;s natural control actions excited the system in a wide enough bandwidth.
From this data he was able to identify the motorcycle steer torque to roll
angle transfer function through the spectral densities of the measured signals
(by dividing the cross spectrum of the roll angle and steer torque signal by
the power spectrum of the steer torque). The identified transfer functions show
good agreement with the augmented Sharp motorcycle model at the 30 mph speeds,
but less so for the 15 mph runs.</p>
<p>His generated frequency responses from the second experiments provided an
empirical model, while the simulation comparisons from the first experiments
were validation rather than identification.</p>
</div>
<div class="section" id="weir-zellner-teper">
<h4>Weir, Zellner, Teper<a class="headerlink" href="#weir-zellner-teper" title="Permalink to this headline">¶</a></h4>
<p>Weir, Zellner, and Teper performed an extensive experimental study on
motorcycle handling qualities for the U.S. National Highway Traffic Safety
Administration in the late 70&#8217;s, <a class="reference internal" href="zreferences.html#weir1979a">[WZT79]</a>. This was a follow up to
both the CALSPAN studies and <a class="reference internal" href="zreferences.html#taguchi1975">[Tag75]</a>, both under or related to the
same Administration. There is little to no explicit system identification in
the study but some important elements are there. In terms of the passive model
identification, they present steady state comparisons of their experimental
data to their models with varying degrees of qualitative agreement and
generally good ability to predict the conditions at which sign reversals in
torque are needed to maintain a steady turn. They also compare single lane
change simulations of a controlled vehicle to their measured data by visual
inspection. They unfortunately admit that adjusting the first principles models
to better fit their measured data was outside the scope of the project. But
this gives some early examples of model evaluation with respect to good quality
data.</p>
</div>
<div class="section" id="james">
<h4>James<a class="headerlink" href="#james" title="Permalink to this headline">¶</a></h4>
<p>Stephen James published a study in 2002 <a class="reference internal" href="zreferences.html#james2002">[Jam02]</a> in which he attempted to
identify the linear dynamics of an off-road motorcycle. He measured steering
torque, steer angle, speed, roll rate, and yaw rate with his subjects manually
exciting the vehicle through steer torque during runs at various speeds on a
straight single lane road. He made use of black box ARX SIMO identification
routines of 6th and 7th order (his and others motorcycles models are usually
10th+ order) to tease out the weave and wobble eigenvalues. He compares the
identified eigenvalues, eigenvectors and frequency responses to his motorcycle
model and claims good fits based on visual interpretation of the plots. The
agreement is questionable due to the lack of statistics in the model
comparisons and little validation of his first principles model which assumes a
rigid rider. The study does show that there is the possibility of
identification of multiple modes of motion with simple manual excitation of the
handlebars. He also used these techniques to identify the same motorbike with
a single wheel trailer in <a class="reference internal" href="zreferences.html#james2005">[Jam05]</a>.</p>
</div>
<div class="section" id="biral-et-al">
<h4>Biral et al.<a class="headerlink" href="#biral-et-al" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="zreferences.html#biral2003">[BBCL03]</a> performed a nice study to identify motorcycle dynamics under
an oscillatory steer torque input. They measured steer torque, roll rate, steer
angle, and yaw rate with an instrumented motorcycle. They performed slalom
maneuvers at speeds from 2 to 30 m/s at three sets of cone spacings in the
slalom course. The resulting time histories were close to ideal sinusoids. They
used curve fitting to find amplitude and phase relationships among the measured
signals. The results were plotted on Bode plots for comparison to the frequency
response of several first principles models. The models predict the
experimental data and their motorcycle model is shown to do a better job than
other models from literature. This claim is only based on visual inspection. I
would say this technique and others like it are more of an ad hoc method of
system identification of the vehicle dynamics because they rely heavily on very
specific input and output characteristics, but nevertheless seems to be
effective. Making use of formal system identification techniques could
potentially give more reliable results and the ability to better characterize
the uncertainty in the predictions.</p>
</div>
<div class="section" id="kooijman">
<h4>Kooijman<a class="headerlink" href="#kooijman" title="Permalink to this headline">¶</a></h4>
<p>Jodi Kooijman has worked on experimental validation of the benchmark bicycle
<a class="reference internal" href="zreferences.html#meijaard2007">[MPRS07]</a> linear equations of motion for a riderless bicycle
<a class="reference internal" href="zreferences.html#kooijman2006">[Koo06]</a>, <a class="reference internal" href="zreferences.html#kooijman2008">[KSM08]</a>, <a class="reference internal" href="zreferences.html#kooijman2009">[KS09]</a>. His
instrumented bicycle measured the steer angle, forward speed, roll rate, and
yaw rate. Due to the fact that the bicycle can be stable at certain speeds he
was able to launch the bicycle in and around the stable speed range and perturb
the bicycle with a lateral unmeasured impulse and record the stable decay in
the steer, roll, and yaw rates. The post perturbation time histories of the
measured signals provided nice decaying oscillations and curves could be fit to
find both the time decay constant and frequency of oscillation. These were then
compared to the predicted weave response based on the first principle model
numerically populated with measured physical parameters of the bicycle. He
found good prediction abilities of the weave mode between 4 and 6 m/s. The
&#8220;goodness&#8221; of fit were gaged by visual inspection with no uncertainty estimates
in the models or the results from the dynamic measurements. The method was not
able to predict the heavily damped caster mode nor the capsize mode. He also
demonstrated that the measured dynamics were the same when the experiments were
performed on a treadmill.</p>
<p>In <a class="reference internal" href="zreferences.html#kooijman2011">[KMP+11]</a>, Jodi constructed a bicycle with very unusual physical
characteristics including negative trail and canceled angular momentum of the
wheels. He performed similar experiments to his Master&#8217;s thesis work. They show
the comparison of a single stable experiment in which yaw and roll rates
were measured and compared to the predictions of the benchmark bicycle.</p>
<p><a class="reference internal" href="zreferences.html#stevens2009">[Ste09]</a> and <a class="reference internal" href="zreferences.html#escalona2011">[ER11]</a> both perform experiments similar to
Kooijman&#8217;s with similar results, although Steven&#8217;s results vary in the ability
of the model to predict the data for various configurations of his adjustable
bicycle.</p>
<p>These also fall into the ad hoc system identification techniques that take
advantage of the stability at certain speeds and very specific output
characteristics. The variability in reproducibility in the studies from other
researchers should be noted.</p>
</div>
<div class="section" id="chen-and-doa">
<h4>Chen and Doa<a class="headerlink" href="#chen-and-doa" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="zreferences.html#chen2010">[CD10]</a> develop a first principles non-linear bicycle model with a
fuzzy controller and use it to generate stable simulations for various speeds.
They then do an output error grey box identification on the resulting data with
respect to the non-zero and non-unity entries of the state, input and output
matrices (i.e. just the entries of the acceleration equations). The
identification is done for a discrete number of speeds in the range 1 to 15
m/s. The eigenvalues are calculated of the resulting identified,
speed-dependent A matrices and the root locus plotted versus speed.</p>
<p>The resulting eigenvalues seem to behave like the benchmark bicycle but the
capsize mode is shown to go unstable briefly at a speed lower than the stable
speed range. They did not attempt to characterize or identify the process noise
even though they generated the data with a known model with known input noise.
Also their non-linear bicycle equations of motion <a class="reference internal" href="zreferences.html#chen2006">[CD06]</a> were never
validated against any other accepted models. Both of these could potentially
explain the discrepancies in their identification. Their identification
procedure does show that it may be possible to get good estimates of a linear
model of the vehicle alone from noisy data regardless of the controller which
stabilizes the vehicle.</p>
</div>
<div class="section" id="doria">
<h4>Doria<a class="headerlink" href="#doria" title="Permalink to this headline">¶</a></h4>
<p>In <a class="reference internal" href="zreferences.html#doria2012">[DFT12]</a> experiments are performed where a motorcycle rider excites
the steering with a pulse and lets the motorcycle oscillate while the rider
keeps his hands on the handlebars (as opposed to Eaton&#8217;s hands-free
experiments). The resulting dynamical measurements are nice decaying
sinusoidal-like motions and the authors fit optimal curves to the data. They
identify the time constants, and frequency and phase information to construct
the eigenvalues and eigenvectors of the excited mode. The empirically derived
eigenvectors show some resemblance to the model&#8217;s predictions.</p>
</div>
</div>
<div class="section" id="controller-identification">
<h3>Controller Identification<a class="headerlink" href="#controller-identification" title="Permalink to this headline">¶</a></h3>
<div class="section" id="van-lunteren-and-stassen">
<h4>van Lunteren and Stassen<a class="headerlink" href="#van-lunteren-and-stassen" title="Permalink to this headline">¶</a></h4>
<p>At Delft University of Technology in the Man-Machines research group, Drs. van
Lunteren and Stassen began work in 1962 to identify the human controller for a
normal population of subjects and report on their work into the early 70&#8217;s
(<a class="reference internal" href="zreferences.html#lunteren1967">[VLS67]</a>, <a class="reference internal" href="zreferences.html#lunteren1969">[VLS69]</a>, <a class="reference internal" href="zreferences.html#stassen1969">[Sta69]</a>,
<a class="reference internal" href="zreferences.html#lunteren1970">[VLS70a]</a>, <a class="reference internal" href="zreferences.html#lunteren1970a">[VLS70b]</a>, <a class="reference internal" href="zreferences.html#lunteren1970b">[VLS70c]</a>,
<a class="reference internal" href="zreferences.html#lunteren1973">[VLS73]</a>, <a class="reference internal" href="zreferences.html#stassen1973">[SVLB+73]</a>). They chose a bicycle simulator as
the plant because it was a common task that average people could do and their
studies could focus on a wider population of individuals as compared to most
previous work based around trained pilots. The bicycle simulator did not
capture all of the essential dynamics of a real bicycle as it&#8217;s operation was
based on only the simplified roll dynamics of Whipple&#8217;s model, but nonetheless
offered a similarly complex roll stabilization control task as a normal bicycle
would. The simulator was controlled by both the steering angle and the rider&#8217;s
lean angle, both of which are questionable inputs as have been pointed out as
early as <a class="reference internal" href="zreferences.html#roland1972">[RL72]</a>.</p>
<p>They assumed the rider&#8217;s control actions can be described by a PID controller
with time delays on each feedback variable and mention that this controller was
chosen instead of a McRuer style controller primarily due to limitations of
their computational equipment. The error in the roll angle is fed into two PID
controllers each with a time delay: one to output the corrective steer angle
and the other to output the corrective lean angle. They introduce a remnant
term for each control action and the external disturbances to the bicycle
model.</p>
<p>The identification goal was to find the six gains and two time delays in which
the controller performed as a human would. The preferred method was a real time
estimation routine due to the speed of computations and reasonable agreement
their correlation method. The results indicated that the subjects used no
integral control (i.e. only position and rate feedback). They could identify
within a bandwidth of about 2 Hz and noticed that when the system was
undisturbed there was a 0.5 Hz dominant frequency in the rider&#8217;s control
actions. The rate feedback was more dominant in generating the lean control
input than it was for the steer control input. Also, they found the time delay
for lean to be larger than the steer time delay and postulate that the steer
action is a result of cerebral activity while the lean is more of a reflexive
pattern. Another finding resulting from analysis of Nyquist plots of different
riders&#8217; identified control actions showed that riders chose different control
actions. They attribute this to the roll stabilization being a sub-critical
task (i.e. a more difficult task may force different riders to adopt similar
control behavior). They also investigated the effects of drugs, such as
alcohol, on the riders control behavior. They found correlations from drug dose
to time delays and the error in the control actions. Their later studies
introduced better identification methods and they found discrepancies in the
identified time delays of the later work as compared to the previous work. For
example, the steer control time delay was originally found to be around 1.5
seconds and the improved methods found the delay to be around 0.7 seconds. The
discrepancy was attributed to the bias due to remnant in their early work. They
also introduced a visual tracking task into the simulator but had difficulties
in getting reliable transfer function identification as compared to the roll
stabilization transfer functions which improved in quality due to longer trials
of 35 minutes.</p>
<p>The methods developed in their studies are excellent and thorough examples of
early parameter identification in human control tasks. The simpler plant
dynamics were most likely beneficial in reducing the uncertainty in the
identified parameters, but the choice of angles as inputs instead forces of
torques may not be a realistic enough model of the human&#8217;s actuation.</p>
</div>
<div class="section" id="id35">
<h4>Eaton<a class="headerlink" href="#id35" title="Permalink to this headline">¶</a></h4>
<p>After feeling confident in his motorcycle identification results, Eaton made
use of the Wingrove-Edwards (<a class="reference internal" href="zreferences.html#wingrove1968">[WE68]</a>, <a class="reference internal" href="zreferences.html#wingrove1969">[WEC69]</a>,
<a class="reference internal" href="zreferences.html#wingrove1971">[Win71]</a>, <a class="reference internal" href="zreferences.html#edwards1972">[Edw72]</a>)  method in tandem with an impulse
identification to identify the human controller. The remnant element was large
with respect to the torque that was linearly correlated with the roll angle,
but the human control element was identified with a simple gain and time delay
for most of the high speed runs. The time delay identification of about 0.3
seconds was very repeatable across all runs. Furthermore, he demonstrated that
the crossover model was evident in the resulting closed loop rider-motorcycle
transfer functions.</p>
<p>Eaton is one of very few who have identified the rider controller during actual
single track vehicle tests with confidence in the underlying passive
rider-vehicle model. This study has influenced the work in this chapter in many
ways.</p>
</div>
<div class="section" id="doyle">
<h4>Doyle<a class="headerlink" href="#doyle" title="Permalink to this headline">¶</a></h4>
<p>A recently uncovered study on the manual control of a bicycle from a
psychologist&#8217;s perspective has some very non-traditional techniques and
outlooks for the understanding of the control system employed while balancing a
bicycle <a class="reference internal" href="zreferences.html#doyle1987">[Doy87]</a>. Anthony Doyle&#8217;s paper <a class="reference internal" href="zreferences.html#doyle1988">[Doy88]</a> on his
thesis topic opens with &#8220;The old saw says that once learned it is never
forgotten, but what exactly is learned has been by no means clear.&#8221; This
reflection points to the great complexity behind balancing a bicycle, such an
easily gained skill. He chooses to study the bicycle over a simpler task
partially due to the fact that the rider has little freedom in effective
control strategies and partially because it is a skill many people can do.</p>
<p>His goal was to determine how much of the rider&#8217;s control actions can be
accounted for without involving higher cerebral functions. He mentions the Weir
and Zellner work and the fact that its focus is on  motorcycles at high speed,
and questions whether the control employed for their system is simply a
different version of the one employed on a bicycle at low speed or whether they
are different control methodologies altogether.</p>
<p>He was aware of the inherent stability that bicycles can provide and constructs
an instrumented bicycle where the head angle, trail, and front wheel gyro
effects are eliminated so that &#8220;all steer movements are a result of the human&#8217;s
control&#8221;. He also mentions, but doesn&#8217;t use, a body brace to eliminate
unnecessary body movements and he blindfolds his subjects so that their sensory
information is limited to proprioception and vestibular cues. He mentions the
arm and upper body movements and how it is difficult to tease out the
deliberate movements versus the passive dynamics of the body. With the
instrumented bicycle he conducts low speed steady turn and balancing tasks and
measures speed, roll rate, and steer angle.</p>
<p>Along with the experimental data, he developed a bicycle and rider model with
accompanying controller. The derivation of the bicycle model is
questionable due to the non-traditional methods, but he does end up with a
model which behaves like a bicycle including speed dependent stability. He is
aware of the need to roll the bicycle frame in the direction of the desired
turn for directional control and how counter-steering plays a roll in this.
This concept leads to the primary inner loop being chosen as roll control and
his control structure resembles that of Weir&#8217;s work in terms of sequential
loops. He cites the crossover model and is aware that humans can adjust their
gains as needed for good performance. The controller is traditional in most
senses and follows the patterns by McRuer, Weir, and Eaton, but he adds in the
ability to add discrete pulses to the roll angle. He feeds back roll
acceleration and integrates it to get roll angular velocity. This is basically
a continuous PD control on roll rate. But his non-continuous addition to the
controller is based on a fuzzy logic-like rule &#8220;Make a pulse against the lean
whenever it gets bigger that 1.6 degrees.&#8221;</p>
<p>It seems like he gets somewhat close matches to the experimental traces from
his control model simulations without the discrete pulses, but then adds in
pulses (single or multiple) to the steering so that the traces matches more
closely. His identification technique and criterion is focused around a
detailed examination of the patterns in the time histories in a very
qualitative way.</p>
<p>His results focus on the evidence for intermittent control and finds the
traditional gains to be inversely proportional to speed. He claims the
balancing part of the control system is done primarily in the lower cortex.</p>
<p>To me, Doyle&#8217;s work emphasizes the need for close collaboration between
psychologists and control engineers to formalize the theory for human balance.
His intermittent control theory may be valid, but due to the unusual model
development, simulation and analysis techniques it is hard to gauge whether the
need for intermittent control was simply an artifact of poor vehicle modeling.
His insight into the human control theory is very enlightening and his ways of
wording bring the theory outside the traditional control framework for an
expansion in understanding.</p>
</div>
<div class="section" id="lange">
<h4>Lange<a class="headerlink" href="#lange" title="Permalink to this headline">¶</a></h4>
<p>Peter de Lange&#8217;s recent Master thesis work <a class="reference internal" href="zreferences.html#lange2011">[DL11]</a> focused on
identifying the rider controller from the data that he helped us collect while
interning at our lab. He used the Whipple bicycle model, a simplified second
order representation of the human&#8217;s neuromuscular dynamics (natural frequency
2.17 rad/s and damping ratio of 1.414<a class="footnote-reference" href="#overdamped" id="id43">[2]</a>) and a PID like
controller with a 0.03 second time delay. The controller structure had gains
proportional to the integral of the angle, the angle, the angular rate and the
angular acceleration for roll and steer. The control task was defined as simple
roll stabilization (i.e. track a roll angle of zero degrees), even though the
data was collected during heading and roll tracking tasks.</p>
<p>He used a four step process for identifying the rider controller 1) he
&#8220;removed&#8221; the human remnant by averaging the time histories over several
individual perturbations, 2) he identified a high order finite impulse response
model (only a function of previous inputs) for the lateral force to steer angle
SISO pair (lateral perturbation force input and steer angle as output) 3) low
pass filtered the resulting responses, and 4) he identified the rider
controller parameters with a grey box model using the filtered FIR simulation
results as the base data. The grey box model was parameterized with eight gains
and a time delay. He was able to identify the gains, but the time delay always
gave a resulting unstable model, so he dropped it. Furthermore, all of the
gains were not necessary for good model predictions so he eliminated the
unnecessary gains systematically to find the critical feedback elements. These
turned out to be the gains for roll angle, roll rate, steer rate, and the
integral of the steer angle. The first three are as one may expect and he
concludes that the steer angle integral could be equated to yaw angle feedback
since they are proportional in the linear sense.</p>
<p>Peter&#8217;s approach hinges on the averaging process in step one. The human remnant
is large relative to the measurements and averaging potentially removes data
that isn&#8217;t necessarily noise. This averaging is atypical, as process noise
models are usually employed to account for these variations in the data. Using
a model such as ARMAX instead of the two step averaging and FIR model would
potentially allow one to identify the underlying linear model without removing
potentially valid data in the time history averaging process. Or all of the
steps could be combined into a state space grey box formulation with a process
noise model, for a more direct route to identifying the free parameters. But
these methods have their difficulties and will be described later in the
Chapter.</p>
</div>
</div>
<div class="section" id="conclusion">
<h3>Conclusion<a class="headerlink" href="#conclusion" title="Permalink to this headline">¶</a></h3>
<p>The literature provides many examples of first principle models for both the
open loop vehicle-rider system dynamics and the rider&#8217;s control, but often
proving that those models are good predictors of real physical phenomena is
difficult. The previous examples presented above have various similarities that
influence the methods I&#8217;ve chosen to use to identify the vehicle and the rider.</p>
<dl class="docutils">
<dt>Open loop identification</dt>
<dd><p class="first">The purpose of the open loop identification is to identify the passive
vehicle and rider dynamics. This includes the force and kinematic
relationships of the bicycle or motorcycle and, if a rider is present, the
passive dynamics of the rider&#8217;s body motion. Their are two basic approaches
that have been used in literature.</p>
<dl class="last docutils">
<dt>Mode Excitation</dt>
<dd>This involves identifying particular modes of motion by forcing the
system such that those modes are excited. The input to the vehicle is
typically limited to a narrow bandwidth. The forcing can be generated
manually from human control, by external perturbations, or as a result of
the maneuver. The techniques are best at identifying sustained
oscillatory modes. Decaying oscillations are fit to the data to extract
time constant, frequency, and phase shift for various input-output
combinations. These techniques generally give good repeatable results,
but are limited to identifying single modes and require many experiments
to get a spread in frequency content and vehicle speed. These methods
are also limited to identifying open loop dynamics.</dd>
<dt>Excitation</dt>
<dd>Many modes of a model can be simultaneously excited if proper inputs to
the vehicle are chosen, giving the opportunity to identify more complete
dynamic models. Frequency sweeps, white noise, and sum of sines are good
candidates for a broad input spectrum. And it turns out that the remnant
associated with human control and or deliberate random manual excitation
can provide a wide bandwidth input spectrum as shown in <a class="reference internal" href="zreferences.html#eaton1973">[Eat73b]</a>
and <a class="reference internal" href="zreferences.html#james2002">[Jam02]</a> for adequate system identification of many modes
including the higher frequency wobble mode. Modern system identification
techniques can be used to find models and identify physical parameters.</dd>
</dl>
</dd>
<dt>Rider Control Identification (closed loop, active)</dt>
<dd><p class="first">Few have attempted to identify the rider as a control element in the bicycle
or motorcycle system. The large array of potential control actions from a
unconstrained rider is extremely difficult to measure, especially when both
the forces and kinematics are keys to proper identification. Typically
limits are put on how the rider can actuate the system and in some cases
limits are put on the rider&#8217;s ability to sense the system. This is somewhat
critical so that the system is much more tractable. Similar to the open loop
excitation techniques, a broad frequency spectrum provides better data to
work for identification purposes. <a class="reference internal" href="zreferences.html#lange2011">[DL11]</a> has a good overview of
excitation ideas.</p>
<p>The open loop dynamics are in some sense much easier to model with first
principles, as the theory is much more mature. On the other hand, the
theoretical constructs of the control system of the human is relatively in
its infancy, so having the advantage of strongly validated first principles
is much weaker than say in the field of mechanics. Most researchers&#8217;
approaches have been modeled from the manual control work lead by authors
such as Tustin and McRuer in the 50&#8217;s and 60&#8217;s. When mapped to the bicycle,
the primary control loop is taken as roll stabilization and roll command
authority, with the secondary loops being heading and tracking. Both
sequential loop controller designs and the popular PID controllers have been
used as a structure for gain and delay parameter identification in the
control loops.</p>
<p class="last">Accurate parameter identification relies on accurate characterization of the
system process noise and in the case of a human rider, the process noise is
often comparable in magnitude and frequency to the control actions
themselves. Techniques that treat the controller as a quasi-linear
structure, in which the noise is modeled as white and Gaussian and
characterized by the portion of the output not linearly correlated to the
input (i.e. remnant), have been popular in the past. <a class="reference internal" href="zreferences.html#eaton1973">[Eat73b]</a> took
care to account for this and found that the crossover model was a good
predictor of human control action. A proper treatment of the noise by other
researchers is typically little to none and justly so as it is not
necessarily easy to deal with small signal-to-noise ratios in the linear
control framework. Modern system identification techniques offer some
ability to model process noise with ARMAX types of implementations and state
space formulations benefiting from the integration with Kalman filters. As
will be discussed in the following sections, model identification works
fairly well but parameter identification such as those for control gains
becomes increasingly difficult with larger noise.</p>
</dd>
</dl>
</div>
</div>
<div class="section" id="experimental-design">
<h2>Experimental Design<a class="headerlink" href="#experimental-design" title="Permalink to this headline">¶</a></h2>
<p>Our main experimental designs were focused around reasonable ways to excite the
rider/bicycle system with the goal of identifying the parameters of the rider
control system. I started by simply repeating some of the perturbation
experiments from Chapters <a class="reference internal" href="delftbicycle.html#delftbicycle"><em>Delft Instrumented Bicycle</em></a> and <a class="reference internal" href="motioncapture.html#motioncapture"><em>Motion Capture</em></a>, but
included and measured the lateral perturbation force and the steer torque which
were critical measurements for realistic input/output relationships that the
previous studies lacked. We also attempted single lane change maneuvers because
we&#8217;d been using a lane change as our objective criterion in our simulations
<a class="reference internal" href="zreferences.html#hess2012">[HMH12]</a> and they had been used successfully used in the literature. It
turned out that we were able to get reasonable results with preliminary system
identification with the lateral perturbation runs and did not pursue the lane
change maneuvers beyond the preliminary efforts. The lane changes were
especially difficult on the narrow treadmill.</p>
<div class="section" id="riders">
<h3>Riders<a class="headerlink" href="#riders" title="Permalink to this headline">¶</a></h3>
<p>We chose three riders: Charlie, Jason, and Luke of similar age: 34, 28-29, 32,
mass: 79, 84, 84 kg and bicycling ability although Luke has more technical
mountain biking skill than the other two riders. A wide range of skill levels
were outside the scope of the project and we preferred riders with good
proficiency as it has been shown that it increases repeatability of results in
tasks such as these <a class="reference internal" href="zreferences.html#weir1979a">[WZT79]</a>. The seat height and harness were set in
the same position for Charlie and Luke and in a different position for Jason.
The inertia of the rear frame was measured for both configurations (thus the
&#8220;Rigidcl&#8221; and &#8220;Rigid&#8221; bicycles) in Chapter <a class="reference internal" href="physicalparameters.html#physicalparameters"><em>Physical Parameters</em></a>.</p>
</div>
<div class="section" id="environments">
<h3>Environments<a class="headerlink" href="#environments" title="Permalink to this headline">¶</a></h3>
<p>We performed the experiments in two different environments: on a treadmill and in
a large gymnasium.</p>
<div class="section" id="treadmill">
<h4>Treadmill<a class="headerlink" href="#treadmill" title="Permalink to this headline">¶</a></h4>
<p>Dr. James Jones at the veterinary school at here at Davis graciously let us use
their horse treadmill (Graber Ag Kagra Mustang 2200) during their downtime,
<a class="reference internal" href="#fighorsetreadmill"><em>Figure 11.1</em></a>. The treadmill is 1 meter wider and 5
meters long and has a speed range from 0.5 m/s to 17 m/s. This was only a third
of the width treadmill at Vrije Universiteit in Amsterdam, but after some
practice runs we felt that narrow lane changes and the lateral perturbations
could be successfully performed. We used the treadmill because the environment
was very controllable, in particular with regard to fixed constant speeds, and
it offered the ability to do very long run durations within a broad speed
range. Potentially both the side railings and the belt side curbs added to
rider&#8217;s lack of lateral movement space and changed the riders&#8217; control
strategy.</p>
<div class="figure align-center" id="fighorsetreadmill">
<a class="reference external image-reference" href="_images/horse-treadmill.jpg"><img alt="_images/horse-treadmill.jpg" src="_images/horse-treadmill.jpg" style="width: 4in;" /></a>
<p class="caption">Sideview of the horse treadmill while Luke was riding the bicycle.</p>
</div>
</div>
<div class="section" id="pavilion">
<h4>Pavilion<a class="headerlink" href="#pavilion" title="Permalink to this headline">¶</a></h4>
<p>The bicycle was designed in such a way that all of the data collection
equipment was on board and was suitable for data collection in a free
environment. After lengthy bureaucratic negotiations, we were able to make use
of the UCD pavilion floor for the experiments, <a class="reference internal" href="#figpavilion"><em>Figure 11.2</em></a>.
The floor was made of a stiff rubber<a class="footnote-reference" href="#pavilionfloor" id="id50">[3]</a> and provided a
rectangular, wind-free space of about 100&#8217; by 180&#8217; (30 m by 55 m). We rode
around the perimeter to build up speed and did our maneuvers on a straight
section about 100 feet (30 m) long. We were not able to travel at speeds
higher than about 7 m/s as the tires would slip in the final turn into the test
section (this seemed to be due to the dust on the floor). This indoor
environment provided a wind free area which was more akin to the environment
bicyclists normally ride in than did the treadmill.</p>
<div class="figure align-center" id="figpavilion">
<a class="reference external image-reference" href="_images/pavilion.jpg"><img alt="_images/pavilion.jpg" src="_images/pavilion.jpg" style="width: 3in;" /></a>
<p class="caption">Overhead view of the pavilion floor during a perturbation run.</p>
</div>
</div>
</div>
<div class="section" id="maneuvers">
<h3>Maneuvers<a class="headerlink" href="#maneuvers" title="Permalink to this headline">¶</a></h3>
<p>Our choice of maneuvers was primarily guided by our previous experiments and
the search for an optimal way to externally excite the system. We also made
sure to perform sets of experiments that would act as a control without
deliberate disturbances. The following list details the meaning of the maneuver
labels in the dataset.</p>
<dl class="docutils">
<dt>System Test</dt>
<dd>This is a generic label for data collected during various system tests that
should not be used for general analysis. This was primarily used to check
that all sensors were working before each set of experiments.</dd>
<dt>Balance</dt>
<dd>The rider is instructed to simply balance the bicycle and keep a relatively
constant heading. They were instructed to focus on a point of their choosing
in the far distance. There was an open door in front of the treadmill which
allowed the rider to look to a point outside across the street. In the
pavilion, the rider looked into the rafters of the building or at the
furthest wall. We may have given slightly different instructions to the
riders and Charlie did not understand the instructions exactly during some
of the earlier runs, but nonetheless these can be analyzed with a control
model that only has the roll and heading loops closed and maybe even with
only the roll loop closed. We had a line taped to the pavilion floor during
these runs that was still in the periphery of the rider&#8217;s vision. This may
have affected their heading control even though they were instructed to
ignore it.</dd>
<dt>Balance With Disturbance</dt>
<dd>Same as &#8216;Balance&#8217; except that a lateral force perturbation is applied just
under the seat of the bicycle. The rider wore a face shield on the side of
the perturber so no visual cues were available to predict the perturbation
time or direction. On the treadmill, we sample for 60 to 90 seconds with
five to eleven perturbations per run. On the pavilion floor we were able to
apply only two to four perturbations per run due to the length of the track.
In the early runs (&lt; 204), the lateral force was applied only in the
negative direction (to the left) and the perturber decided when to apply the
perturbations. For the later runs (&gt; 203), we applied a random sequence of
positive and negative perturbations that was unknown to the rider. On the
treadmill, the rider signaled when they felt stable and the perturbation was
applied at a random time between 0 and 1 second based on a simple computer
program. On the pavilion floor, we simply applied the perturbations randomly
but as soon as the rider felt stable so that we could get in as many as
possible during each run.</dd>
<dt>Track Straight Line</dt>
<dd>The rider was instructed to focus on a straight line that was marked on the
ground and he attempted to keep the front wheel on the line. The line of
sight from the rider&#8217;s eyes to the line on the ground was essentially
tangent the top of the front wheel. In the pavilion, the line could be seen
up to 100 feet ahead, so there was greater peripheral view of the line. On
the treadmill, there was from 0.5 to 1.5 meters of preview line available.</dd>
<dt>Track Straight Line With Disturbance</dt>
<dd>Same as &#8220;Track Straight Line&#8221; except that a lateral perturbation force is
applied to the seat of the bicycle. This was done in the same fashion as
described in &#8220;Balance With Disturbance&#8221;.</dd>
<dt>Lane Change</dt>
<dd>The rider attempted to track a line in similar fashion as the &#8220;Track
Straight Line&#8221; maneuver except that the line was a single lane change. On
the pavilion floor, the line was taped on the ground and the rider was
instructed to do whatever felt best to stay on the line <a class="reference internal" href="#figpavilionlanechange"><em>Figure
11.3</em></a>. They could use full preview looking ahead,
focus on the front wheel and line, or a combination of both. We also tried
some lane changes on the treadmill but the lack of preview of the line made
it especially difficult. We were able to manage it by marking a count down
on the belt so that the rider new when the lane change would arrive. The
rider also knew the direction of lane change beforehand for all the
scenarios.</dd>
<dt>Blind With Disturbance</dt>
<dd>We did a run or two for each rider on the pavilion floor with the rider&#8217;s
eyes closed to attempt to completely open the heading loop. In hindsight,
blind tests would be preferable when identifying the rider control system so
that only inner roll stabilization loop need be analyzed.</dd>
<dt>Static Calibration</dt>
<dd>We took a short duration sample of the sensors&#8217; signals while no rider was
on the bicycle and the bicycle was fixed as close as possible to vertical in
roll before each set of runs. The static accelerometer readings could
theoretically give the roll and pitch angles of the bicycle frame and be
used to account for the bias in the roll angle measurements.</dd>
</dl>
<div class="figure align-center" id="figpavilionlanechange">
<a class="reference external image-reference" href="_images/pavilion-lane-change.png"><img alt="_images/pavilion-lane-change.png" src="_images/pavilion-lane-change.png" style="width: 5in;" /></a>
<p class="caption">The dimensions of the single lane change on the pavilion floor for runs
115-139.</p>
</div>
<p>I only focus on the Balance and Track Straight Line maneuvers with and without
disturbances in the following analyses and they will be referred to as Heading
Tracking and Lateral Deviation Tracking in the text (as opposed to the labels
in the database).</p>
<dl class="docutils">
<dt>Heading Tracking</dt>
<dd>The rider was instructed to simply balance the bicycle and keep a
relatively constant heading while focusing their vision at a point
in the far distance.</dd>
<dt>Lateral Deviation Tracking</dt>
<dd>The rider was instructed to focus on a straight line that was marked
on the ground and to attempt to keep the front wheel on the line.</dd>
</dl>
<p>Both tasks were performed with and without the application of a manually
applied lateral perturbation force just below the seat. The forces were
applied randomly in direction and time.</p>
</div>
</div>
<div class="section" id="data">
<h2>Data<a class="headerlink" href="#data" title="Permalink to this headline">¶</a></h2>
<p>The experimental data was collected on seven different days. The first few days
were mostly trials to test the equipment, procedures and different maneuvers.
The data from the trial days is valid data and we ended up using it in our
analysis. The tires were pumped to 100 psi at the start of each day.</p>
<dl class="docutils">
<dt>February 4 2011 Runs 103-109</dt>
<dd>These were the first trials on the treadmill for preliminary testing. Only
Jason rode. We performed lateral deviation tracking with disturbances. The
bike fell over, broke and we had to cut it short.</dd>
<dt>February 28, 2011 Run 115-170</dt>
<dd>These were the first trials in the pavilion. Jason was the only rider. We
tried lane changes (115-139), lateral deviation tracking with disturbances
(140-157), and a mixture of heading tracking and lateral deviation tracking
with no disturbances (158-170). I noted that the slip clutch backlash seemed
to be larger than the previous day with a guess of about 1 degree.</dd>
<dt>March 9, 2011 Runs 180-204</dt>
<dd>This was the second go at the treadmill, still just testing things. Jason
was the only rider. We did heading and lateral deviation tracking with
disturbances and some lane changes. The lane changes were 0.25 m wide left
and right maneuvers back and forth among two lines on the treadmill at 2 m
long segments. Countdown markers to give an idea when the lane change
started were necessary due to the rider&#8217;s limited preview distance. We did
the highest speed during any subsequent trials at 9 m/s. The 9 m/s runs
generated a large amount of noise in the lateral force channel. The treadmill
elevation was set at 0.1% upwards incline (because it was stuck).</dd>
<dt>August 30, 2011 Runs 235-291</dt>
<dd>Jason and Luke rode and performed heading and lateral deviation tasks with
and without perturbations at three speeds on the treadmill.</dd>
<dt>September 6, 2011 Runs 295-318</dt>
<dd>Charlie performed heading and lateral deviation tasks with and without
perturbations on the treadmill.</dd>
<dt>September 9, 2011 Runs 325-536</dt>
<dd>Luke, Charlie and Jason performed heading and lateral deviation tracking
tasks on the Pavilion floor with and without perturbations. Most of Luke and
Charlie&#8217;s runs were corrupt due to the time synchronization issues.</dd>
<dt>September 21, 2011 Runs 538-706</dt>
<dd>Luke and Charlie repeated the runs from September 9th. And we added a couple
of blind runs for each of them.</dd>
</dl>
<p>The meta data and raw time history data for each run and all sensor calibration
data were stored in individual Matlab mat files on the data acquisition
computer using the <a class="reference external" href="https://github.com/moorepants/BicycleDAQ">BicycleDAQ</a>
software. The run files and calibration files are automatically numbered in
sequence with a five digit number; one sequence for runs and one for
calibrations. These mat files were then parsed and merged into a uniform,
organized, and complete single HDF5 database that could be accessed by a number
of programs and languages for fast data queries. I made use of <a class="reference external" href="http://www.pytables.org">PyTables</a> for writing and reading from the database. The
software <a class="reference external" href="http://github.com/moorepants/BicycleDataProcessor">BicycleDataProcessor</a> was designed as an
interface to the data in the database. In particular, it is able to load the
raw data from individual runs, process it, and present it for easy manipulation
and viewing.</p>
<p>The database is initially structured with three top-level tables and nodes
containing the time histories of the sensors for each run. The run table has a
row for each run and the columns store each piece of meta data, including the
corruption coding described below. The signal table has a row for each raw and
processed signal type and the classification information for each. The
calibration table has a row for each calibration which provides information
about the sensor and the data collected in the calibration.</p>
<p>We recorded a large set of meta data for each run to help with parsing during
analyses. We also video recorded all of the runs (minus a few video mishaps).
I coded each run based on the notes, data quality, and viewing the video for
potential or definite corrupted data with the following five codes.</p>
<dl class="docutils">
<dt>Corrupt</dt>
<dd>If the data is completely unusable due to time synchronization issues or
others then this is set to true.</dd>
<dt>Warning</dt>
<dd>Runs with a warning flag are questionable and potentially not usable.</dd>
<dt>Knee</dt>
<dd>The rider&#8217;s knees would sometimes de-clip from the frame during a
perturbation. This potentially invalidates the rigid rider assumption. An
array of 15 boolean values, one for each perturbation in the run, are stored
for each run and each true value in the array represents an individual
perturbation where a knee disengaged with the bicycle.</dd>
<dt>Handlebar</dt>
<dd>On the treadmill the bicycle handlebars occasionally contacted the side
railings. Each perturbation during the run in which this happened was
recorded.</dd>
<dt>Trailer</dt>
<dd>On the treadmill the roll trailer occasionally contacted the side of the
treadmill. Each perturbation during the run which this happened was
recorded.</dd>
</dl>
<p>We ultimately collected 600+ runs that were potentially usable for analysis.
<a class="reference internal" href="#figdatabarplots"><em>Figure 11.4</em></a> gives a breakdown of the runs by rider,
environment, maneuvers, and speed bins.</p>
<div class="figure align-center" id="figdatabarplots">
<a class="reference external image-reference" href="_images/raw-data-bar-plot.png"><img alt="_images/raw-data-bar-plot.png" src="_images/raw-data-bar-plot.png" style="width: 4in;" /></a>
<p class="caption">Four bar charts showing the number of runs that are potentially usable for
model identification. These include runs from the treadmill and pavilion,
one of the four primary maneuvers, and were not corrupt. Generated by
<tt class="docutils literal"><span class="pre">src/systemidentification/data_histograms/py</span></tt>.</p>
</div>
<p>The processed data provides filtered signals that correspond to the coordinates
and speeds outlined in our models, Chapters <a class="reference internal" href="eom.html#eom"><em>Bicycle Equations Of Motion</em></a> and <a class="reference internal" href="extensions.html#extensions"><em>Extensions of the Whipple Model</em></a>.
We were even able to estimate the path of the wheel contact points on the
ground. The quality of the data is high with little to no missing data and
complete descriptions of the dynamic state through time. Figures
<a class="reference internal" href="#figtreadmilltimehistory"><em>11.5</em></a> and <a class="reference internal" href="#figpaviliontimehistory"><em>11.6</em></a>
give examples of the processed data for the two environments.</p>
<div class="figure align-center" id="figtreadmilltimehistory">
<a class="reference external image-reference" href="_images/time-history-treadmill.png"><img alt="_images/time-history-treadmill.png" src="_images/time-history-treadmill.png" style="width: 6in;" /></a>
<p class="caption">The time histories of the computed signals for a typical treadmill run after
processing and filtering. Only a portion of the 90 second run is shown for
clarity. Generated by <tt class="docutils literal"><span class="pre">src/systemidentification/run_time_history.py</span></tt>.</p>
</div>
<div class="figure align-center" id="figpaviliontimehistory">
<a class="reference external image-reference" href="_images/time-history-pavilion.png"><img alt="_images/time-history-pavilion.png" src="_images/time-history-pavilion.png" style="width: 6in;" /></a>
<p class="caption">The time histories of the computed signals for a typical pavilion run after
processing and filtering. Generated by
<tt class="docutils literal"><span class="pre">src/systemidentification/run_time_history.py</span></tt>.</p>
</div>
</div>
<div class="section" id="id51">
<h2>System Identification<a class="headerlink" href="#id51" title="Permalink to this headline">¶</a></h2>
<p>My primary goal in the following analyses of all the collected data is to
identify the manual control system employed the rider. I will approach this in
a similar fashion to <a class="reference internal" href="zreferences.html#eaton1973">[Eat73b]</a> and attempt to identify the plant, i.e.
the open loop bicycle and rider dynamics, first followed by an identification
of the control system. The question arises as to what the plant and controller
consist of. In this case, I consider the plant to include the passive or open
loop model of the bicycle combined with the rider&#8217;s biomechanics and the
controller to be the some makeup of the human brain which takes sensory inputs,
has time delays, and sends outputs for muscular control.</p>
<p>This two part process was not originally thought to be needed and I started
with the identification of the control system assuming the Whipple model would
be adequate for the open loop dynamics. But my preliminary attempts at
identifying the controller with the Whipple model in place showed that the
plant always under-predicted the steer torque needed for a given measured
trajectory. This lead me into the exploration of the validity of the Whipple
model.</p>
<p>There is actually very little experimental validation of the open loop dynamics
of the bicycle, with <a class="reference internal" href="zreferences.html#kooijman2006">[Koo06]</a> being one of the better studies. But
his study was limited to a riderless bicycle in a narrow speed range where the
bicycle was stable. Taking the validity of first principles models like this
for granted can potentially lead to inaccurate conclusions. In our case, it
resulted in erroneous early estimations of the controller parameters. As
pointed out by many, in particular the motorcycle researchers, there is very
good reason to question some of assumptions. The main questionable assumption
being knife-edge no side-slip wheels, especially when under a rider&#8217;s weight.
And secondly, the rider&#8217;s biomechanics have much more influence and coupling to
the bicycle than the motorcycle, which must be accounted for.</p>
<p>After a model for the open loop system is derived I identify parameters in the
control structure described in <a class="reference internal" href="zreferences.html#hess2012">[HMH12]</a> and in Chapter <a class="reference internal" href="control.html#control"><em>Control</em></a>.
We&#8217;ve shown that this control structure is robust for a range of speeds and
lends itself to the dictates of the crossover model which is built upon strong
experimental evidence in human operator modeling. I make use of multi-input
multi-output grey box state space identification techniques to arrive at the
optimal parameters for the measured data.</p>
<p>Before I proceed, it is important to emphasize the difference in identifying a
model that best predicts the data and identifying physical parameters in a
model structure that cause the predictions to best fit the measured data. In
the first case, it is somewhat easy to fit a model to input and output data. By
increasing the order of the model and thus the number of free parameters one
can theoretically fit every data point. This is most evident in the
over-fitting of a linear trend with that of a higher order polynomial. It still
often takes human intuition and reasoning to limit the order of the system to
something that represents the true relationships between the variables. But
even in this case, the individual meaning of the resulting identified
parameters of a black box system may have little apparent connection to the
known first principles laws we are familiar with and trust. In dynamics, we
often want to know how well our first principles models predict the measured
motion and secondly we&#8217;d like the ability to identify parameters, particularly
ones we are uncertain of in the first principles models, from the measured
data. Accurately identifying model parameters is much more difficult task,
because noises, both process and measurement, have to be accounted for to get
repeatable and accurate estimates of the parameters. I have had good success
with finding models that predict the data but little success with explicit and
accurate parameter identification in the following analyses. There is great
room for improvement in the parameter identification if the noise issues are
better managed.</p>
</div>
<div class="section" id="bicycle-model-validity">
<h2>Bicycle Model Validity<a class="headerlink" href="#bicycle-model-validity" title="Permalink to this headline">¶</a></h2>
<p>The open loop dynamics of the bicycle-rider system can be described using many
models, see <a class="reference internal" href="zreferences.html#astrom2005">[ASKL05]</a>, <a class="reference internal" href="zreferences.html#limebeer2006">[LS06]</a>, and <a class="reference internal" href="zreferences.html#meijaard2007">[MPRS07]</a>
for good overviews. The benchmarked Whipple model <a class="reference internal" href="zreferences.html#meijaard2007">[MPRS07]</a> provides
a somewhat minimalistic model in a manageable analytic framework which is
capable of describing the essential dynamics such as speed dependent stability,
steer and roll coupling, and non-minimum phase behavior. I use this model as
the standard base model to work with, as the fidelity of simpler models are
generally not adequate. The model is 4th order with roll angle, steer angle,
roll rate and steer rate typically selected as the independent states and with
roll and steer torque as inputs. I neglect the roll torque input and in its
place extend the model to include a lateral force acting at a point on the
frame to provide a new input, accurately modelling imposed lateral
perturbations (see Chapter <a class="reference internal" href="extensions.html#extensions"><em>Extensions of the Whipple Model</em></a> for the details). I also examine a
second candidate model which adds inertial effects of the rider&#8217;s arms to the
Whipple model, also in Chapter <a class="reference internal" href="extensions.html#extensions"><em>Extensions of the Whipple Model</em></a>. This model was designed to
more accurately account for the fact that the riders were free to move their
arms with the front frame of the bicycle. This model is similar in fashion to
the upright rider in <a class="reference internal" href="zreferences.html#schwab2010a">[SK10a]</a>, but with slightly different joint
definitions. Constraints are chosen so that no additional degrees of freedom
are added, keeping the system both tractable and comparable to the benchmarked
Whipple model.</p>
<p>I make the assumptions that the model is (1) linear and (2) has two degrees of
freedom. The best model for a given set of data is constrained by those two
assumptions. The implications of this is that even if the model predicts the
outputs from the measured inputs it may not reflect realistic parameter values
in a first principles sense because all real systems have infinite order.
Secondly, the identified model may not map to the assumption we make in first
principles derivations about things such as joints, friction, inertia, etc.
There may exist higher order models which both fit the output data well and
better map parameter values to first principle constructs. For example, a
bicycle model with side slip at each wheel will be sixth order and if the
regression to find the best model has extra degrees of freedom in the two
additional equations, the optimal solution may be such that the numerical
values of the equation coefficients map more closely to the first principle
parameters. For example, it may be possible to make a fourth order model behave
similarly to a sixth order model with &#8220;correct&#8221; first principles parameters by
choosing unrealistic parameter values. But if the primary goal is the control
identification, rather than understanding the quality of our first principles
derivations, the model of lowest order that still fits the data well is
completely suited for the task.</p>
<p>I estimated the physical parameters of the first principles models with the
techniques described in Chapter <a class="reference internal" href="physicalparameters.html#physicalparameters"><em>Physical Parameters</em></a>. The bicycle was
measured to get accurate estimates of the parameters used in the benchmark
bicycle. Each rider&#8217;s inertial properties were estimated using Yeadon&#8217;s
<a class="reference internal" href="zreferences.html#yeadon1990">[Yea90b]</a> method which allowed easy extraction of body segment
parameters for more complicated rider biomechanic models such as the inclusion
of moving arms as described above. The parameter computation is handled with
two custom open source software packages <a class="reference internal" href="zreferences.html#dembia2011">[Dem11]</a> and
<a class="reference internal" href="zreferences.html#moore2011">[MKSH11]</a>.</p>
<div class="section" id="state-space-realization">
<span id="secstatespaceid"></span><h3>State Space Realization<a class="headerlink" href="#state-space-realization" title="Permalink to this headline">¶</a></h3>
<p>During all of the experiments there are two measured external (or exogenous)
inputs: the steer torque and the lateral force. Both inputs are generated
manually, the first from the rider and the second from the person applying the
pulsive perturbation. The outputs can be any subset of the measured kinematical
variables or combinations thereof. The problem can then be formulated as
follows: given the inputs and outputs of the system and some system structure,
what model parameters give the best prediction of the output given the measured
input. This a classic system identification problem.</p>
<div class="section" id="method">
<h4>Method<a class="headerlink" href="#method" title="Permalink to this headline">¶</a></h4>
<p>For this analysis, I limit the inputs to steer torque and lateral force and the
outputs to roll angle, steer angle, roll rate, and steer rate. The ideal fourth
order system can be described with the following continuous state space
description</p>
<div class="math" id="equation-eqConStateSpace">
<span class="eqno">(1)</span>\[\begin{split}\dot{x}(t) &amp; =
\mathbf{F}x(t) + \mathbf{G}u(t)\\
\begin{bmatrix}
  \dot{\phi} \\
  \dot{\delta} \\
  \ddot{\phi} \\
  \ddot{\delta}
\end{bmatrix}
&amp; =
\begin{bmatrix}
  0 &amp; 0 &amp; 1 &amp; 0\\
  0 &amp; 0 &amp; 0 &amp; 1\\
  a_{\ddot{\phi}\phi} &amp; a_{\ddot{\phi}\delta} &amp;
  a_{\ddot{\phi}\dot{\phi}} &amp; a_{\ddot{\phi}\dot{\delta}}\\
  a_{\ddot{\delta}\phi} &amp; a_{\ddot{\delta}\delta} &amp;
  a_{\ddot{\delta}\dot{\phi}} &amp; a_{\ddot{\delta}\dot{\delta}}
\end{bmatrix}
\begin{bmatrix}
  \phi \\
  \delta \\
  \dot{\phi} \\
  \dot{\delta}
\end{bmatrix}
+
\begin{bmatrix}
  0 &amp; 0 \\
  0 &amp; 0\\
  b_{\ddot{\phi}T_\delta} &amp; b_{\ddot{\phi}F_{c_l}}\\
  b_{\ddot{\delta}T_\delta} &amp; b_{\ddot{\delta}F_{c_l}}
\end{bmatrix}
\begin{bmatrix}
  T_\delta\\
  F
\end{bmatrix}\\
\eta(t) &amp; = \mathbf{H}x(t)\\\end{split}\]</div>
<p>where <span class="math">\(\eta(t)\)</span> are the outputs and <span class="math">\(\mathbf{H}\)</span> is the identity
matrix.</p>
<p>Assuming that this model structure can adequately capture the dynamics of
interest of the bicycle-rider system, our goal is to accurately identify the
unknown parameters <span class="math">\(\theta\)</span> which are made up of the unspecified entries
in the <span class="math">\(\mathbf{F}\)</span> and <span class="math">\(\mathbf{G}\)</span> matrices. To do this one needs
to recognize that this continuous formulation is not compatible with noisy
discrete data. The following difference equation can be assumed if we sample
the continuous system at <span class="math">\(t=kT\)</span>, <span class="math">\(k=1,2,\dots\)</span>, with <span class="math">\(T\)</span>
being the sample period and making the assumption that the variables are
constant over the sample period (i.e. zero order hold).</p>
<div class="math" id="equation-eqDisStateSpace">
<span class="eqno">(2)</span>\[\begin{split}x(kT + T) &amp; = \mathbf{A}(\theta)x(kT) + \mathbf{B}(\theta)u(kT) + w(kT)\\
y(kT) &amp; = \mathbf{C}(\theta)x(kT) + v(kT)\end{split}\]</div>
<p>The additional terms <span class="math">\(w\)</span> and <span class="math">\(v\)</span> represent the process and
measurement noise vectors, respectively, which are assumed to be sequences of
white Gaussian noise with zero mean and some covariance. By making use of the
Kalman filter, Equation <a href="#equation-eqDisStateSpace">(2)</a> can be transformed such that the
optimal estimate of the states, <span class="math">\(\hat{x}\)</span>, with respect to the process
and measurement noise covariance are utilized, see <a class="reference internal" href="zreferences.html#ljung1998">[Lju98]</a>.</p>
<div class="math" id="equation-eqInnovations">
<span class="eqno">(3)</span>\[\begin{split}\hat{x}(kT + T, \theta) &amp; = \mathbf{A}(\theta)\hat{x}(kT) +
\mathbf{B}(\theta)u(kT) + \mathbf{K}(\theta)e(kT)\\\end{split}\]\[\begin{split}y(kT) &amp; = \mathbf{C}(\theta)\hat{x}(kT) + e(kT)\end{split}\]</div>
<p>where <span class="math">\(\mathbf{K}\)</span> is the Kalman gain matrix. <span class="math">\(\mathbf{K}\)</span> is a
function of <span class="math">\(\mathbf{A}(\theta)\)</span>, <span class="math">\(\mathbf{C}(\theta)\)</span> and the
covariance and cross covariance of the process and measurement noises, but it
can also be directly parameterized by <span class="math">\(\theta\)</span>. With that, this equation
is called the <em>directly parameterized innovations form</em> <a class="reference internal" href="zreferences.html#ljung1998">[Lju98]</a> and
the entries of the four matrices in equation <a href="#equation-eqInnovations">(3)</a> can be
estimated directly.</p>
<p>The <span class="math">\(\mathbf{A}\)</span> and <span class="math">\(\mathbf{B}\)</span> matrices are related to
<span class="math">\(\mathbf{F}\)</span> and <span class="math">\(\mathbf{G}\)</span> by</p>
<div class="math" id="equation-eqDiscreteContinuous">
<span class="eqno">(4)</span>\[\mathbf{A}(\theta) = e^{\mathbf{F}(\theta)T}\]\[\mathbf{B}(\theta) = \int_{\tau=0}^T e^{\mathbf{F}(\theta)\tau}
\mathbf{G}(\theta) d\tau\]</div>
<p>where <span class="math">\(T\)</span> is the sampling period. With a linear assumption
<span class="math">\(\mathbf{A}\)</span> and <span class="math">\(\mathbf{B}\)</span> can even be directly estimated in
discrete form by</p>
<div class="math" id="equation-eqDiscreteContinuousLinear">
<span class="eqno">(5)</span>\[\mathbf{A}(\theta) = \mathbf{I} +  \mathbf{F}(\theta)T\]\[\mathbf{B}(\theta) = \int_{\tau=0}^T  (\mathbf{I} +  \mathbf{F}(\theta)\tau)
\mathbf{G}(\theta) d\tau\]</div>
<p>The one step ahead predictor for the innovations form is</p>
<div class="math" id="equation-eqOneStepInnovations">
<span class="eqno">(6)</span>\[\hat{y}(t|\theta) = \mathbf{C}(\theta) \left[q \mathbf{I} -
\mathbf{A}(\theta) + \mathbf{K}(\theta)\mathbf{C}(\theta) \right]^{-1}
\left[\mathbf{B}(\theta) u(t) + \mathbf{K}(\theta)y(t) \right]\]</div>
<p>where <span class="math">\(q\)</span> is the forward shift operator (<span class="math">\(q u(t) = u(t+1)\)</span>)
<a class="reference internal" href="zreferences.html#ljung1998">[Lju98]</a>. The predictor is a vector of length <span class="math">\(p\)</span> where each
entry is a ratio of polynomials in <span class="math">\(q\)</span>. These are transfer functions in
<span class="math">\(q\)</span> from the previous inputs and outputs to the current output. In
general, the coefficients of <span class="math">\(q\)</span> are non-linear functions of the
parameters <span class="math">\(\theta\)</span>.</p>
<p>We can now construct the cost function, which will enable the computation of
the parameters which give the best fit using optimization methods. We&#8217;d like to
minimize the error in the predicted output with respect to the measured output
at each time step. First form <span class="math">\(Y_N\)</span> which is a <span class="math">\(pN \times 1\)</span> vector
containing all of the current outputs at time <span class="math">\(kT\)</span>.</p>
<div class="math" id="equation-eqCurrentOutputs">
<span class="eqno">(7)</span>\[Y_N = \left[y_1(1) \ldots y_p(1) \ldots y_1(N) \ldots y_p(N) \right]^T\]</div>
<p>where <span class="math">\(p\)</span> is the number of outputs and <span class="math">\(N\)</span> is the number of samples.
Then organize the predictor vector, <span class="math">\(\hat{Y}_N(\theta)\)</span>, the one step ahead
prediction of <span class="math">\(Y_N\)</span> given <span class="math">\(y(s)\)</span> and <span class="math">\(u(s)\)</span> where <span class="math">\(s
\leq t - 1\)</span></p>
<div class="math" id="equation-eqPredictedOuputs">
<span class="eqno">(8)</span>\[\hat{Y}_N = \left[\hat{y}_1(1) \ldots \hat{y}_1(1) \ldots \hat{y}_p(N)
\ldots \hat{y}_p(N) \right]^T\]</div>
<p>The cost function is then the norm of the difference of <span class="math">\(Y_N\)</span> and
<span class="math">\(\hat{Y}_N(\theta)\)</span> for all <span class="math">\(k\)</span>.</p>
<div class="math" id="equation-eqCostFunction">
<span class="eqno">(9)</span>\[V_N(\theta) = \frac{1}{pN}||Y_N - \hat{Y}_N(\theta)||\]</div>
<p>The value of <span class="math">\(\theta\)</span> which minimizes the cost function is the best
prediction</p>
<div class="math" id="equation-eqParameterEstimate">
<span class="eqno">(10)</span>\[\hat{\theta}_N = \underset{x}{\operatorname{argmax}} V_N(\theta, Z^N)\]</div>
<p>where <span class="math">\(Z^N\)</span> is the set of all the measured inputs and outputs.</p>
<p>In general, the minimization problem is not trivial and may be susceptible to
many of the issues associated with optimization including local minima. The
number of unknown parameters in the <span class="math">\(\mathbf{K}\)</span> matrix is a function of
the number of states and the number of outputs, in our case in
<span class="math">\(\mathbf{R}^{4\times4}\)</span> which more than doubles the number of unknowns
present in the <span class="math">\(\mathbf{A}\)</span> and <span class="math">\(\mathbf{B}\)</span> matrices. It is thus
critical to reduce the number of unknown parameters to have a higher chance of
finding the global minimum of the cost function. The accuracy of the system
parameters depends on the ability to estimate the <span class="math">\(\mathbf{K}\)</span> matrix
along with the other parameters.</p>
<p>Before identification I further processed all of the signals that were
generally symmetric about zero by subtracting the means over time. For some of
the pavilion runs, this may have actually introduced a small bias, as the short
duration runs with unbalanced perturbations may not have zero mean.</p>
<p>I made use of the Matlab System Identification Toolbox for the identification
of the parameters <span class="math">\(\theta\)</span> in each run of this model structure. In
particular, a structured <cite>idss</cite> object was built with the initial guesses of
the unknown parameters based on the Whipple model and the initial guesses for
the initial conditions and the Kalman gain matrix being equal to zero. All of
my attempts at identifying the Kalman gain matrix were plagued by local minima.</p>
</div>
<div class="section" id="results">
<h4>Results<a class="headerlink" href="#results" title="Permalink to this headline">¶</a></h4>
<p>It turns out that finding a model that meets the criterion is not too difficult
when the output error form is considered (<span class="math">\(\mathbf{K}=0\)</span>). This model may
be able to explain the data well, but the parameter estimation is potentially
poor because the parameters in the state and input matrices are adjusted such
that the results fit both the true trajectories <em>and</em> the noise. Global minima
in the search routine are quickly found when the number of parameters is
between 10 and 14. When the <span class="math">\(\mathbf{K}\)</span> matrix is added the number of
unknown parameters increases by 16 and the global minimum becomes more
difficult to find and I was rarely able, if ever, to find the global minimum
for the general problem, even when reducing the number of outputs to one.</p>
<p><a class="reference internal" href="#figexamplefit"><em>Figure 11.7</em></a> shows typical example input and output data
for a single run (#596) with both steer torque and lateral force as inputs. The
plot compares the simulation response of the input to the measured response.
Notice that the identified model predicts the trajectory extremely well.
Similar results are found for the majority of the runs. The Whipple model
predicts the trajectory directions but the magnitudes are large, meaning that
for a given trajectory, the Whipple model requires less torque than that
measured. The Whipple model with the arm inertial effects does a better job
than the basic Whipple model, but still has some magnitude differences with
respect to the identified model. It also has a harder time predicting
the roll angle than both the identified model and the Whipple model.</p>
<div class="figure align-center" id="figexamplefit">
<a class="reference external image-reference" href="_images/example-fit.png"><img alt="_images/example-fit.png" src="_images/example-fit.png" style="width: 5in;" /></a>
<p class="caption">Example results for the identification of a single run (#596). The
experimentally measured steer torque and lateral force are shown in the top
two graphs. All of the signals were filtered with a 2nd order 15 hertz low
pass Butterworth filter. The remaining four graphs show the simulation
results for the Whipple model (W), Whipple model with the arm inertia (A),
and the identified model for that run (I) plotted with the measured data
(M). The percentages give the percent of variance explained by each model.</p>
</div>
<p>The identified models are almost always unstable due to the high weave critical
speed and, even though the measured inputs stabilize the true system, they will
not necessarily stabilize the models. This poses an issue when gauging the model
quality by the percentage variance of the output data explained by the model. A
model that blows up during the simulation may not necessarily be a bad model,
but it will return a very small percent variance and lose its ability to be
compared by that criterion. <a class="reference internal" href="zreferences.html#biral2003">[BBCL03]</a> and <a class="reference internal" href="zreferences.html#teerhuis2010">[TJ10]</a> both are able to
run feed-forward simulations of their motorcycle models with the measured
steering torque. They both are dealing with high speed motorcycles which
typically only have a slightly unstable capsize mode. <a class="reference internal" href="zreferences.html#teerhuis2010">[TJ10]</a> uses a
controller to compensate the torque for unbounded errors so that the simulation
doesn&#8217;t blow up. The method I use here is to choose short duration portions of
the runs for simulation and search for the best set of initial conditions to
keep the model stable during the duration. This generally works but there are
ultimately some incomparable runs due to this issue.</p>
<p>I use this structured state space output error identification procedure for a
collection of experiments (<span class="math">\(n=368\)</span>) over a range of speeds between about
1 and 9 m/s. Figures <a class="reference internal" href="#figacoefficients"><em>11.8</em></a> and
<a class="reference internal" href="#figbcoefficients"><em>11.9</em></a> plot the identified coefficients of the dynamical
equations of motion (i.e. the bottom two rows of the <span class="math">\(\mathbf{F}\)</span> and
<span class="math">\(\mathbf{G}\)</span> matrices) as a function of speed for all of the experiments
using box plots. Both the Whipple (green) and arm (red) model predictions are
superimposed for comparison. The first notable thing is that the
coefficients seem to generally have large variance, especially as the speed
increases. Secondly, the roll acceleration, <span class="math">\(\ddot{\phi}\)</span>,
equation seems to be better predicted by the two models and the data has less
spread at the lower speeds, barring the <span class="math">\(\dot{\phi}\)</span> coefficient which
has large spread and no apparent relationship with speed for both equations.
The roll equation also seems to have less spread in the experimental data. For
example, the <span class="math">\(a_{\ddot{\phi}\delta}\)</span> coefficient appears to be very tight
and the first principles models predict it very well. The constant, linear, and
quadratic trends in the coefficients are somewhat visible in the data but the
variance in the coefficients clouds it. This variability in the coefficient
predictions depends on many things including data quality, the ability to
identify a process noise model, speed being constant during the run, choice of
unknown coefficients, and more. With all of these improved, detailed regression
models may be able to reveal the true trends<a class="footnote-reference" href="#mixedeffects" id="id69">[4]</a>. Nonetheless,
these graphs reveal several important things:</p>
<ul class="simple">
<li>The identified models predict the data well with most having mean predicted
variance of the four outputs above 70% (but this is tightly coupled to run
duration, i.e. longer runs have more room for model error).</li>
<li>Some of the coefficients are well predicted by the Whipple model and can be
fixed from first principles calculations, notably: <span class="math">\(a_{\ddot{\phi}\phi}\)</span>,
<span class="math">\(a_{\ddot{\phi}\delta}\)</span> and <span class="math">\(b_{\ddot{\delta}T_\delta}\)</span> and maybe
even <span class="math">\(a_{\ddot{\delta}\delta}\)</span>.</li>
<li>The roll rate coefficients are highly variable with poor prediction by the
models. Deficiencies in the first principles models are likely.</li>
<li>Either the higher speed runs are outliers, or the behavior of the system
changes more rapidly with speeds above 5 m/s or so.</li>
<li>Some coefficients spread around zero giving inconsistent signs and others give
opposite signs from those the first principles models expect.</li>
</ul>
<div class="figure align-center" id="figacoefficients">
<a class="reference external image-reference" href="_images/a-matrix-box-plot.png"><img alt="_images/a-matrix-box-plot.png" src="_images/a-matrix-box-plot.png" style="width: 6.5in;" /></a>
<p class="caption">State coefficients of the linear dynamical equations of motion plotted as a
function of speed. Each box plot represents the distribution of that
parameter for a small range of speeds, i.e. speed bin. The width of the box
is proportional to the total duration of the runs in that speed bin. The
green line is the Whipple model and the red line is the arm model. Only
experiments with a mean fit percentage greater than zero are shown. The
orange line is the model identified with the canonical method using runs
done by Luke in the pavilion which is presented and discussed in the next
section. Generated by <tt class="docutils literal"><span class="pre">src/systemidentification/coefficient_box_plot.py</span></tt>.</p>
</div>
<div class="figure align-center" id="figbcoefficients">
<a class="reference external image-reference" href="_images/b-matrix-box-plot.png"><img alt="_images/b-matrix-box-plot.png" src="_images/b-matrix-box-plot.png" style="width: 6in;" /></a>
<p class="caption">Input coefficients of the linear dynamical equations of motion plotted as a
function of speed. Each box plot represents the distribution of that
parameter for a small range of speeds, i.e. speed bin. The width of the box
is proportional to the total duration of the runs in that speed bin. The
green line is the Whipple model and the red line is the arm model. Only
experiments with a mean fit percentage greater than zero are shown. The
orange line is the model identified with the canonical method using runs
done by Luke in the pavilion which is presented and discussed in the next
section. Generated by <tt class="docutils literal"><span class="pre">src/systemidentification/coefficient_box_plot.py</span></tt>.</p>
</div>
<p><a class="reference internal" href="#figstatespacebode"><em>Figure 11.10</em></a> gives another view of the resulting
data. It is a frequency response plot at the mean speed for a set of runs. The
blue lines give the mean and one standard deviation bounds of the magnitude and
phase of the system transfer function <span class="math">\(\frac{\phi}{T_\delta}(s)\)</span> for the
set of runs. Even though the spread in the identified parameters seems high in
Figures <a class="reference internal" href="#figacoefficients"><em>11.8</em></a> and <a class="reference internal" href="#figacoefficients"><em>11.9</em></a>, the
Bode plot shows that the identified system frequency response is not as
variable, especially in magnitude. It is also apparent that the experimental
magnitude mean has a -5 to -10 dB offset across the frequency range shown with
respect to the Whipple model, although the Whipple model does fall within one
standard deviation of the mean. This correlates with the amplitude differences
in the trajectories shown in <a class="reference internal" href="#figexamplefit"><em>Figure 11.7</em></a>. Notice that the
arm model has little to no offset between 2 and 10 rad/s, thus the better
amplitude matching. The frequency response may give a better indication of the
overall identified model quality.</p>
<div class="figure align-center" id="figstatespacebode">
<a class="reference external image-reference" href="_images/state-space-bode.png"><img alt="_images/state-space-bode.png" src="_images/state-space-bode.png" style="width: 5in;" /></a>
<p class="caption">Frequency response of steer torque to roll angle for a set of runs at
<span class="math">\(4.0 \pm 0.3\)</span> m/s. The solid blue line is the mean from the identified
runs and is bounded by the standard deviation, the dotted blue lines. The
green line is the Whipple model and the red line is for the model which
accounted for the arm inertial effects.</p>
</div>
</div>
<div class="section" id="id70">
<h4>Conclusion<a class="headerlink" href="#id70" title="Permalink to this headline">¶</a></h4>
<p>I have shown that a fourth order structured state space model is both adequate
for describing the motion of the bicycle under manual control in a speed range
from approximately 1.5 m/s to 9 m/s. The fact that higher order models may not
be necessary for bicycle dynamic description is an important finding. More
robust models of single track vehicles are typically higher than 4th order,
with degrees of freedom associated with tire slip, frame flexibilities, and
rider biomechanics. These findings suggest that the more complex models may be
overkill for many modeling purposes. The data subsequently also reveals that
fourth order archetypal first principles models are not robust enough to fully
describe the dynamics. The deficiencies are most likely due to un-modeled
effects, with the knife-edge, no side-slip wheel contact assumptions being the
most probable candidate. Un-modeled rider biomechanics such as passive arm
stiffness and damping and head motion may play a role too. The uncertainty in
the estimates of the physical parameters from Chapter <a class="reference internal" href="physicalparameters.html#physicalparameters"><em>Physical Parameters</em></a>
is not large enough to explain the difference between the identified
coefficient identification and their predictions from first principles. It is
likely that something as simple as a &#8220;static&#8221; tire scrub torque is needed to
improve the fidelity of the first principles derivations, but that doesn&#8217;t
preclude that the additional of a tire slip model might also improve the
models.</p>
</div>
</div>
<div class="section" id="canonical-identification">
<span id="seccanonicalid"></span><h3>Canonical Identification<a class="headerlink" href="#canonical-identification" title="Permalink to this headline">¶</a></h3>
<p>One issue I faced with the state space realization was dealing with multiple
experiments. Ideally I had hoped to identify a linear model that was a function
of speed with respect to all or various subsets of the experiments. It is
possible to concatenate runs, but discontinuities in the data potentially
disrupt the identification. There is also the possibility of designing a cost
function that gives the error in all the outputs across all of the runs
simultaneously instead of on a per run basis. Both my recently obtained
knowledge in system identification and the constraints of the methods available
in the Matlab System Identification toolbox were limiting factors in these two
approaches. But, Karl Åström suggested doing the system identification with
respect to the second order form of the equations of motion. This would allow
one to use both simple least squares for the solution and the ability to
compute models from large sets of runs. This section deals with this approach.</p>
<div class="section" id="model-structure">
<h4>Model structure<a class="headerlink" href="#model-structure" title="Permalink to this headline">¶</a></h4>
<p>The identification of the linear dynamics of the bicycle can be formulated with
respect to the benchmark canonical form realized in <a class="reference internal" href="zreferences.html#meijaard2007">[MPRS07]</a>,
Equation <a href="#equation-eqCanonical">(11)</a>. If the time varying quantities in the equations are
all known at each time step, the coefficients of the linear equations can be
estimated given enough time steps.</p>
<div class="math" id="equation-eqCanonical">
<span class="eqno">(11)</span>\[\mathbf{M} \ddot{q} + v \mathbf{C}_1 \dot{q} + [g \mathbf{K}_0 + v^2
\mathbf{K}_2] q = T\]</div>
<p>where the time-varying states roll and steer are collected in the vector
<span class="math">\(q = [\phi \quad \delta]^T\)</span> and the time varying inputs roll torque and
steer torque are collected in the vector <span class="math">\(T = [T_\phi \quad T_\delta]^T\)</span>.
This equation assumes that the velocity is constant with respect to time as
the model was linearized about a constant velocity equilibrium, but the
velocity can also potentially be treated as a time varying parameter if the
acceleration is negligible. I extend the equations to properly account for the
lateral perturbation force, <span class="math">\(F\)</span>, which was the actual input we delivered
during the experiments. It contributes to both the roll torque and steer torque
equations.</p>
<div class="math" id="equation-eqExtendedCanonical">
<span class="eqno">(12)</span>\[\mathbf{M} \ddot{q} + v \mathbf{C}_1 \dot{q} + [g \mathbf{K}_0 + v^2
\mathbf{K}_2] q = T + H F\]</div>
<p>where <span class="math">\(H = [H_{\phi F} \quad H_{\delta F}]^T\)</span> is a vector describing the
linear contribution of the lateral force to the roll and steer torque
equations. <span class="math">\(H_{\phi F}\)</span> is approximately the distance from the ground to
the force application point. <span class="math">\(H_{\delta F}\)</span> is a distance that is a
function of the bicycle geometry (trail, wheelbase) and the longitudinal
location of the force application point. For our normal geometry bicycles,
including the one used in the experiments, <span class="math">\(H_{\delta F} &lt;&lt; H_{\phi F}\)</span>.
I estimate <span class="math">\(H\)</span> for each rider/bicycle from geometrical measurements and
the state space form of the linear equations of motion calculated in Chapter
<a class="reference internal" href="extensions.html#extensions"><em>Extensions of the Whipple Model</em></a>.</p>
<div class="math" id="equation-eqStateSpace">
<span class="eqno">(13)</span>\[\dot{x} = \mathbf{A} x + \mathbf{B} u\]</div>
<p>where <span class="math">\(x = [\phi \quad \delta \quad \dot{\phi} \quad \dot{\delta}]^T\)</span> and
<span class="math">\(u = [F \quad T_\phi \quad T_\delta]^T\)</span>. The state and input matrices can
be partitioned.</p>
<div class="math" id="equation-eqStateMatrx">
<span class="eqno">(14)</span>\[\begin{split}\mathbf{A} =
\begin{bmatrix}
  0 &amp; \mathbf{I} \\
  \mathbf{A}_l &amp; \mathbf{A}_r
\end{bmatrix}\end{split}\]</div>
<div class="math" id="equation-eqInputMatrix">
<span class="eqno">(15)</span>\[\begin{split}\mathbf{B} =
\begin{bmatrix}
  0 &amp; 0\\
  \mathbf{B}_F &amp; \mathbf{B}_T
\end{bmatrix}\end{split}\]</div>
<p>where <span class="math">\(\mathbf{A}_l\)</span> and <span class="math">\(\mathbf{A}_r\)</span> are the 2 x 2 sub-matrices
corresponding to the states and their derivatives, respectively.
<span class="math">\(\mathbf{B}_F\)</span> and <span class="math">\(\mathbf{B}_T\)</span> are the 2 x 1 and 2 x 2
sub-matrices corresponding to the lateral force and the torques, respectively.
The benchmark canonical form can now be written as</p>
<div class="math" id="equation-eqCanonInState">
<span class="eqno">(16)</span>\[\mathbf{B}_T^{-1} [ \ddot{q} - \mathbf{A}_r \dot{q} - \mathbf{A}_l q] = T +
\mathbf{B}_T^{-1} \mathbf{B}_F F\]</div>
<p>where</p>
<div class="math" id="equation-eqCanonStateRelation">
<span class="eqno">(17)</span>\[\mathbf{M} = \mathbf{B}_T^{-1}\]\[v \mathbf{C}_1 = -\mathbf{B}_T^{-1} \mathbf{A}_r\]\[[g \mathbf{K}_0 + v^2 \mathbf{K}_2] = -\mathbf{B}_T^{-1} \mathbf{A}_l\]\[H = \mathbf{B}_T^{-1} \mathbf{B}_F\]</div>
<table border="1" class="docutils">
<caption>The location of the lateral force point for each rider.</caption>
<colgroup>
<col width="50%" />
<col width="50%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Rider</td>
<td><span class="math">\(H\)</span></td>
</tr>
<tr class="row-even"><td>Charlie</td>
<td><span class="math">\([0.902 \quad 0.011]^T\)</span> m</td>
</tr>
<tr class="row-odd"><td>Jason</td>
<td><span class="math">\([0.943 \quad 0.011]^T\)</span> m</td>
</tr>
<tr class="row-even"><td>Luke</td>
<td><span class="math">\([0.902 \quad 0.011]^T\)</span> m</td>
</tr>
</tbody>
</table>
<p>The location of the lateral force application point is the same for Charlie and
Luke because they used the same seat height. The force was applied just below
the seat, which was adjustable in height for different riders.</p>
</div>
<div class="section" id="data-processing">
<h4>Data processing<a class="headerlink" href="#data-processing" title="Permalink to this headline">¶</a></h4>
<p>Chapter <a class="reference internal" href="davisbicycle.html#davisbicycle"><em>Davis Instrumented Bicycle</em></a> details how each of the signals were measured and
processed. For the following analysis, all of the signals were filtered with a
second order low pass Butterworth filter at 15 Hz. The roll and steer
accelerations were computed by numerically differentiating the roll and steer
rate signals with a central differencing method except for the end points being
handled by forward and backward differencing. The mean was subtracted from all
the signals except the lateral force.</p>
</div>
<div class="section" id="identification">
<h4>Identification<a class="headerlink" href="#identification" title="Permalink to this headline">¶</a></h4>
<p>A simple analytic identification problem can be formulated from the canonical
form. If we have good measurements of <span class="math">\(q\)</span>, their first and second
derivatives, forward speed <span class="math">\(v\)</span>, and the inputs <span class="math">\(T_\delta\)</span> and
<span class="math">\(F\)</span>, the entries in <span class="math">\(\mathbf{M}\)</span>, <span class="math">\(\mathbf{C}_1\)</span>,
<span class="math">\(\mathbf{K}_0\)</span>, <span class="math">\(\mathbf{K}_2\)</span>, and <span class="math">\(H\)</span> can be identified by
forming two simple regressions, i.e. one for each equation in the canonical
form. I use the instantaneous speed at each time step rather than the mean over
a run to improve accuracy with respect to the speed parameter as it has some
variability.</p>
<p>The roll and steer equation each can be put into a simple linear form</p>
<div class="math" id="equation-eqAxEB">
<span class="eqno">(18)</span>\[\mathbf{\Gamma} \Theta = Y\]</div>
<p>where <span class="math">\(\Theta\)</span> is a vector of the unknown coefficients and
<span class="math">\(\mathbf{\Gamma}\)</span> and <span class="math">\(Y\)</span> are made up of the inputs and outputs
measured during a run. <span class="math">\(\Theta\)</span> can be all or a subset of the entries in
the canonical matrices. If there are <span class="math">\(N\)</span> samples in a run and we desire
to find <span class="math">\(M\)</span> entries in the equation, then <span class="math">\(\mathbf{\Gamma}\)</span> is an
<span class="math">\(N \times M\)</span> matrix and <span class="math">\(Y\)</span> is an <span class="math">\(N \times 1\)</span> vector. The
Moore-Penrose pseudo inverse can be employed to solve for <span class="math">\(\Theta\)</span>
analytically. The estimate of the unknown parameters is then</p>
<div class="math" id="equation-eqThetaEstimate">
<span class="eqno">(19)</span>\[\hat{\Theta} = [\mathbf{\Gamma}^T \mathbf{\Gamma}]^{-1} \mathbf{\Gamma}^T Y\]</div>
<p>For example, if we fix the mass terms in the steer torque equation and let the
rest be free the linear equation is</p>
<div class="math" id="equation-eqExampleLeastSquares">
<span class="eqno">(20)</span>\[\begin{split}\begin{bmatrix}
   v(1) \dot{\phi}(1) &amp; v(1) \dot{\delta}(1) &amp; g \phi(1) &amp; g \delta(1) &amp;
   v(1)^2 \phi(1) &amp; v(1)^2 \delta(1) &amp; - F(1)\\
   \vdots &amp; \vdots &amp; \vdots &amp; \vdots &amp; \vdots &amp; \vdots &amp; \vdots\\
   v(N) \dot{\phi}(N) &amp; v(N) \dot{\delta}(N) &amp; g \phi(N) &amp; g \delta(N) &amp;
   v(N)^2 \phi(N) &amp; v(N)^2 \delta(N) &amp; - F(N)\\
\end{bmatrix}
\begin{bmatrix}
  C_{1\delta\phi}\\
  C_{1\delta\delta}\\
  K_{0\delta\phi}\\
  K_{0\delta\delta}\\
  K_{2\delta\phi}\\
  K_{2\delta\delta}\\
  H_{\delta F}
\end{bmatrix} \\
=
\begin{bmatrix}
  T_\delta(1) - M_{\delta\phi} \ddot{\phi}(1) -
  M_{\delta\delta} \ddot{\delta}(1)\\
  \vdots\\
  T_\delta(N) - M_{\delta\phi} \ddot{\phi}(N) -
  M_{\delta\delta} \ddot{\delta}(N)
\end{bmatrix}\end{split}\]</div>
<p>The error in the fit is</p>
<div class="math" id="equation-eqFitError">
<span class="eqno">(21)</span>\[\epsilon = \hat{Y} - Y = \mathbf{\Gamma} \hat{\Theta} - Y\]</div>
<p>The covariance of <span class="math">\(\Theta\)</span>, Equation <a href="#equation-eqCovariance">(23)</a>, of the parameter
estimations can be computed with respect to the error.</p>
<div class="math" id="equation-eqVariance">
<span class="eqno">(22)</span>\[\sigma^2 = \frac{\epsilon^T\epsilon}{N - d}\]</div>
<div class="math" id="equation-eqCovariance">
<span class="eqno">(23)</span>\[\mathbf{U} = \sigma^2 (\mathbf{\Gamma}^T \mathbf{\Gamma})^{-1}\]</div>
<p>Equations <a href="#equation-eqThetaEstimate">(19)</a>, <a href="#equation-eqFitError">(21)</a>, <a href="#equation-eqVariance">(22)</a>, and
<a href="#equation-eqCovariance">(23)</a> can be solved for each run individually, a portion of a run,
or a set of runs. Secondly, all of the parameters in the canonical matrices
need not be estimated. The analytical benchmark bicycle model <a class="reference internal" href="zreferences.html#meijaard2007">[MPRS07]</a>
gives a good idea of which entries in the matrices we may be more certain about
from our physical parameters measurements in Chapter <a class="reference internal" href="physicalparameters.html#physicalparameters"><em>Physical Parameters</em></a>.
I went through the benchmark formulation and fixed the parameters based on
these rules, keeping in mind that even little numbers can have large effects to
the resulting dynamics:</p>
<ul class="simple">
<li>If the parameter is greatly affected by trail, leave it free.</li>
<li>If the parameter is greatly affected by the front assembly moments and
products of inertia, leave it free.</li>
<li>If the parameter is identically equal to zero, fix it.</li>
</ul>
<p>The reasoning for these assumptions are:</p>
<ul class="simple">
<li>Trail is difficult to measure and be certain about, especially since the
bicycle tire deforms and creates a variable shaped tire contact patch which
depends on the tires properties, pressure, and the configuration of the
bicycle. The true trail is what is typically called pneumatic trail and gives
the location in the tire patch at which the resultant contact force acts.</li>
<li>The front frame moments and products of inertia play a large role in the
steer dynamics and I&#8217;m not as confident in the estimation of these due to the
fact that our apparatus was more suited to the estimate the inertial properties of the rear frame
than the front.</li>
<li>The zero entries in the velocity dependent stiffness and damping matrices
that correspond to the roll angle and rate are assumed to hold from first
principles.</li>
</ul>
<p>For the roll equation this leaves <span class="math">\(M_{\phi\delta}\)</span>,
<span class="math">\(C_{1\phi\delta}\)</span>, and <span class="math">\(K_{0\phi\delta}\)</span> as free parameters, and
for the steer equation this leaves <span class="math">\(M_{\delta\phi}\)</span>,
<span class="math">\(M_{\delta\delta}\)</span>, <span class="math">\(C_{1\delta\phi}\)</span>, <span class="math">\(C_{1\delta\delta}\)</span>,
<span class="math">\(K_{0\delta\phi}\)</span>, <span class="math">\(K_{0\delta\delta}\)</span>, <span class="math">\(K_{2\delta\delta}\)</span>,
and <span class="math">\(H_{\delta F}\)</span> as free parameters.</p>
<p>I start by identifying the three coefficients of the roll equation for the
given data. This choice is due to there being more certainty in the roll
equation estimates from first principles because there are fewer unknown
parameters.</p>
<div class="math" id="equation-eqRollEquation">
<span class="eqno">(24)</span>\[\begin{split}\begin{bmatrix}
   \ddot{\delta}(1) &amp;
   v(1) \dot{\delta}(1) &amp;
   g \delta(1) \\
   \vdots &amp; \vdots &amp; \vdots\\
   \ddot{\delta}(N) &amp;
   v(N) \dot{\delta}(N) &amp;
   g \delta(N) \\
\end{bmatrix}
\begin{bmatrix}
  M_{\phi\delta} \\
  C_{1\phi\delta} \\
  K_{0\phi\delta}
\end{bmatrix} \\
=
\begin{bmatrix}
  H_{\phi F} F(1)
  - M_{\phi\phi} \ddot{\phi}(1)
  - C_{1\phi\phi} v(1) \dot{\phi}(1)
  - K_{0\phi\phi} g \phi(1)
  - K_{2\phi\phi} v(1)^2 \phi(1)
  - K_{2\phi\delta} v(1)^2 \delta(1) \\
\vdots\\
  H_{\phi F} F(N)
  - M_{\phi\phi} \ddot{\phi}(N)
  - C_{N\phi\phi} v(N) \dot{\phi}(N)
  - K_{0\phi\phi} g \phi(N)
  - K_{2\phi\phi} v(N)^2 \phi(N)
  - K_{2\phi\delta} v(N)^2 \delta(N) \\
\end{bmatrix}\end{split}\]</div>
<p>I then enforce the assumptions that <span class="math">\(M_{\phi\delta} = M_{\delta\phi}\)</span> and
<span class="math">\(K_{0\phi\delta} = K_{0\delta\phi}\)</span> to fix these values in the steer
equation to the ones identified in the roll equation, leaving fewer free
parameters in the steer equation<a class="footnote-reference" href="#symmetry" id="id73">[5]</a>. This symmetry is enforced to
coincide with the theory and choice of coordinates. Finally, I identify the
remaining steer equation coefficients with</p>
<div class="math" id="equation-eqSteerEquation">
<span class="eqno">(25)</span>\[\begin{split}\begin{bmatrix}
  \ddot{\delta}(1) &amp;
  v(1) \dot{\phi}(1) &amp;
  v(1) \dot{\delta}(1) &amp;
  g \phi(1) &amp;
  v(1)^2 \delta(1) &amp;
  - F(1)\\
  \vdots &amp; \vdots &amp; \vdots &amp; \vdots &amp; \vdots &amp; \vdots \\
  \ddot{\delta}(N) &amp;
  v(N) \dot{\phi}(N) &amp;
  v(N) \dot{\delta}(N) &amp;
  g \phi(N) &amp;
  v(N)^2 \delta(N) &amp;
  - F(N)\\
\end{bmatrix}
\begin{bmatrix}
  M_{\delta\delta} \\
  C_{1\delta\phi} \\
  C_{1\delta\delta} \\
  K_{0\delta\phi} \\
  K_{2\delta\delta} \\
  H_{\delta F}
\end{bmatrix} \\
=
\begin{bmatrix}
  T_\delta(1)
  - M_{\delta\phi} \ddot{\phi}(1)
  - K_{0\delta\delta} g \delta(1)
  - K_{2\delta\phi} v(1)^2 \phi(1) \\
  \vdots\\
  T_\delta(N)
  - M_{\delta\phi} \ddot{\phi}(N)
  - K_{0\delta\delta} g \delta(N)
  - K_{2\delta\phi} v(N)^2 \phi(N) \\
\end{bmatrix}\end{split}\]</div>
</div>
<div class="section" id="id74">
<h4>Results<a class="headerlink" href="#id74" title="Permalink to this headline">¶</a></h4>
<p>I selected data for three riders on the same bicycle, performing two maneuvers,
in two different environments. There is little reason to believe the dynamics of
the passive system should vary much with respect to different maneuvers, but
there is potentially variation across riders due to the differences in their
inertial properties and there may be variation across environments because of
the differences in the wheel to floor interaction. I opted to compute the best
fit model across series of runs to benefit from the large dataset. This leaves
these four scenarios:</p>
<ul class="simple">
<li>All riders in both environments, one data set</li>
<li>All riders in each environment, two data sets</li>
<li>Each rider in both environments, three data sets</li>
<li>Each rider in each environment, six data sets</li>
</ul>
<table border="1" class="docutils">
<caption>The number of runs and time samples in each data subset.</caption>
<colgroup>
<col width="25%" />
<col width="25%" />
<col width="25%" />
<col width="25%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Rider</td>
<td>Environment</td>
<td>Number of runs</td>
<td>Number of time samples, <span class="math">\(N\)</span></td>
</tr>
<tr class="row-even"><td>(C)harlie</td>
<td>(H)orse treadmill</td>
<td>24</td>
<td>267773</td>
</tr>
<tr class="row-odd"><td>(C)harlie</td>
<td>(P)avilion</td>
<td>87</td>
<td>118700</td>
</tr>
<tr class="row-even"><td>(C)harlie</td>
<td>(A)ll</td>
<td>111</td>
<td>386473</td>
</tr>
<tr class="row-odd"><td>(J)ason</td>
<td>(H)orse treadmill</td>
<td>57</td>
<td>804995</td>
</tr>
<tr class="row-even"><td>(J)ason</td>
<td>(P)avilion</td>
<td>93</td>
<td>112582</td>
</tr>
<tr class="row-odd"><td>(J)ason</td>
<td>(A)ll</td>
<td>150</td>
<td>917577</td>
</tr>
<tr class="row-even"><td>(L)uke</td>
<td>(H)orse treadmill</td>
<td>25</td>
<td>272719</td>
</tr>
<tr class="row-odd"><td>(L)uke</td>
<td>(P)avilion</td>
<td>88</td>
<td>125878</td>
</tr>
<tr class="row-even"><td>(L)uke</td>
<td>(A)ll</td>
<td>113</td>
<td>398597</td>
</tr>
<tr class="row-odd"><td>(A)ll</td>
<td>(H)orse treadmill</td>
<td>106</td>
<td>1345487</td>
</tr>
<tr class="row-even"><td>(A)ll</td>
<td>(P)avilion</td>
<td>268</td>
<td>357160</td>
</tr>
<tr class="row-odd"><td>(A)ll</td>
<td>(A)ll</td>
<td>374</td>
<td>1702647</td>
</tr>
</tbody>
</table>
<p>A total of 12 different models can be derived from this perspective.</p>
</div>
<div class="section" id="all-riders-in-both-environments">
<h4>All riders in both environments<a class="headerlink" href="#all-riders-in-both-environments" title="Permalink to this headline">¶</a></h4>
<p>This section details the example results for one subset of data. Here I make
the assumption that the best fit model doesn&#8217;t vary much across riders or
environments. The assumption that the passive model of the bicycle and rider
are similar with respect to rider can be justified by recognizing that the
Whipple model predicts little difference in the dynamics with respect to the
three bicycle/rider combinations. On the other hand, I have little reason to
believe the environments are the same except that both floors are made of a
rubber like material. I calculated the best fit over 374 runs giving about 142
minutes of data sampled at 200 Hz, <span class="math">\(N=1720647\)</span>.</p>
<p>The eigenvalues as a function of speed of the identified model can be compared
to those of the Whipple and arm models, see Section <a class="reference internal" href="extensions.html#secriderarms"><em>Rider Arms</em></a> in
Chapter <a class="reference internal" href="extensions.html#extensions"><em>Extensions of the Whipple Model</em></a>. <a class="reference internal" href="#figaarloc"><em>Figure 11.11</em></a> shows the root locus
of the three models. The oscillatory weave mode exists in all three models,
with it always being stable in the arm model but being unstable at lower speeds
in the other two models. The identified model&#8217;s oscillatory weave mode is
unstable over most of the shown speed range. Above 3 m/s or so, the Whipple
model&#8217;s oscillatory weave mode diverges from the identified model to different
asymptotes. The arm model weave mode diverges somewhere in between. Note that
the arm model has an unstable real mode for all speeds. <a class="reference internal" href="#figaaeig"><em>Figure
11.12</em></a> gives a different view of the root locus allowing one to more
easily compare the real parts of the eigenvalues. The imaginary parts of the
weave mode have similar curvature with respect to speed for all the models,
with the identified model having about 1 rad/s larger frequency of oscillation
for all speeds. The identified model does have a stable speed range where the
Whipple model under predicts the weave critical speed by almost 2 m/s. The
identified caster mode is much faster than the one predicted by the Whipple
model which is somewhat counterintuitive because tire scrub torques would
probably tend to slow the caster mode. Although, the pneumatic trail and the
rider&#8217;s arm inertia could play a larger role that expected. Furthermore, the
caster mode may not be well identified because the experiments were not design
to specifically excite it.</p>
<div class="figure align-center" id="figaarloc">
<a class="reference external image-reference" href="_images/A-A-rlocus.png"><img alt="_images/A-A-rlocus.png" src="_images/A-A-rlocus.png" style="width: 4in;" /></a>
<p class="caption">Root locus of the identified model (circle), the Whipple model (diamond),
and the arm model (triangle) with respect to speed in m/s. Generated by
<cite>src/systemidentification/canonical_plots.py</cite>.</p>
</div>
<div class="figure align-center" id="figaaeig">
<a class="reference external image-reference" href="_images/A-A-eig.png"><img alt="_images/A-A-eig.png" src="_images/A-A-eig.png" style="width: 5in;" /></a>
<p class="caption">Real and imaginary parts of the eigenvalues as a function of speed for model
(I)dentified from all runs, the (W)hipple model and the (A)rm model. Generated by
<cite>src/systemidentification/canonical_plots.py</cite>.</p>
</div>
<p>The identification process is based on identifying the input/output
relationships among measured variables. The frequency response provides a view
into these relationships. Figures <a class="reference internal" href="#figaatphiphi"><em>11.13</em></a> to
<a class="reference internal" href="#figaatdeldel"><em>11.16</em></a> give a picture of how the first principles models
compare to the identified model with respect to frequency response from a roll
torque input. The frequency band from 1 rad/s to 12 rad/s is of most concern as
it bounds a reasonable range that the human may be able to operate within.</p>
<p>The roll torque to roll angle response <a class="reference internal" href="#figaatphiphi"><em>Figure 11.13</em></a> shows
that at 2 m/s (solid lines) the response of the Whipple model and the
identified model are practically identical across the frequency range shown. On
the other hand, the arm model predicts the high frequency (&gt; 4 rad/s) behavior
really well, but the magnitude is as great as 50 dB larger and the phase off by
180 degrees at lower frequencies. At 4 m/s the Whipple model still predicts the
phase well, but the magnitudes do not match below 100 rad/s with 10 dB
difference at lower frequencies. At this speed the arm model matches the
identified model as low as 3.5 rad/s but the low frequency phase still being
180 degrees off. The magnitude of the identified model stays quite constant
among the 4, 6, and 9 m/s models. As the speed increases the Whipple and arm
models are less predictive of the identified model at low frequencies, but tend
to match out past 4 rad/s or so.</p>
<div class="figure align-center" id="figaatphiphi">
<a class="reference external image-reference" href="_images/A-A-Tphi-Phi.png"><img alt="_images/A-A-Tphi-Phi.png" src="_images/A-A-Tphi-Phi.png" style="width: 5in;" /></a>
<p class="caption"><span class="math">\(\frac{\phi}{T_\phi}\)</span> frequency response of the three models,
(I)dentified, (W)hipple, and (A)rm, at four speeds (2, 4, 6, and 9 m/s). The
color indicates the model and the line type indicates the speed. Generated
by <cite>src/systemidentification/canonical_plots.py</cite>.</p>
</div>
<p><a class="reference internal" href="#figaatphidel"><em>Figure 11.14</em></a> shows the steer angle response with respect
to the roll torque. Once again the Whipple model is almost identical to the
identified model at the lowest speed, 2 m/s. The arm model has about a +5 dB
offset at low frequencies and a -10 dB offset at high frequencies with the
models only being similar just around 4 rad/s. At 9 m/s the Whipple model has
similar magnitude and phase above 7 rad/s whereas the low frequency shows that
the Whipple model has up to +30 dB magnitude difference with respect to the
identified model. The arm model behaves in much the same way at 9 m/s.</p>
<div class="figure align-center" id="figaatphidel">
<a class="reference external image-reference" href="_images/A-A-Tphi-Del.png"><img alt="_images/A-A-Tphi-Del.png" src="_images/A-A-Tphi-Del.png" style="width: 5in;" /></a>
<p class="caption"><span class="math">\(\frac{\delta}{T_\phi}\)</span> frequency response of the three models,
(I)dentified, (W)hipple, and (A)rm, at four speeds (2, 4, 6, and 9 m/s). The
color indicates the model and the line type indicates the speed. Generated
by <cite>src/systemidentification/canonical_plots.py</cite>.</p>
</div>
<p>The steer torque to roll angle transfer function, <a class="reference internal" href="#figaatdelphi"><em>Figure
11.15</em></a> may be the most important to model accurately as it is the
primary method of controlling the bicycle&#8217;s direction, i.e. commanding roll
allows one to command yaw. At 2 m/s the Whipple model magnitude matches at
lower frequencies (&lt; 4 rad/s) better and the arm model better at higher
frequencies (&gt; 4 rad/s). A 4 m/s and above the magnitude of identified varies
little with speed, which contrasts the stronger speed dependence of the first
principles models. The low frequency behavior of the identified model is not
well predicted by the Whipple and arm models at the three highest speeds but
about about 3 rad/s the arm model shows better magnitude matches than the
Whipple model.</p>
<div class="figure align-center" id="figaatdelphi">
<a class="reference external image-reference" href="_images/A-A-Tdel-Phi.png"><img alt="_images/A-A-Tdel-Phi.png" src="_images/A-A-Tdel-Phi.png" style="width: 5in;" /></a>
<p class="caption">Frequency response of the three models, (I)dentified, (W)hipple, and (A)rm,
at four speeds (2, 4, 6, and 9 m/s). The color indicates the model and the
line type indicates the speed. Generated by
<cite>src/systemidentification/canonical_plots.py</cite>.</p>
</div>
<p>The steer torque to steer angle frequency response, <a class="reference internal" href="#figaatdeldel"><em>Figure
11.16</em></a>, shows that at speeds above 2 m/s the first principle
models do not predict the response well at low frequencies. The response
changes more drastically with respect to speed for the first principles models
than for the identified model.</p>
<div class="figure align-center" id="figaatdeldel">
<a class="reference external image-reference" href="_images/A-A-Tdel-Del.png"><img alt="_images/A-A-Tdel-Del.png" src="_images/A-A-Tdel-Del.png" style="width: 5in;" /></a>
<p class="caption">Frequency response of the three models at four speeds. The color indicates
the model and the line type indicates the speed. Generated by
<cite>src/systemidentification/canonical_plots.py</cite>.</p>
</div>
</div>
<div class="section" id="comparison-of-identified-models">
<h4>Comparison of identified models<a class="headerlink" href="#comparison-of-identified-models" title="Permalink to this headline">¶</a></h4>
<p>Tables <a class="reference internal" href="#tabidmckone"><em>11.3</em></a>, <a class="reference internal" href="#tabidmcktwo"><em>11.4</em></a>, and
<a class="reference internal" href="#tabidmckthree"><em>11.5</em></a> present the identified canonical coefficient values
from all twelve of the chosen data subsets. The variances of the coefficient
estimates with respect to how well the model fits the data in the steer
equation are quite low except for the <span class="math">\(H_{\delta F}\)</span> parameter. The low
variance is partially due to the large datasets but also due to the quality of
the resulting fits. The <span class="math">\(H_{\delta F}\)</span> is highly dependent on the trail
which is expected to be difficult to identify. The coefficient estimates are
not all repeatable among the data subsets. In particular
<span class="math">\(C_{1\delta\phi}\)</span> and <span class="math">\(H_{\delta F}\)</span> have the largest relative
variance among the models (&gt; 62%). <span class="math">\(M_{\delta\delta}\)</span>,
<span class="math">\(C_{1\phi\delta}\)</span>, <span class="math">\(C_{1\delta\delta}\)</span>, and
<span class="math">\(K_{2\delta\delta}\)</span> are the most consistent among the models (&lt; 18%)
with the remaining coefficients falling somewhere in between. This is odd
because these data sets are not independent of one another where some are
subsets of the others but once again the identification procedure does not
explicitly account for process noise and the coefficient estimates reflect
this. A sensitivity study for each coefficient with respect to the various
physical parameters could help reveal which parameters less likely fit into the
Whipple model mold.</p>
<table border="1" class="docutils">
<caption>Identified coefficients of the benchmark bicycle model for various
sets of data. The first column indicates which rider&#8217;s runs were used:
(C)harlie, (J)ason, (L)uke or (A)ll. The second column indicates which
environment&#8217;s runs were used: (P)avilion Floor, (H)orse Treadmill, or (A)ll.
The remaining columns give the resulting numerical value of the identified
parameter, its standard deviation with respect to the model fit, and the
percent difference with respect to the value predicted by the Whipple model.
Table generated by <cite>src/systemidentification/canonical_tables.py</cite>.</caption>
<colgroup>
<col width="3%" />
<col width="3%" />
<col width="7%" />
<col width="16%" />
<col width="8%" />
<col width="7%" />
<col width="16%" />
<col width="8%" />
<col width="7%" />
<col width="16%" />
<col width="8%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head" colspan="2">&nbsp;</th>
<th class="head" colspan="3"><span class="math">\(M_{\phi\delta}\)</span></th>
<th class="head" colspan="3"><span class="math">\(C_{1\phi\delta}\)</span></th>
<th class="head" colspan="3"><span class="math">\(K_{0\phi\delta}\)</span></th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>R</td>
<td>E</td>
<td>Value</td>
<td><span class="math">\(\sigma\)</span></td>
<td>% Diff</td>
<td>Value</td>
<td><span class="math">\(\sigma\)</span></td>
<td>% Diff</td>
<td>Value</td>
<td><span class="math">\(\sigma\)</span></td>
<td>% Diff</td>
</tr>
<tr class="row-odd"><td>A</td>
<td>H</td>
<td>1.659</td>
<td>0.010</td>
<td>-27.6%</td>
<td>21.35</td>
<td>0.02</td>
<td>-49.3%</td>
<td>-5.29</td>
<td>0.06</td>
<td>123.2%</td>
</tr>
<tr class="row-even"><td>C</td>
<td>H</td>
<td>3.36</td>
<td>0.02</td>
<td>54.4%</td>
<td>20.05</td>
<td>0.04</td>
<td>-49.8%</td>
<td>-0.1</td>
<td>0.1</td>
<td>-96.5%</td>
</tr>
<tr class="row-odd"><td>L</td>
<td>P</td>
<td>2.56</td>
<td>0.03</td>
<td>13.2%</td>
<td>33.53</td>
<td>0.05</td>
<td>-19.5%</td>
<td>-4.53</td>
<td>0.10</td>
<td>91.7%</td>
</tr>
<tr class="row-even"><td>J</td>
<td>P</td>
<td>2.53</td>
<td>0.02</td>
<td>3.7%</td>
<td>30.04</td>
<td>0.05</td>
<td>-32.7%</td>
<td>-1.82</td>
<td>0.10</td>
<td>-26.7%</td>
</tr>
<tr class="row-odd"><td>C</td>
<td>A</td>
<td>3.75</td>
<td>0.02</td>
<td>72.6%</td>
<td>21.19</td>
<td>0.05</td>
<td>-47.0%</td>
<td>-1.9</td>
<td>0.1</td>
<td>-16.5%</td>
</tr>
<tr class="row-even"><td>L</td>
<td>H</td>
<td>1.82</td>
<td>0.02</td>
<td>-19.5%</td>
<td>19.18</td>
<td>0.04</td>
<td>-53.9%</td>
<td>-6.84</td>
<td>0.10</td>
<td>189.8%</td>
</tr>
<tr class="row-odd"><td>A</td>
<td>A</td>
<td>2.284</td>
<td>0.008</td>
<td>-0.3%</td>
<td>23.94</td>
<td>0.02</td>
<td>-43.1%</td>
<td>-3.92</td>
<td>0.04</td>
<td>65.4%</td>
</tr>
<tr class="row-even"><td>J</td>
<td>H</td>
<td>0.95</td>
<td>0.01</td>
<td>-61.0%</td>
<td>22.21</td>
<td>0.02</td>
<td>-50.3%</td>
<td>-7.13</td>
<td>0.08</td>
<td>187.5%</td>
</tr>
<tr class="row-odd"><td>L</td>
<td>A</td>
<td>2.19</td>
<td>0.02</td>
<td>-3.1%</td>
<td>25.94</td>
<td>0.03</td>
<td>-37.7%</td>
<td>-5.37</td>
<td>0.07</td>
<td>127.4%</td>
</tr>
<tr class="row-even"><td>A</td>
<td>P</td>
<td>3.02</td>
<td>0.02</td>
<td>31.7%</td>
<td>28.64</td>
<td>0.04</td>
<td>-31.9%</td>
<td>-2.93</td>
<td>0.08</td>
<td>23.8%</td>
</tr>
<tr class="row-odd"><td>J</td>
<td>A</td>
<td>1.70</td>
<td>0.01</td>
<td>-30.4%</td>
<td>24.26</td>
<td>0.02</td>
<td>-45.7%</td>
<td>-3.97</td>
<td>0.06</td>
<td>60.2%</td>
</tr>
<tr class="row-even"><td>C</td>
<td>P</td>
<td>4.15</td>
<td>0.05</td>
<td>90.8%</td>
<td>22.3</td>
<td>0.1</td>
<td>-44.1%</td>
<td>-3.4</td>
<td>0.3</td>
<td>48.6%</td>
</tr>
</tbody>
</table>
<table border="1" class="docutils">
<caption>Identified coefficients of the benchmark bicycle model for various
sets of data. The first column indicates which rider&#8217;s runs were used:
(C)harlie, (J)ason, (L)uke or (A)ll. The second column indicates which
environment&#8217;s runs were used: (P)avilion Floor, (H)orse Treadmill, or (A)ll.
The remaining columns give the resulting numerical value of the identified
parameter, its standard deviation with respect to the model fit, and the
percent difference with respect to the value predicted by the Whipple model.
Table generated by <cite>src/systemidentification/canonical_tables.py</cite>.</caption>
<colgroup>
<col width="3%" />
<col width="3%" />
<col width="8%" />
<col width="16%" />
<col width="8%" />
<col width="8%" />
<col width="16%" />
<col width="9%" />
<col width="8%" />
<col width="16%" />
<col width="8%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head" colspan="2">&nbsp;</th>
<th class="head" colspan="3"><span class="math">\(M_{\delta\delta}\)</span></th>
<th class="head" colspan="3"><span class="math">\(C_{1\delta\phi}\)</span></th>
<th class="head" colspan="3"><span class="math">\(C_{1\delta\delta}\)</span></th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>R</td>
<td>E</td>
<td>Value</td>
<td><span class="math">\(\sigma\)</span></td>
<td>% Diff</td>
<td>Value</td>
<td><span class="math">\(\sigma\)</span></td>
<td>% Diff</td>
<td>Value</td>
<td><span class="math">\(\sigma\)</span></td>
<td>% Diff</td>
</tr>
<tr class="row-odd"><td>A</td>
<td>H</td>
<td>0.2088</td>
<td>0.0003</td>
<td>-5.3%</td>
<td>-0.891</td>
<td>0.002</td>
<td>183.0%</td>
<td>1.5982</td>
<td>0.0008</td>
<td>14.8%</td>
</tr>
<tr class="row-even"><td>C</td>
<td>H</td>
<td>0.1435</td>
<td>0.0007</td>
<td>-34.0%</td>
<td>-0.881</td>
<td>0.006</td>
<td>179.6%</td>
<td>1.601</td>
<td>0.002</td>
<td>19.5%</td>
</tr>
<tr class="row-odd"><td>L</td>
<td>P</td>
<td>0.2505</td>
<td>0.0009</td>
<td>14.2%</td>
<td>-0.549</td>
<td>0.009</td>
<td>74.2%</td>
<td>2.100</td>
<td>0.003</td>
<td>52.6%</td>
</tr>
<tr class="row-even"><td>J</td>
<td>P</td>
<td>0.1786</td>
<td>0.0007</td>
<td>-20.4%</td>
<td>-1.09</td>
<td>0.01</td>
<td>246.6%</td>
<td>1.915</td>
<td>0.002</td>
<td>31.0%</td>
</tr>
<tr class="row-odd"><td>C</td>
<td>A</td>
<td>0.1760</td>
<td>0.0008</td>
<td>-19.1%</td>
<td>-0.380</td>
<td>0.008</td>
<td>20.7%</td>
<td>1.675</td>
<td>0.002</td>
<td>25.0%</td>
</tr>
<tr class="row-even"><td>L</td>
<td>H</td>
<td>0.2336</td>
<td>0.0007</td>
<td>6.5%</td>
<td>-1.058</td>
<td>0.005</td>
<td>235.8%</td>
<td>1.726</td>
<td>0.002</td>
<td>25.5%</td>
</tr>
<tr class="row-odd"><td>A</td>
<td>A</td>
<td>0.2000</td>
<td>0.0003</td>
<td>-9.2%</td>
<td>-0.888</td>
<td>0.002</td>
<td>182.0%</td>
<td>1.7337</td>
<td>0.0008</td>
<td>24.5%</td>
</tr>
<tr class="row-even"><td>J</td>
<td>H</td>
<td>0.2500</td>
<td>0.0005</td>
<td>11.5%</td>
<td>-0.849</td>
<td>0.003</td>
<td>169.6%</td>
<td>1.545</td>
<td>0.001</td>
<td>5.7%</td>
</tr>
<tr class="row-odd"><td>L</td>
<td>A</td>
<td>0.2385</td>
<td>0.0006</td>
<td>8.7%</td>
<td>-1.053</td>
<td>0.004</td>
<td>234.4%</td>
<td>1.943</td>
<td>0.002</td>
<td>41.3%</td>
</tr>
<tr class="row-even"><td>A</td>
<td>P</td>
<td>0.1949</td>
<td>0.0006</td>
<td>-11.6%</td>
<td>-0.236</td>
<td>0.007</td>
<td>-24.9%</td>
<td>1.872</td>
<td>0.002</td>
<td>34.4%</td>
</tr>
<tr class="row-odd"><td>J</td>
<td>A</td>
<td>0.2012</td>
<td>0.0003</td>
<td>-10.2%</td>
<td>-0.953</td>
<td>0.002</td>
<td>202.4%</td>
<td>1.6592</td>
<td>0.0009</td>
<td>13.5%</td>
</tr>
<tr class="row-even"><td>C</td>
<td>P</td>
<td>0.220</td>
<td>0.002</td>
<td>1.3%</td>
<td>0.84</td>
<td>0.02</td>
<td>-366.5%</td>
<td>1.702</td>
<td>0.005</td>
<td>27.0%</td>
</tr>
</tbody>
</table>
<table border="1" class="docutils">
<caption>Identified coefficients of the benchmark bicycle model for various
sets of data. The first column indicates which rider&#8217;s runs were used:
(C)harlie, (J)ason, (L)uke or (A)ll. The second column indicates which
environment&#8217;s runs were used: (P)avilion Floor, (H)orse Treadmill, or (A)ll.
The remaining columns give the resulting numerical value of the identified
parameter, its standard deviation with respect to the model fit, and the
percent difference with respect to the value predicted by the Whipple model.
Table generated by <cite>src/systemidentification/canonical_tables.py</cite>.</caption>
<colgroup>
<col width="3%" />
<col width="3%" />
<col width="9%" />
<col width="16%" />
<col width="8%" />
<col width="7%" />
<col width="16%" />
<col width="8%" />
<col width="8%" />
<col width="16%" />
<col width="9%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head" colspan="2">&nbsp;</th>
<th class="head" colspan="3"><span class="math">\(K_{0\delta\delta}\)</span></th>
<th class="head" colspan="3"><span class="math">\(K_{2\delta\delta}\)</span></th>
<th class="head" colspan="3"><span class="math">\(H_{\delta F}\)</span></th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>R</td>
<td>E</td>
<td>Value</td>
<td><span class="math">\(\sigma\)</span></td>
<td>% Diff</td>
<td>Value</td>
<td><span class="math">\(\sigma\)</span></td>
<td>% Diff</td>
<td>Value</td>
<td><span class="math">\(\sigma\)</span></td>
<td>% Diff</td>
</tr>
<tr class="row-odd"><td>A</td>
<td>H</td>
<td>-0.6055</td>
<td>0.0003</td>
<td>-18.1%</td>
<td>2.182</td>
<td>0.002</td>
<td>-0.7%</td>
<td>0.0064</td>
<td>0.0008</td>
<td>-41.5%</td>
</tr>
<tr class="row-even"><td>C</td>
<td>H</td>
<td>-1.2406</td>
<td>0.0007</td>
<td>75.5%</td>
<td>2.563</td>
<td>0.006</td>
<td>21.9%</td>
<td>0.020</td>
<td>0.002</td>
<td>77.1%</td>
</tr>
<tr class="row-odd"><td>L</td>
<td>P</td>
<td>-0.4889</td>
<td>0.0009</td>
<td>-33.7%</td>
<td>2.603</td>
<td>0.009</td>
<td>18.9%</td>
<td>0.011</td>
<td>0.003</td>
<td>-1.3%</td>
</tr>
<tr class="row-even"><td>J</td>
<td>P</td>
<td>-0.6561</td>
<td>0.0007</td>
<td>-15.3%</td>
<td>1.99</td>
<td>0.01</td>
<td>-13.2%</td>
<td>0.007</td>
<td>0.002</td>
<td>-30.2%</td>
</tr>
<tr class="row-odd"><td>C</td>
<td>A</td>
<td>-0.9017</td>
<td>0.0008</td>
<td>27.6%</td>
<td>2.763</td>
<td>0.008</td>
<td>31.4%</td>
<td>0.018</td>
<td>0.002</td>
<td>59.1%</td>
</tr>
<tr class="row-even"><td>L</td>
<td>H</td>
<td>-0.3181</td>
<td>0.0007</td>
<td>-56.8%</td>
<td>2.508</td>
<td>0.005</td>
<td>14.5%</td>
<td>0.006</td>
<td>0.002</td>
<td>-44.1%</td>
</tr>
<tr class="row-odd"><td>A</td>
<td>A</td>
<td>-0.6678</td>
<td>0.0003</td>
<td>-9.7%</td>
<td>2.340</td>
<td>0.002</td>
<td>6.5%</td>
<td>0.0086</td>
<td>0.0008</td>
<td>-21.8%</td>
</tr>
<tr class="row-even"><td>J</td>
<td>H</td>
<td>-0.3579</td>
<td>0.0005</td>
<td>-53.8%</td>
<td>1.968</td>
<td>0.003</td>
<td>-14.3%</td>
<td>-0.000</td>
<td>0.001</td>
<td>-100.9%</td>
</tr>
<tr class="row-odd"><td>L</td>
<td>A</td>
<td>-0.4614</td>
<td>0.0006</td>
<td>-37.4%</td>
<td>2.524</td>
<td>0.004</td>
<td>15.2%</td>
<td>0.008</td>
<td>0.002</td>
<td>-31.0%</td>
</tr>
<tr class="row-even"><td>A</td>
<td>P</td>
<td>-0.6003</td>
<td>0.0006</td>
<td>-18.8%</td>
<td>2.469</td>
<td>0.007</td>
<td>12.4%</td>
<td>0.013</td>
<td>0.002</td>
<td>17.7%</td>
</tr>
<tr class="row-odd"><td>J</td>
<td>A</td>
<td>-0.6207</td>
<td>0.0003</td>
<td>-19.8%</td>
<td>1.996</td>
<td>0.002</td>
<td>-13.1%</td>
<td>0.0047</td>
<td>0.0009</td>
<td>-55.7%</td>
</tr>
<tr class="row-even"><td>C</td>
<td>P</td>
<td>-0.288</td>
<td>0.002</td>
<td>-59.3%</td>
<td>2.81</td>
<td>0.02</td>
<td>33.8%</td>
<td>0.020</td>
<td>0.005</td>
<td>79.9%</td>
</tr>
</tbody>
</table>
<p>It is interesting to note that <span class="math">\(C_{1 \delta \phi}\)</span> deviates quite significantly
from the Whipple model prediction. This term depends on the wheel radii, wheel
rotational inertia, wheelbase, steer axis tilt, and trail. All of these but
trail are easily measured so it is tempting to solve for trail given
<span class="math">\(C_{1 \delta \phi}\)</span> and the other measured parameters described in
<a class="reference internal" href="zreferences.html#meijaard2007">[MPRS07]</a>.</p>
<div class="math" id="equation-eqTrail">
<span class="eqno">(26)</span>\[c = -\frac{w(C_{1 \delta \phi} + S_F \operatorname{cos}\lambda)}{S_T
\operatorname{cos}\lambda}\]</div>
<p>The results for each data subset are given in <a class="reference internal" href="#tabidentifiedtrail"><em>Table
11.6</em></a>. On average the values are extremely unrealistic when
compared to the measured geometric trail of <span class="math">\(c=0.0599\)</span> meters. This may
imply that including the effects of pneumatic trail would not be enough to
improve the predictive capabilities of the Whipple model. It also points to the
potentially erroneous assumptions made in this identification effort such as the
order of the system and which parameters are fixed. Even thought the model is
quite adequate for describing the measured motion, it lacks the complexness to
identify the precise deficients in the first principles assumptions.</p>
<table border="1" class="docutils">
<caption>The trail computed from the identified <span class="math">\(C_{1 \delta \phi}\)</span> and
the measured physical parameters.</caption>
<colgroup>
<col width="17%" />
<col width="7%" />
<col width="7%" />
<col width="7%" />
<col width="7%" />
<col width="7%" />
<col width="7%" />
<col width="7%" />
<col width="7%" />
<col width="7%" />
<col width="8%" />
<col width="7%" />
<col width="8%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">R-E</th>
<th class="head">A-H</th>
<th class="head">C-H</th>
<th class="head">L-P</th>
<th class="head">J-P</th>
<th class="head">C-A</th>
<th class="head">L-H</th>
<th class="head">A-A</th>
<th class="head">J-H</th>
<th class="head">L-A</th>
<th class="head">A-P</th>
<th class="head">J-A</th>
<th class="head">C-P</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><span class="math">\(c\)</span> [m]</td>
<td>1.006</td>
<td>0.989</td>
<td>0.443</td>
<td>1.335</td>
<td>0.167</td>
<td>1.279</td>
<td>1.001</td>
<td>0.937</td>
<td>1.272</td>
<td>-0.069</td>
<td>1.107</td>
<td>-1.835</td>
</tr>
</tbody>
</table>
<p>The measurement errors, model structure and order dictate how well the models
can predict the input-output behavior of each run or even each perturbation.
The ideal goal is to select one or a small set of models that do a good job at
predicting the measured behavior for each run. The previous section&#8217;s state
space methods have already shown that the Whipple and arm models may not
provide adequate predictions.</p>
<p>Figures <a class="reference internal" href="#figcompbode2p0"><em>11.17</em></a>, <a class="reference internal" href="#figcompbode5p5"><em>11.18</em></a>, and
<a class="reference internal" href="#figcompbode9p0"><em>11.19</em></a> plot the steer torque to roll angle frequency
response for three speeds: 2 m/s, 5.5 m/s and 9.0 m/s for each of the models in
Tables <a class="reference internal" href="#tabidmckone"><em>11.3</em></a>, <a class="reference internal" href="#tabidmcktwo"><em>11.4</em></a>, and
<a class="reference internal" href="#tabidmckthree"><em>11.5</em></a>. At the lowest speed, all of the models have a
similar frequency response, especially in the frequency band between about 1 an
20 rad/s. At 5.5 m/s the models are similar at a higher bandwidth, 4 to 30
rad/s, and at 9.0 m/s even higher, 10 to 50 rad/s. Notice that the frequency band
where the models are most similar shifts to higher frequencies at higher
speeds. The model derived from all of the data (all rider and all runs), gives
an average model and if this model is significantly better at
predicting the measured behavior of the Whipple and arm models, it may be a
good general candidate model for this bicycle.</p>
<div class="figure align-center" id="figcompbode2p0">
<a class="reference external image-reference" href="_images/compare-id-bode-2p0.png"><img alt="_images/compare-id-bode-2p0.png" src="_images/compare-id-bode-2p0.png" style="width: 6in;" /></a>
<p class="caption">Steer torque to roll angle frequency responses at 2.0 m/s for all the
identified models in Tables <a class="reference internal" href="#tabidmckone"><em>11.3</em></a>, <a class="reference internal" href="#tabidmcktwo"><em>11.4</em></a>,
and <a class="reference internal" href="#tabidmckthree"><em>11.5</em></a>.</p>
</div>
<div class="figure align-center" id="figcompbode5p5">
<a class="reference external image-reference" href="_images/compare-id-bode-5p5.png"><img alt="_images/compare-id-bode-5p5.png" src="_images/compare-id-bode-5p5.png" style="width: 6in;" /></a>
<p class="caption">Steer torque to roll angle frequency responses at 5.5 m/s for all the
identified models in Tables <a class="reference internal" href="#tabidmckone"><em>11.3</em></a>, <a class="reference internal" href="#tabidmcktwo"><em>11.4</em></a>,
and <a class="reference internal" href="#tabidmckthree"><em>11.5</em></a>.</p>
</div>
<div class="figure align-center" id="figcompbode9p0">
<a class="reference external image-reference" href="_images/compare-id-bode-9p0.png"><img alt="_images/compare-id-bode-9p0.png" src="_images/compare-id-bode-9p0.png" style="width: 6in;" /></a>
<p class="caption">Steer torque to roll angle frequency responses at 9.0 m/s for all the
identified models in Tables <a class="reference internal" href="#tabidmckone"><em>11.3</em></a>, <a class="reference internal" href="#tabidmcktwo"><em>11.4</em></a>,
and <a class="reference internal" href="#tabidmckthree"><em>11.5</em></a>.</p>
</div>
<p>The predictive capability and quality of a given model can be quantified by
an assortment of criterion and methods. I&#8217;ve made use of two criterion to judge
the quality of these models with respect to given data. The first is to
simulate the system given the measured inputs. This method works well when the
open loop system is stable, but if it is unstable as so in the case of this
bicycle, it may be difficult to simulate. Searching for initial conditions
that give rise to a stable model for the duration of the run or simulating by
weighting the future error less may relieve the instability issues. Another
option is to see how well the inputs are predicted given the measured outputs.
The canonical form of the equations lend themselves to this and only two inputs
per run need be checked.</p>
<p>The predicted torques on the system are</p>
<div class="math" id="equation-eqPredictedTorques">
<span class="eqno">(27)</span>\[y_p = \mathbf{M} \ddot{q} + v \mathbf{C}_1 \dot{q} + [g \mathbf{K}_0 + v^2
\mathbf{K}_2] q\]</div>
<p>and the measured torques as</p>
<div class="math" id="equation-eqMeasuredTorques">
<span class="eqno">(28)</span>\[y_m = T + H F\]</div>
<p><span class="math">\(y_p\)</span> and <span class="math">\(y_m\)</span> can be computed for each run along with the
<em>variance accounted for</em> (VAF), by the model for both the total roll torque and
the steer torque</p>
<div class="math" id="equation-eqVAF">
<span class="eqno">(29)</span>\[\textrm{VAF} = 1 - \frac{||y_p - y_m||}{||y_m - \bar{y}_m||}\]</div>
<p>I compute the VAF for each of the 374 runs used in the canonical identification
outlined in Equation <a href="#equation-eqVAF">(29)</a> using each of the 12 identified models and
both the Whipple and Arm models. This percentage can be used as a criterion
with which to judge the ability of one model versus another to predict the
measurement. I then take the median of the VAF over each of the 12 sets of
runs, Tables <a class="reference internal" href="#tabmeanvafroll"><em>11.7</em></a> and <a class="reference internal" href="#tabmeanvafsteer"><em>11.8</em></a>. The
results give an idea of how well the various models are able to predict the
data for all of the runs in a given set.</p>
<table border="1" class="docutils">
<caption>Median VAF for the roll equation of various models (rows) for all
runs in each data subset (columns).</caption>
<colgroup>
<col width="11%" />
<col width="8%" />
<col width="8%" />
<col width="8%" />
<col width="8%" />
<col width="8%" />
<col width="8%" />
<col width="8%" />
<col width="8%" />
<col width="8%" />
<col width="7%" />
<col width="8%" />
<col width="7%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">&nbsp;</th>
<th class="head">A-A</th>
<th class="head">A-H</th>
<th class="head">A-P</th>
<th class="head">C-A</th>
<th class="head">C-H</th>
<th class="head">C-P</th>
<th class="head">J-A</th>
<th class="head">J-H</th>
<th class="head">J-P</th>
<th class="head">L-A</th>
<th class="head">L-H</th>
<th class="head">L-P</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><strong>A-A</strong></td>
<td>-11.9%</td>
<td>-39.5%</td>
<td>-8.5%</td>
<td>-28.9%</td>
<td>-20.4%</td>
<td>-30.2%</td>
<td>-30.5%</td>
<td>-71.9%</td>
<td>-21.9%</td>
<td>9.0%</td>
<td>5.4%</td>
<td>9.0%</td>
</tr>
<tr class="row-odd"><td><strong>A-H</strong></td>
<td>-19.3%</td>
<td>-43.4%</td>
<td>-16.9%</td>
<td>-35.8%</td>
<td>-27.7%</td>
<td>-38.6%</td>
<td>-37.4%</td>
<td>-85.0%</td>
<td>-26.9%</td>
<td>0.5%</td>
<td>-2.1%</td>
<td>0.5%</td>
</tr>
<tr class="row-even"><td><strong>A-P</strong></td>
<td>-3.6%</td>
<td>-31.8%</td>
<td>2.1%</td>
<td>-19.4%</td>
<td>-19.4%</td>
<td>-19.8%</td>
<td>-22.7%</td>
<td>-55.3%</td>
<td>-11.8%</td>
<td>20.3%</td>
<td>11.1%</td>
<td>20.5%</td>
</tr>
<tr class="row-odd"><td><strong>C-A</strong></td>
<td>-14.8%</td>
<td>-50.3%</td>
<td>-11.1%</td>
<td>-26.8%</td>
<td>-31.1%</td>
<td>-26.8%</td>
<td>-34.9%</td>
<td>-83.1%</td>
<td>-22.5%</td>
<td>3.0%</td>
<td>-5.7%</td>
<td>3.5%</td>
</tr>
<tr class="row-even"><td><strong>C-H</strong></td>
<td>-17.2%</td>
<td>-49.6%</td>
<td>-13.9%</td>
<td>-31.8%</td>
<td>-31.9%</td>
<td>-31.8%</td>
<td>-35.8%</td>
<td>-76.0%</td>
<td>-24.5%</td>
<td>-0.3%</td>
<td>-8.1%</td>
<td>-0.2%</td>
</tr>
<tr class="row-odd"><td><strong>C-P</strong></td>
<td>-13.4%</td>
<td>-51.7%</td>
<td>-8.8%</td>
<td>-22.5%</td>
<td>-31.2%</td>
<td>-22.5%</td>
<td>-36.1%</td>
<td>-91.0%</td>
<td>-21.3%</td>
<td>6.0%</td>
<td>-4.5%</td>
<td>6.9%</td>
</tr>
<tr class="row-even"><td><strong>J-A</strong></td>
<td>-13.9%</td>
<td>-38.0%</td>
<td>-9.6%</td>
<td>-31.6%</td>
<td>-20.6%</td>
<td>-33.8%</td>
<td>-31.0%</td>
<td>-67.6%</td>
<td>-23.4%</td>
<td>7.5%</td>
<td>5.8%</td>
<td>7.6%</td>
</tr>
<tr class="row-odd"><td><strong>J-H</strong></td>
<td>-21.1%</td>
<td>-43.9%</td>
<td>-17.5%</td>
<td>-39.8%</td>
<td>-27.5%</td>
<td>-41.7%</td>
<td>-38.6%</td>
<td>-81.7%</td>
<td>-28.5%</td>
<td>0.5%</td>
<td>-0.0%</td>
<td>0.6%</td>
</tr>
<tr class="row-even"><td><strong>J-P</strong></td>
<td>-2.5%</td>
<td>-27.5%</td>
<td>3.0%</td>
<td>-18.2%</td>
<td>-18.2%</td>
<td>-18.6%</td>
<td>-20.1%</td>
<td>-43.1%</td>
<td>-10.3%</td>
<td>21.0%</td>
<td>12.9%</td>
<td>21.1%</td>
</tr>
<tr class="row-odd"><td><strong>L-A</strong></td>
<td>-9.9%</td>
<td>-29.4%</td>
<td>-5.2%</td>
<td>-26.0%</td>
<td>-18.5%</td>
<td>-28.1%</td>
<td>-27.4%</td>
<td>-64.3%</td>
<td>-19.5%</td>
<td>13.2%</td>
<td>9.4%</td>
<td>13.3%</td>
</tr>
<tr class="row-even"><td><strong>L-H</strong></td>
<td>-26.1%</td>
<td>-53.4%</td>
<td>-23.1%</td>
<td>-39.4%</td>
<td>-37.5%</td>
<td>-42.5%</td>
<td>-41.8%</td>
<td>-77.0%</td>
<td>-31.6%</td>
<td>-8.2%</td>
<td>-12.1%</td>
<td>-7.8%</td>
</tr>
<tr class="row-odd"><td><strong>L-P</strong></td>
<td>-0.3%</td>
<td>-29.7%</td>
<td>8.2%</td>
<td>-20.8%</td>
<td>-31.3%</td>
<td>-20.8%</td>
<td>-25.9%</td>
<td>-35.8%</td>
<td>-16.8%</td>
<td>22.5%</td>
<td>11.0%</td>
<td>22.6%</td>
</tr>
<tr class="row-even"><td><strong>Whipple</strong></td>
<td>-10.8%</td>
<td>-37.5%</td>
<td>-3.1%</td>
<td>-28.5%</td>
<td>-37.4%</td>
<td>-28.5%</td>
<td>-44.2%</td>
<td>-67.5%</td>
<td>-35.9%</td>
<td>17.6%</td>
<td>17.8%</td>
<td>16.2%</td>
</tr>
<tr class="row-odd"><td><strong>Arm</strong></td>
<td>-11.6%</td>
<td>-36.4%</td>
<td>-4.1%</td>
<td>-27.8%</td>
<td>-36.2%</td>
<td>-27.8%</td>
<td>-46.0%</td>
<td>-64.1%</td>
<td>-32.9%</td>
<td>15.8%</td>
<td>13.6%</td>
<td>16.9%</td>
</tr>
</tbody>
</table>
<table border="1" class="docutils">
<caption>Mean VAF for the steer equation of various models (rows) for all
runs in each data subset (columns).</caption>
<colgroup>
<col width="12%" />
<col width="7%" />
<col width="7%" />
<col width="7%" />
<col width="7%" />
<col width="7%" />
<col width="7%" />
<col width="7%" />
<col width="7%" />
<col width="7%" />
<col width="7%" />
<col width="7%" />
<col width="7%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">&nbsp;</th>
<th class="head">A-A</th>
<th class="head">A-H</th>
<th class="head">A-P</th>
<th class="head">C-A</th>
<th class="head">C-H</th>
<th class="head">C-P</th>
<th class="head">J-A</th>
<th class="head">J-H</th>
<th class="head">J-P</th>
<th class="head">L-A</th>
<th class="head">L-H</th>
<th class="head">L-P</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><strong>A-A</strong></td>
<td>59.4%</td>
<td>56.8%</td>
<td>60.0%</td>
<td>60.6%</td>
<td>49.7%</td>
<td>61.2%</td>
<td>58.7%</td>
<td>60.1%</td>
<td>58.4%</td>
<td>59.3%</td>
<td>56.2%</td>
<td>60.3%</td>
</tr>
<tr class="row-odd"><td><strong>A-H</strong></td>
<td>53.4%</td>
<td>53.4%</td>
<td>53.4%</td>
<td>53.5%</td>
<td>46.8%</td>
<td>54.2%</td>
<td>55.7%</td>
<td>58.1%</td>
<td>55.3%</td>
<td>51.8%</td>
<td>51.7%</td>
<td>51.8%</td>
</tr>
<tr class="row-even"><td><strong>A-P</strong></td>
<td>63.1%</td>
<td>58.1%</td>
<td>64.3%</td>
<td>64.0%</td>
<td>54.4%</td>
<td>65.8%</td>
<td>57.5%</td>
<td>57.9%</td>
<td>57.4%</td>
<td>65.3%</td>
<td>59.7%</td>
<td>66.8%</td>
</tr>
<tr class="row-odd"><td><strong>C-A</strong></td>
<td>49.4%</td>
<td>44.9%</td>
<td>50.2%</td>
<td>50.9%</td>
<td>42.9%</td>
<td>51.6%</td>
<td>48.0%</td>
<td>45.1%</td>
<td>49.0%</td>
<td>49.4%</td>
<td>46.1%</td>
<td>50.2%</td>
</tr>
<tr class="row-even"><td><strong>C-H</strong></td>
<td>47.5%</td>
<td>47.3%</td>
<td>47.7%</td>
<td>47.1%</td>
<td>45.5%</td>
<td>47.2%</td>
<td>50.0%</td>
<td>50.5%</td>
<td>49.3%</td>
<td>47.0%</td>
<td>45.3%</td>
<td>47.0%</td>
</tr>
<tr class="row-odd"><td><strong>C-P</strong></td>
<td>44.1%</td>
<td>41.6%</td>
<td>45.2%</td>
<td>46.9%</td>
<td>41.6%</td>
<td>48.4%</td>
<td>40.5%</td>
<td>39.9%</td>
<td>40.7%</td>
<td>43.9%</td>
<td>43.3%</td>
<td>45.1%</td>
</tr>
<tr class="row-even"><td><strong>J-A</strong></td>
<td>60.2%</td>
<td>58.1%</td>
<td>60.9%</td>
<td>59.9%</td>
<td>51.4%</td>
<td>61.8%</td>
<td>59.6%</td>
<td>63.1%</td>
<td>59.1%</td>
<td>60.5%</td>
<td>57.7%</td>
<td>60.9%</td>
</tr>
<tr class="row-odd"><td><strong>J-H</strong></td>
<td>46.1%</td>
<td>50.3%</td>
<td>45.5%</td>
<td>42.1%</td>
<td>41.8%</td>
<td>42.3%</td>
<td>50.8%</td>
<td>53.4%</td>
<td>49.5%</td>
<td>44.9%</td>
<td>46.9%</td>
<td>42.9%</td>
</tr>
<tr class="row-even"><td><strong>J-P</strong></td>
<td>64.5%</td>
<td>60.5%</td>
<td>65.1%</td>
<td>62.9%</td>
<td>57.7%</td>
<td>64.6%</td>
<td>61.5%</td>
<td>62.2%</td>
<td>60.8%</td>
<td>67.8%</td>
<td>63.6%</td>
<td>69.0%</td>
</tr>
<tr class="row-odd"><td><strong>L-A</strong></td>
<td>58.4%</td>
<td>57.8%</td>
<td>58.6%</td>
<td>56.8%</td>
<td>51.1%</td>
<td>57.8%</td>
<td>57.0%</td>
<td>59.6%</td>
<td>55.2%</td>
<td>60.3%</td>
<td>60.1%</td>
<td>61.2%</td>
</tr>
<tr class="row-even"><td><strong>L-H</strong></td>
<td>47.2%</td>
<td>49.8%</td>
<td>47.0%</td>
<td>46.5%</td>
<td>43.4%</td>
<td>46.7%</td>
<td>49.9%</td>
<td>52.4%</td>
<td>48.9%</td>
<td>46.7%</td>
<td>47.8%</td>
<td>46.6%</td>
</tr>
<tr class="row-odd"><td><strong>L-P</strong></td>
<td>61.7%</td>
<td>59.5%</td>
<td>62.9%</td>
<td>60.2%</td>
<td>50.0%</td>
<td>62.7%</td>
<td>54.3%</td>
<td>60.6%</td>
<td>52.8%</td>
<td>68.2%</td>
<td>63.0%</td>
<td>70.0%</td>
</tr>
<tr class="row-even"><td><strong>Whipple</strong></td>
<td>55.3%</td>
<td>51.0%</td>
<td>56.4%</td>
<td>56.1%</td>
<td>48.7%</td>
<td>58.4%</td>
<td>55.4%</td>
<td>55.5%</td>
<td>55.4%</td>
<td>53.0%</td>
<td>49.5%</td>
<td>55.7%</td>
</tr>
<tr class="row-odd"><td><strong>Arm</strong></td>
<td>28.0%</td>
<td>18.6%</td>
<td>30.3%</td>
<td>36.2%</td>
<td>18.9%</td>
<td>37.4%</td>
<td>17.6%</td>
<td>20.4%</td>
<td>12.6%</td>
<td>29.3%</td>
<td>15.9%</td>
<td>34.2%</td>
</tr>
</tbody>
</table>
<p>Tables <a class="reference internal" href="#tabmeanvafroll"><em>11.7</em></a> and <a class="reference internal" href="#tabmeanvafsteer"><em>11.8</em></a> give the
median for each set of runs in each column for each model given in the row for
roll and steer respectively. The maximum VAF in the column gives a measure of
the best model for predicting each individual run in that set of runs.
Intuitively, I would expect that the diagonal of the upper 12 rows would be the
maximum in each column due to the fact that that model was derived from that
set of runs, but that is not always the case. I believe that this can be
explained by the fact that there are more outlier runs in some sets. These
outliers have enough effect in the resulting regressions, that the models
generated from sets of runs with fewer outliers are able to predict the data
better.</p>
<p>The models are able to predict the steer torque much better than the roll
torque. The roll torque should be zero in all of the runs without disturbances
but the roll equations do not predict a zero value. This is also reflected in
the negative median values of all the runs with disturbances in much of
<a class="reference internal" href="#tabmeanvafroll"><em>Table 11.7</em></a>. We fixed six of the nine parameters in the
roll equation to those of the Whipple model and fixed three of the nine
parameters in the steer equation. These extra degrees of freedom can partially
explain why the steer predictions are better than the roll predictions. The
model for the roll torque is more susceptible to the noise in the rate and
angle measurements and has consequences of +/- 50 Nm variation in the predicted
roll torques. These are unfortunately comparable in magnitude to the measured
roll torques due to the lateral perturbations. But <a class="reference internal" href="#tabmeanvafroll"><em>Table
11.7</em></a> can still be used to gage which models are better with
reference to each other. The values in <a class="reference internal" href="#tabmeanvafroll"><em>Table 11.7</em></a> are
only generated from the runs with disturbances, as a relative measure of
quality to zero is hard to make.</p>
<p>Tables <a class="reference internal" href="#tabmeanvafroll"><em>11.7</em></a> and <a class="reference internal" href="#tabmeanvafsteer"><em>11.8</em></a> reveal:</p>
<ul class="simple">
<li>The arm model is poor at predicting the steer torque.</li>
<li>The models derived from Charlie&#8217;s runs are poorer at predicting the inputs.</li>
<li>The Whipple model is not too bad at predicting steer torque, but on average
about 10% worse than the best models.</li>
<li>The models identified from the pavilion runs are generally the best (with
exception of Charlie&#8217;s). The ones generated from Luke and Jason&#8217;s runs are
typically the best at predicting both steer torque and roll torque, with
Luke&#8217;s giving better roll torque predictions.</li>
<li>The roll torque is poorly predicted by all models when it is supposed to be
zero. This raises implications in the validity of the roll equation and the
potential need for tire slip models.</li>
</ul>
<p>It may seem odd that a model identified from the subset of runs of one rider in
one environment is the best at predicting the runs on a individual basis, but
the uncertainty and error in both the data and the model structures don&#8217;t
dictate that this can&#8217;t be. Keep in mind that all of the frequency responses of
all 12 models shown in Figures <a class="reference internal" href="#figcompbode2p0"><em>11.17</em></a>,
<a class="reference internal" href="#figcompbode5p5"><em>11.18</em></a>, and <a class="reference internal" href="#figcompbode9p0"><em>11.19</em></a> are probably
bounded in the uncertainty of the predicted responses and each can be
considered a &#8220;good&#8221; model, even including the Whipple model.</p>
<p>The second method of evaluating the quality of the identified models is to
simulate the model with the measured inputs and compare the predicted outputs
with the measured outputs with a similar VAF criterion. I simulated all 14
models with the inputs from the 374 runs and computed the VAF explained by the
model for each output. Since the models are typically unstable at all of the
speeds we tested, I searched for the set of initial conditions which minimizes
the VAF for all outputs. For the majority of runs and models, this is
sufficient to find a stable simulation for the duration of the run.
However, this is not always the case. For long duration runs I select a random
20 second section of the data to simulate, reducing the likelihood that the
simulation blows up due to the model&#8217;s instability. Finally, I ignore any
outputs VAFs that are less than -100 percent as they are most likely due to
unstable simulations. <a class="reference internal" href="#tabmedianvafoutputs"><em>Table 11.9</em></a> presents the median
percent variance accounted for across all runs for each model and each output.
The best model seems to be the one generated from the data with Luke on the
Pavilion Floor once again, but these results differ from the previous
otherwise.</p>
<ul class="simple">
<li>For all outputs other than roll angle, the arm model is better than the
Whipple model.</li>
<li>The models from Charlie&#8217;s data fare much better than the input comparisons
and are better than some of Jason&#8217;s.</li>
<li>The model identified from the data with Jason on the Pavilion floor is very
poor in roll angle prediction as opposed to being a good choice from the
input comparison results.</li>
<li>All of the identified models are better predictors than the first principles
models.</li>
</ul>
<table border="1" class="docutils">
<caption>The median VAF in the simulation output variables.</caption>
<colgroup>
<col width="27%" />
<col width="18%" />
<col width="16%" />
<col width="18%" />
<col width="21%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">&nbsp;</th>
<th class="head">phi</th>
<th class="head">delta</th>
<th class="head">phiDot</th>
<th class="head">deltaDot</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><strong>AA</strong></td>
<td>28.6%</td>
<td>61.8%</td>
<td>51.8%</td>
<td>65.2%</td>
</tr>
<tr class="row-odd"><td><strong>CH</strong></td>
<td>18.6%</td>
<td>57.2%</td>
<td>52.6%</td>
<td>62.2%</td>
</tr>
<tr class="row-even"><td><strong>LA</strong></td>
<td>29.4%</td>
<td>59.8%</td>
<td>52.9%</td>
<td>67.9%</td>
</tr>
<tr class="row-odd"><td><strong>AH</strong></td>
<td>24.1%</td>
<td>57.4%</td>
<td>43.1%</td>
<td>64.2%</td>
</tr>
<tr class="row-even"><td><strong>CA</strong></td>
<td>14.9%</td>
<td>54.5%</td>
<td>51.7%</td>
<td>59.8%</td>
</tr>
<tr class="row-odd"><td><strong>JP</strong></td>
<td>-3.4%</td>
<td>35.4%</td>
<td>34.1%</td>
<td>61.7%</td>
</tr>
<tr class="row-even"><td><strong>LH</strong></td>
<td>24.3%</td>
<td>57.7%</td>
<td>46.1%</td>
<td>65.7%</td>
</tr>
<tr class="row-odd"><td><strong>AP</strong></td>
<td>29.7%</td>
<td>58.9%</td>
<td>60.6%</td>
<td>63.2%</td>
</tr>
<tr class="row-even"><td><strong>JH</strong></td>
<td>22.8%</td>
<td>53.6%</td>
<td>42.0%</td>
<td>62.8%</td>
</tr>
<tr class="row-odd"><td><strong>LP</strong></td>
<td>38.2%</td>
<td>62.8%</td>
<td>60.9%</td>
<td>68.4%</td>
</tr>
<tr class="row-even"><td><strong>CP</strong></td>
<td>19.0%</td>
<td>46.0%</td>
<td>42.0%</td>
<td>47.1%</td>
</tr>
<tr class="row-odd"><td><strong>JA</strong></td>
<td>27.9%</td>
<td>61.0%</td>
<td>49.4%</td>
<td>65.9%</td>
</tr>
<tr class="row-even"><td><strong>Whipple</strong></td>
<td>-21.0%</td>
<td>10.3%</td>
<td>5.8%</td>
<td>12.2%</td>
</tr>
<tr class="row-odd"><td><strong>Arm</strong></td>
<td>-33.1%</td>
<td>19.6%</td>
<td>29.7%</td>
<td>33.1%</td>
</tr>
</tbody>
</table>
<p>The mean percent variance across the outputs can be computed and the models
ranked by the mean, <a class="reference internal" href="#tabmeanvafoutputs"><em>Table 11.10</em></a>. The best model seems
to be LP and the AA is also a pretty good predictor. Notice that the Whipple
model is poorer than the arm model.</p>
<table border="1" class="docutils">
<caption>The mean of the median  VAF in the simulation output variables
presented in <a class="reference internal" href="#tabmedianvafoutputs"><em>Table 11.9</em></a>.</caption>
<colgroup>
<col width="12%" />
<col width="12%" />
<col width="12%" />
<col width="12%" />
<col width="12%" />
<col width="12%" />
<col width="12%" />
<col width="17%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Model</td>
<td>L-P</td>
<td>A-P</td>
<td>L-A</td>
<td>A-A</td>
<td>J-A</td>
<td>L-H</td>
<td>C-H</td>
</tr>
<tr class="row-even"><td>Mean</td>
<td>57.6%</td>
<td>53.1%</td>
<td>52.5%</td>
<td>51.8%</td>
<td>51.1%</td>
<td>48.5%</td>
<td>47.7%</td>
</tr>
<tr class="row-odd"><td>Model</td>
<td>A-H</td>
<td>J-H</td>
<td>C-A</td>
<td>C-P</td>
<td>J-P</td>
<td>Arm</td>
<td>Whipple</td>
</tr>
<tr class="row-even"><td>Mean</td>
<td>47.2%</td>
<td>45.3%</td>
<td>45.2%</td>
<td>38.5%</td>
<td>31.9%</td>
<td>12.3%</td>
<td>1.8%</td>
</tr>
</tbody>
</table>
<p>The orange lines in Figures <a class="reference internal" href="#figacoefficients"><em>11.8</em></a> and
<a class="reference internal" href="#figbcoefficients"><em>11.9</em></a> correspond to the L-P model which allows
comparison of the results of the canonical identification process with those of
the state space identified models. The L-P model seems be better at fitting the
data, especially in the steer acceleration equation, but the large variance in
the state space coefficients is still a problem. This lends more confidence
that that the L-P model is a better model choice than the Whipple or the arm
model.</p>
</div>
<div class="section" id="discussion">
<h4>Discussion<a class="headerlink" href="#discussion" title="Permalink to this headline">¶</a></h4>
<dl class="docutils">
<dt>Canonical identification</dt>
<dd>The canonical realization, Section <a class="reference internal" href="#seccanonicalid"><em>Canonical Identification</em></a>, is a good method
for identifying a model for data from multiple runs. It relies on quality
measurements of the coordinates, rates, and accelerations. I use numerical
differentiation of the rates to get the accelerations instead of direct
measurements and the angles are not perfectly related to the rates through
differentiation because they were measured from different sensors. The noise
in the measurements and whether the measurements are accurately the
derivatives of one another have bearing on the results. It is possible to
identify all of the entries in the canonical matrices, but it is likely some
of those are easily predicted from first principles so I fix them to the
Whipple model predictions if that is the case. This leaves the roll equation
mostly known and the steer equation mostly unknown and the results reflect
better fits with respect to steer than roll as a result. This formulation
does not explicitly account for process noise, so it may be be susceptible
to similar accuracy errors as the state space formulation is. The advantage
in this method is the ability to use large sets of data for the
calculations. It is extremely surprising that a model from a small subset of
the data is better at predicting all of the runs on an individual basis.</dd>
<dt>Input comparison</dt>
<dd>The input prediction comparisons do not predict the roll torque well at all.
It seems that the roll torque equation magnifies the noise in the
coordinate, rate, and acceleration measurements such that the resulting
noise in the roll torque is equivalent in magnitude to the roll
perturbations. But the roll perturbations do seem to clearly be present in
the predictions. This results in difficultly comparing the quality of the
resulting models with respect to the roll equation. This also points to the
potential deficiencies in the Whipple roll torque equation and these large
magnitude roll torques may also be due to inaccurate modeling of the tire
dynamics.</dd>
<dt>Output comparison</dt>
<dd>The output comparison (simulations) give more reasonable results because all
four outputs generally fit well across runs given the measured inputs. It
is surprising that the ranking of model prediction ability is different for
the input comparisons than the output comparisons, but the fact that the
model identified from Luke&#8217;s pavilion runs is the best from both
comparisons, at least gives credence to its further adoption. The first
principles models are dead last in the ranking and the model identified from
Jason&#8217;s pavilion runs is surprisingly poor due to poor roll angle
prediction.</dd>
<dt>Whipple model</dt>
<dd>The input comparisons show that the Whipple model is relatively reasonable
at predicting the data but the output comparisons make it out to be much
poorer. The Whipple model is clearly the worst at explaining the variance in
the steer angle, roll rate,  and steer rate outputs and is second to worst
in roll angle. Also contrary to the Whipple model predictions, the weave
mode of all identified models is unstable until at least 8-9 m/s or so. The
caster mode is also typically much faster in the identified models. This
implies that the real system does not benefit from open loop stability at
all during most normal speed bicycling and that the rider is always
responsible for stabilizing the vehicle. This may explain why none of the
riders ever felt comfortable enough to try hands-free riding while strapped
into the harness.</dd>
<dt>Arm model</dt>
<dd>I had hypothesized that the arm model would better predict the measured
motion because it more accurately modeled the fact that we allowed the rider
full use of his arms to control the steering and that the arms effectively
added to the front frame inertia. This was validated with respect to the
output simulation comparisons. They predict that the arm model is much
better than the Whipple model for most of the output variables. But this is
in contrast to the input comparison predictions which were the opposite,
with the Whipple being much better than the arm model. More work is needed
to verify which model is better and why the results differ at all.</dd>
<dt>Rider biomechanics may mot be modeled</dt>
<dd>The models identified from Charlie&#8217;s runs are different than those of Jason
and Luke. The models from Charlie&#8217;s runs do not predict the runs very well,
even including the subset of Charlie&#8217;s data. I&#8217;m not sure if the rider&#8217;s arm
stiffness can affect these results or how much the different riders can
effect this if we are only searching for the passive bicycle-rider model.
The other potential explanation is that there are too many outliers in
Charlie&#8217;s runs. This could have something to do with the runs that had
time synchronization issues.</dd>
<dt>Predicting derivatives</dt>
<dd>The roll angle is more poorly predicted than the other variables. The steer
angle and steer rate are better predicted than the roll angle and roll rate.
In the output comparisons I enforce that the roll rate is the derivative of
the roll and the same for the steer variables. The poorer prediction of roll
angle is probably due to noise and error in the independent measurements of
these variables. I toyed with complementary filters to try to combine the
angle and rate measurements in a way that filtered and enforced the
derivative relationship between the measured variables, but did not have
much luck improving the results. It may be better to focus on one each of
the roll and steer variables for minimization purposes. It is well known
that fitting models with many fewer inputs to outputs is difficult and the
fewer outputs reduces the number of noise terms to estimate.</dd>
</dl>
</div>
<div class="section" id="id76">
<h4>Conclusion<a class="headerlink" href="#id76" title="Permalink to this headline">¶</a></h4>
<p>The best candidate model for the measured system is the model identified from
the data subset with rider Luke and the pavilion floor. I find no reason to use
different models for each rider or environment as this model does a better job at
predicting than the other models derived from matching subsets. I will use the
model identified from the set of runs with Luke on the pavilion floor as the
base bicycle model for identifying the controller for all the runs in the
following section of this Chapter. I could use the individual bicycle
identifications for each run, but using a model derived from a set of runs has
the advantage that it will be less affected by the lack of identifying the
process noise explicitly.</p>
<p>Suggestions for improving the results.</p>
<ul class="simple">
<li>Fit to MISO models instead of MIMO for simplification.</li>
<li>Fix at least the <span class="math">\(a_{\phi\delta}\)</span> coefficient and make the noise
with respect to the kinematical equations equal to zero giving 11-13 total
parameters to fit.</li>
<li>Use model reduction techniques to combine many MISO and SISO models for a
given run.</li>
<li>Use better initial guess techniques and try global optimizers to get to the
best solution.</li>
</ul>
</div>
</div>
</div>
<div class="section" id="rider-controller-identification">
<h2>Rider Controller Identification<a class="headerlink" href="#rider-controller-identification" title="Permalink to this headline">¶</a></h2>
<p>Now that I have a reasonable estimate of the plant, the rider control system
can be identified. There are many control structures that exist that may
explain the data. If the feedback and input variables are the same for two
different control structures, they can be mapped to each other and are
essentially equivalent. Much of the difference in control structures such as
PID, sequential loop closure, LQR are the physical interpretations of the
gains, delays, and other parameters. Here, I limit the control structure to
the one developed in <a class="reference internal" href="zreferences.html#hess2012">[HMH12]</a> and Chapter <a class="reference internal" href="control.html#control"><em>Control</em></a>. With this
structure, I will have the ability to compare the results with the theoretical
hypothesis we developed.</p>
<div class="section" id="grey-box-models">
<h3>Grey Box Models<a class="headerlink" href="#grey-box-models" title="Permalink to this headline">¶</a></h3>
<p>The block diagram of the control structure described in Chapter <a class="reference internal" href="control.html#control"><em>Control</em></a>
is shown again in Figures <a class="reference internal" href="#figinnerloopsagain"><em>11.20</em></a> and
<a class="reference internal" href="#figouterloopsagain"><em>11.21</em></a>. The closed loop system can be written in
state space form, which will be used with a state space identification
procedure as defined in Section <a class="reference internal" href="#secstatespaceid"><em>State Space Realization</em></a>. I&#8217;ll develop forms for
pure heading tracking and lateral deviation tracking.</p>
<div class="figure align-center" id="figinnerloopsagain">
<a class="reference external image-reference" href="_images/inner-loops.png"><img alt="_images/inner-loops.png" src="_images/inner-loops.png" style="width: 5in;" /></a>
<p class="caption">The inner loop structure of the control system which feeds back steer angle
<span class="math">\(\delta\)</span>, roll rate <span class="math">\(\dot{\phi}\)</span>, and roll angle <span class="math">\(\phi\)</span>.</p>
</div>
<div class="figure align-center" id="figouterloopsagain">
<a class="reference external image-reference" href="_images/outer-loops.png"><img alt="_images/outer-loops.png" src="_images/outer-loops.png" style="width: 4in;" /></a>
<p class="caption">The outer loop structure of the control system with the inner loops closed
which feeds back the heading <span class="math">\(\psi\)</span> and the front wheel lateral
deviation <span class="math">\(y_q\)</span>.</p>
</div>
<p>The bicycle block for lateral deviation tracking has states <span class="math">\(x_b = \left[
\phi \quad \delta \quad \dot{\phi} \quad \dot{\delta} \quad \psi \quad y_p
\right]^T\)</span>, inputs <span class="math">\(u_b = \left[ T_\delta \quad F \right]^T\)</span>, and outputs
<span class="math">\(y_b = \left[ \delta \quad \phi \quad \dot{\phi} \quad \psi \quad y_q
\right]^T\)</span>. The state, input, and output matrices are follows</p>
<div class="math" id="equation-eqBicycleStateSpace">
<span class="eqno">(30)</span>\[\begin{split}\mathbf{A}_b
=
\begin{bmatrix}
  0 &amp; 0 &amp; 1 &amp; 0 &amp; 0 &amp; 0 \\
  0 &amp; 0 &amp; 0 &amp; 1 &amp; 0 &amp; 0 \\
  a_{b\ddot{\phi}\phi} &amp; a_{b\ddot{\phi}\delta} &amp;
  a_{b\ddot{\phi}\dot{\phi}} &amp; a_{b\ddot{\phi}\dot{\delta}} &amp;
  0 &amp; 0 \\
  a_{b\ddot{\delta}\phi} &amp; a_{b\ddot{\delta}\delta} &amp;
  a_{b\ddot{\delta}\dot{\phi}} &amp; a_{b\ddot{\delta}\dot{\delta}} &amp; 0 &amp; 0 \\
  0 &amp; a_{b\dot{\psi}\delta} &amp; 0 &amp; a_{b\dot{\psi}\dot{\delta}} &amp; 0 &amp; 0\\
  0 &amp; 0 &amp; 0 &amp; 0 &amp; a_{b\dot{y}_p\psi} &amp; 0
\end{bmatrix}\end{split}\]\[\begin{split}\mathbf{B}_b
=
\begin{bmatrix}
  B_{b T_\delta} &amp; B_{bF}
\end{bmatrix}
=
\begin{bmatrix}
  0 &amp; 0 \\
  0 &amp; 0 \\
  b_{b\ddot{\phi}T_\delta} &amp; b_{b\ddot{\phi}F} \\
  b_{b\ddot{\delta}T_\delta} &amp; b_{b\ddot{\delta}F} \\
  0 &amp; 0 \\
  0 &amp; 0
\end{bmatrix}\end{split}\]\[\begin{split}\mathbf{C}_b
=
\begin{bmatrix}
  0 &amp; 1 &amp; 0 &amp; 0 &amp; 0 &amp; 0 \\
  1 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 \\
  0 &amp; 0 &amp; 1 &amp; 0 &amp; 0 &amp; 0 \\
  0 &amp; 0 &amp; 0 &amp; 0 &amp; 1 &amp; 0 \\
  0 &amp; 1 &amp; 0 &amp; 0 &amp; c_{by_q\psi} &amp; c_{by_qy_p} \\
\end{bmatrix}\end{split}\]</div>
<p>The neuromuscular block is described by the transfer function</p>
<div class="math" id="equation-eqNeuromuscular">
<span class="eqno">(31)</span>\[G_{nm}(s) = \frac{\omega_{nm}^2}{s^2 + 2 \zeta_{nm} \omega_{nm}s + \omega_{nm}^2}\]</div>
<p>which can be written in state space form with the states <span class="math">\(x_{nm} = \left[
T_\delta \quad \dot{T}_\delta \right]^T\)</span>, input <span class="math">\(u_{nm} = U_{nm}\)</span> and
output <span class="math">\(y_{nm} = T_\delta\)</span>.</p>
<div class="math" id="equation-eqNeuroStateSpace">
<span class="eqno">(32)</span>\[\begin{split}\mathbf{A}_{nm}
=
\begin{bmatrix}
  0 &amp; 1 \\
  -\omega^2 &amp; - 2 \zeta \omega
\end{bmatrix}\end{split}\]\[\begin{split}B_{nm}
=
\begin{bmatrix}
  0 \\
  \omega^2
\end{bmatrix}\end{split}\]\[\begin{split}\mathbf{C}_{nm}
=
\begin{bmatrix}
  1 &amp; 0
\end{bmatrix}\end{split}\]</div>
<p>The combined plant (rider neuromuscular model and bicycle) has states
<span class="math">\(x_p = \left[ \phi \quad \delta \quad \dot{\phi} \quad \dot{\delta} \quad
\psi \quad y_p \quad T_\delta \quad \dot{T}_\delta \right]^T\)</span>, inputs
<span class="math">\(u_p = \left[ F \quad U_{nm} \right]^T\)</span>, and outputs <span class="math">\(y_p = \left[
\delta \quad \phi \quad \dot{\phi} \quad \psi \quad y_q \right]^T\)</span>. The state,
input, and output matrices of the plant are</p>
<div class="math" id="equation-eqPlantStateSpace">
<span class="eqno">(33)</span>\[\begin{split}\mathbf{A}_p
=
\begin{bmatrix}
  \mathbf{A}_b &amp; B_{bT_\delta} &amp; 0_{6 \times 1} \\
  \mathbf{0}_{2 \times 6} &amp; \mathbf{A}_{nm}
\end{bmatrix}\end{split}\]\[\begin{split}\mathbf{B}_p
=
\begin{bmatrix}
  B_{bF} &amp; 0_{6 \times 1} \\
  0_{2 \times 1} &amp; B_{nm}
\end{bmatrix}\end{split}\]\[\begin{split}\mathbf{C}_p
=
\begin{bmatrix}
  \mathbf{C}_b &amp; \mathbf{0}_{5 \times 2}
\end{bmatrix}\end{split}\]</div>
<p>The sequential loop closure rationale dictates that the commanded output variables are</p>
<div class="math">
\[\psi_c = k_{y_q} ({y_q}_c - y_q)\]\[\phi_c = k_{\psi} (\psi_c - \psi)\]\[\dot{\phi}_c = k_{\phi} (\phi_c - \phi)\]\[\delta_c = k_{\dot{\phi}} (\dot{\phi}_c - \dot{\phi})\]</div>
<p>and the input to the neuromuscular block as a function of the desired path
is</p>
<div class="math">
\[U_{nm} = k_{\delta} (\delta_c - \delta)\]</div>
<p>The input to the neuromuscular block can be written in linear form as</p>
<div class="math">
\[\begin{split}U_{nm}
=
\begin{bmatrix}
  -k_{\delta} k_{\phi} k_{\dot{\phi}} k_{\psi} \\
  -k_{\delta} k_{\phi} k_{\dot{\phi}} \\
  -k_{\delta} \\
  -k_{\delta} k_{\dot{\phi}} \\
  -k_{\delta} k_{\phi} k_{\dot{\phi}} k_{\psi} k_{y_q} \\
  k_{\delta} k_{\phi} k_{\dot{\phi}} k_{\psi} k_{y_q}
\end{bmatrix}^T
\begin{bmatrix}
   \psi \\
   \phi \\
   \delta \\
   \dot{\phi} \\
   y_q \\
   y_c \\
\end{bmatrix}\end{split}\]</div>
<p>The closed loop state space for lateral deviation tracking can be formed by
inserting the controller output <span class="math">\(U_{nm}\)</span> into the plant dynamics
<span class="math">\((\mathbf{A}_p,\mathbf{B}_p)\)</span> to rearrange the plant state space to be a
function of the desired path and the lateral force, <span class="math">\(u_l = \left[ F \quad
y_{qc} \right]^T\)</span>. The closed loop system <span class="math">\((\mathbf{A}_p,\mathbf{B}_p)\)</span>
takes the same form as the plant system with the exception of the steer torque
acceleration equation, which is now a function of the controller gains, the
neuromuscular parameters, and the desired path of the front wheel contact point.
The new entries to the system matrices are</p>
<div class="math" id="equation-eqLateralStateSpace">
<span class="eqno">(34)</span>\[x_l = \left[ \phi \quad \delta \quad \dot{\phi} \quad \dot{\delta} \quad
\psi \quad y_p \quad T_\delta \quad \dot{T}_\delta \right]^T\]\[u_l = \left[ F \quad y_{qc} \right]^T\]\[\begin{split}\mathbf{A}_l
=
\left[
\begin{smallmatrix}
  0 &amp; 0 &amp; 1 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0\\
  0 &amp; 0 &amp; 0 &amp; 1 &amp; 0 &amp; 0 &amp; 0 &amp; 0\\
  a_{b\ddot{\phi}\phi} &amp;
  a_{b\ddot{\phi}\delta} &amp;
  a_{b\ddot{\phi}\dot{\phi}} &amp;
  a_{b\ddot{\phi}\dot{\delta}} &amp;
  0 &amp; 0 &amp; 0 &amp; 0\\
  a_{b\ddot{\delta}\phi} &amp;
  a_{b\ddot{\delta}\delta} &amp;
  a_{b\ddot{\delta}\dot{\phi}} &amp;
  a_{b\ddot{\delta}\dot{\delta}} &amp;
  0 &amp; 0 &amp; 0 &amp; 0\\
  0 &amp; a_{b\dot{\psi}\delta} &amp; 0 &amp; a_{b\dot{\psi}\dot{\delta}} &amp; 0 &amp; 0 &amp; 0 &amp; 0\\
  0 &amp; 0 &amp; 0 &amp; 0 &amp; a_{b\dot{y}_p\psi} &amp; 0 &amp; 0 &amp; 0 \\
  0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 1 \\
  -\omega^2 k_{\delta} k_{\dot{\phi}} k_{\phi} &amp;
  -\omega^2 k_{\delta} (1 + c_{b y_q \delta} k_{\dot{\phi}} k_{\phi} k_{\psi} k_{y_q}) &amp;
  -\omega^2 k_{\delta} k_{\dot{\phi}} &amp;
  0 &amp;
  -\omega^2 k_{\delta} k_{\dot{\phi}} k_{\phi} k_{\psi} (1 + c_{b y_q \psi} k_{y_q}) &amp;
  -\omega^2 k_{\delta} k_{\dot{\phi}} k_{\phi} k_{\psi} k_{y_q} &amp;
  -\omega^2 &amp;
  -2 \omega \zeta
\end{smallmatrix}
\right]\end{split}\]\[\begin{split}\mathbf{B}_l
=
\begin{bmatrix}
  0 &amp; 0 \\
  0 &amp; 0 \\
  b_{b\ddot{\phi}F} &amp; 0 \\
  b_{b\ddot{\delta}F} &amp; 0 \\
  0 &amp; 0 \\
  0 &amp; 0 \\
  0 &amp; \omega^2 k_{\delta} k_{\dot{\phi}} k_{\phi} k_{\psi} k_{y_q}
\end{bmatrix}\end{split}\]</div>
<p>The output matrix, <span class="math">\(\mathbf{C}_l\)</span>, can be constructed to provide any
desired outputs, which I choose to be a subset of the outputs we measured
during the experiments such as steer angle, roll rate, steer torque, etc.</p>
<p>Given that the bicycle model, <span class="math">\((\mathbf{A}_b,\mathbf{B}_b,\mathbf{C}_b)\)</span>,
is known, the closed loop analytical state space representation is parameterized
by seven parameters: the five controller gains and the two neuromuscular
parameters. The model is eighth order with two inputs.</p>
<p>Notice that the controller is unlike a state or output feedback model in the
sense that the gains only appear in a single row in the A and B matrices. This
reflects some of the inherent limitations the human system has for sensing and
actuation. Output feedback systems often require an observer so that full
estimated state feedback can be used. This model assumes that the rider does
not have that ability. They are only able to sense noisy outputs and adjust
their torque compensation within the bandwidth limits of the neuromuscular
system based on five simple gains.</p>
<p>I also make use of a second closed loop model which is essentially the same,
but the outer lateral deviation tracking loop is removed and tracking a
commanded heading remains. This model is seventh order with two inputs.</p>
<div class="math" id="equation-eqHeadingStateSpace">
<span class="eqno">(35)</span>\[x_h = \left[ \phi \quad \delta \quad \dot{\phi} \quad \dot{\delta} \quad
\psi \quad T_\delta \quad \dot{T}_\delta \right]^T\]\[u_h = \left[ F \quad \psi_c \right]^T\]\[\begin{split}\mathbf{A}_h
=
\begin{bmatrix}
  0 &amp; 0 &amp; 1 &amp; 0 &amp; 0 &amp; 0 &amp; 0 \\
  0 &amp; 0 &amp; 0 &amp; 1 &amp; 0 &amp; 0 &amp; 0 \\
  a_{b\ddot{\phi}\phi} &amp; a_{b\ddot{\phi}\delta} &amp;
  a_{b\ddot{\phi}\dot{\phi}} &amp; a_{b\ddot{\phi}\dot{\delta}} &amp;
  0 &amp; 0 &amp; 0 \\
  a_{b\ddot{\delta}\phi} &amp; a_{b\ddot{\delta}\delta} &amp;
  a_{b\ddot{\delta}\dot{\phi}} &amp; a_{b\ddot{\delta}\dot{\delta}} &amp; 0 &amp; 0 &amp; 0 \\
  0 &amp; a_{b\dot{\psi}\delta} &amp; 0 &amp; a_{b\dot{\psi}\dot{\delta}} &amp; 0 &amp; 0 &amp; 0 \\
  0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 1 \\
  -\omega^2 k_{\delta} k_{\dot{\phi}} k_{\phi} &amp;
  -\omega^2 k_{\delta} &amp;
  -\omega^2 k_{\delta} k_{\dot{\phi}} &amp;
  0 &amp;
  -\omega^2  k_{\delta} k_{\phi} k_{\dot{\phi}} k_{{\psi}} &amp;
  -\omega^2 &amp;
  -2 \omega \zeta
\end{bmatrix}\end{split}\]\[\begin{split}\mathbf{B}_h
=
\begin{bmatrix}
  0 &amp; 0 \\
  0 &amp; 0 \\
  b_{b\ddot{\phi}F} &amp; 0 \\
  b_{b\ddot{\delta}F} &amp; 0 \\
  0 &amp; 0 \\
  0 &amp; 0 \\
  0 &amp; \omega^2 k_{\delta} k_{\phi} k_{\dot{\phi}} k_{\psi}
\end{bmatrix}\end{split}\]</div>
<p>The numerical values from the model derived from Luke&#8217;s runs in the pavilion
were used to populate the bicycle state space entries,
<span class="math">\((\mathbf{A}_b,\mathbf{B}_b),\mathbf{C}_b)\)</span>, except for the entries in
the heading and lateral deviation acceleration equations which were calculated
with the Whipple model. This has the consequence that those entries are
developed with potentially erroneous geometric values such as trail.</p>
</div>
<div class="section" id="id78">
<h3>Data<a class="headerlink" href="#id78" title="Permalink to this headline">¶</a></h3>
<p>Only the runs with lateral disturbances are suitable for identifying the rider
controller. I used the subset of 262 valid disturbance runs for the following
analysis. This subset included runs from all three riders, both environments,
and both the lateral deviation and heading tracking maneuvers. All signals had
their means subtracted except for the lateral force.</p>
</div>
<div class="section" id="id79">
<h3>Identification<a class="headerlink" href="#id79" title="Permalink to this headline">¶</a></h3>
<p>In the following analyses the Kalman gain matrix is assumed to be equal to
zero and the model takes on an output error form. This was required to bring
the number of parameters to a reasonable size and provide a chance at finding
the optimal solution.</p>
<p>Through trial and error with many different approaches to identification, I
found that finding the optimal solution was not a trivial problem. The SIMO
problem with full noise estimation has a minimum of 15 parameters. This problem
is fraught with local minima. Even the assumption of an output error structure
and the reduction of the parameter space to seven, doesn&#8217;t escape the
difficulty of finding the true minimum. To have a decent chance at finding a
good solution, I opted to identify only the SISO system with the lateral force
as the input and the steering angle as the output. The choice of steer angle as
the sole output is for much the same reason as in <a class="reference internal" href="zreferences.html#lange2011">[DL11]</a>, i.e. the
steer angle is a very good quality measurement and together with steer torque
reflects the rider&#8217;s contribution to the system dynamics as a reaction to the
lateral force.</p>
<p>I used the prediction error method <a class="reference internal" href="zreferences.html#ljung1998">[Lju98]</a> to find the optimal
parameters for each run. A good solution required good initial parameter
guesses for which I used a combination of stable starting guesses from the loop
closure technique described in Chapter <a class="reference internal" href="control.html#control"><em>Control</em></a> and recursively used
random guesses from previous good and bad solutions as starting points,
eventually homing in on the optimal solutions.</p>
<p>The criterion for a good model was based on the variance accounted for in the
measurement output. The mean VAF for all the identified runs is <span class="math">\(62 \pm
12\)</span> percent, and considering the large relative human remnant, fits above 30%
are still relatively good. I ensured stability in the identified models and
no issues associated with unstable simulations corrupting the model quality
criteria were present.</p>
<p>It turned out that the identified parameters for the SISO model not only
predicted the steer angle, but when extra outputs are added it predicts them
well too. The resulting parameters from the SISO model can then be used as
initial guesses for the SIMO formulation to check multiple outputs. The
identification process followed these steps:</p>
<ol class="arabic simple">
<li>Process, filter and detrend the data.</li>
<li>Construct the SISO (Input: <span class="math">\(F\)</span>, Output: <span class="math">\(\delta\)</span>) grey box state space model.</li>
<li>Identify the five gains and the neuromuscular frequency for the lateral
force and steer angle data using a variety of initial parameter guesses.</li>
<li>Construct the SIMO grey box state space model.</li>
<li>Identify the six parameters as before using the result of the SISO
identification as the initial parameter guess for the SIMO system.</li>
</ol>
<p>The results in Figures <a class="reference internal" href="#figrideridtreadmill"><em>11.22</em></a> and
<a class="reference internal" href="#figrideridpavilion"><em>11.23</em></a> give typical examples of the model&#8217;s ability
to predict the measured data in two different runs, one on the treadmill and
one on the gymnasium floor, respectively. Notice that the human&#8217;s remnant is
relatively large when the input is zero, especially in the treadmill run. The
model is able to predict the human&#8217;s initial control response to the external
input and lumps the remnant into the output error. This response is very
repeatable across riders and runs. The model considers the remnant as output
error during the non perturbed portions of the run. Notice that the steer
torque is well predicted around the perturbation. Previous identifications with
the Whipple model predicted much lower torque magnitudes and much different
parameters. Including the identified bicycle model from Section
<a class="reference internal" href="#seccanonicalid"><em>Canonical Identification</em></a> proved to give much better control predictions.</p>
<div class="figure align-center" id="figrideridtreadmill">
<a class="reference external image-reference" href="_images/rider-id-treadmill-run.png"><img alt="_images/rider-id-treadmill-run.png" src="_images/rider-id-treadmill-run.png" style="width: 6in;" /></a>
<p class="caption">Simulation of an identified model derived from the inputs and outputs (SIMO)
of one of Charlie&#8217;s treadmill runs #288 (4.23 m/s) validated against the
data from run #289 (4.22 m/s). The black line is the processed and filtered
(low pass 15 Hz) measured data, the blue line is the simulation from the
identified SIMO model and the green line is the identified SISO model.
Generated by <cite>src/systemidentification/rider_id_model_quality_plot.py</cite>.</p>
</div>
<div class="figure align-center" id="figrideridpavilion">
<a class="reference external image-reference" href="_images/rider-id-pavilion-run.png"><img alt="_images/rider-id-pavilion-run.png" src="_images/rider-id-pavilion-run.png" style="width: 6in;" /></a>
<p class="caption">Simulation of an identified model derived from the inputs and outputs (SIMO)
of one of Luke&#8217;s pavilion runs #657 (3.99 m/s) validated against the data
from run #658 (3.74 m/s). The black line is the processed and filtered (low
pass 15 Hz) measured data, the blue line is the simulation from the
identified SIMO model, and the green line is the identified SISO model.
Generated by <cite>src/systemidentification/rider_id_model_quality_plot.py</cite>.</p>
</div>
</div>
<div class="section" id="id82">
<h3>Results<a class="headerlink" href="#id82" title="Permalink to this headline">¶</a></h3>
<p>I computed the optimal five gains and neuromuscular frequency<a class="footnote-reference" href="#neurodamp" id="id83">[6]</a> for
all 262 runs and recorded the VAF of the steer angle output explained by the
model for each run along with the identified parameters.</p>
<p>The first set of quantities of interest are the identified parameters
themselves. As I&#8217;ve already mentioned in the previous section, identifying the
parameters accurately is a function of the number of free parameters, which
parameters are free, and the quality of the noise model. In my case, our noise
model is an output error structure and may contribute to much more spread in
the identified parameters. <a class="reference internal" href="#figcontrolparvsspeed"><em>Figure 11.24</em></a> gives an
idea of how the six identified parameters vary with speed. As shown in Chapter
<a class="reference internal" href="control.html#control"><em>Control</em></a> the theory predicts that the gains are mostly linear above about
2 m/s and that the neuromuscular frequency is a constant parameter with respect
to the human operator.</p>
<div class="figure align-center" id="figcontrolparvsspeed">
<a class="reference external image-reference" href="_images/par-vs-speed-box-all.png"><img alt="_images/par-vs-speed-box-all.png" src="_images/par-vs-speed-box-all.png" style="width: 6in;" /></a>
<p class="caption">Each of the five identified parameters as a function of speed. The parameter
values are grouped into 0.5 m/s speed bins and box plots showing their
distributions are given for each speed bin. The red line gives the median of
the speed bin, the box bounds the quartiles, and the whisker is 1.5 times
the inner quartile range. The width of the boxes are proportional to the
square root of the number of runs in the bin. The green line gives the
linear fit to the median values which are weighted with respect to the
inverse of the standard deviation of each speed bin. The neuromuscular
frequency is the best constant that fits the data. Generated by
<cite>src/systemidentification/control_parameters_vs_speed_plots.py</cite>.</p>
</div>
<p><a class="reference internal" href="#figcontrolparvsspeed"><em>Figure 11.24</em></a> gives these insights:</p>
<ul class="simple">
<li>The gains increase with speed with <span class="math">\(k_{\phi}\)</span> and <span class="math">\(k_{y_q}\)</span> having
small slopes.</li>
<li>The low speed runs have much more spread. This is probably due to the fact
that the human remnant is relatively large at these speeds and the model
attempts to fit the noise rather than casting it as output error.</li>
<li>The ~9 m/s runs have poorer data quality than other runs due to the treadmill
interference in the measurement electronics, thus the spread is large.</li>
<li>The neuromuscular frequency stays relatively constant just below 30 rad/s,
barring the higher variability in the low speed runs.</li>
<li>The gains may be reasonably characterized with simple linear relationships.</li>
</ul>
<div class="section" id="loop-shaping">
<h4>Loop Shaping<a class="headerlink" href="#loop-shaping" title="Permalink to this headline">¶</a></h4>
<p>The values of the parameters are difficult to directly compare with the ones
found by the loop shaping technique described in Chapter <a class="reference internal" href="control.html#control"><em>Control</em></a> due to
some of the educated guesses about the rider&#8217;s internal control choices. But it
is possible to evaluate the same loops&#8217; frequency responses in an effort to
understand how the rider chooses the gains.</p>
<p><a class="reference internal" href="#figalldeltadeltac"><em>Figure 11.25</em></a> shows the frequency response of the
closed inner-most loop for a particular speed bin. The theory presented in
<a class="reference internal" href="zreferences.html#hess2012">[HMH12]</a> and Chapter <a class="reference internal" href="control.html#control"><em>Control</em></a> postulates that the rider chooses a
gain such that the damping ratio of the high frequency neuromuscular peak
around 10 rad/s and about gives a 10 dB peak (<span class="math">\(\zeta=0.15\)</span>). <a class="reference internal" href="#figalldeltadeltac"><em>Figure
11.25</em></a> shows that there may be a more heavily damped
neuromuscular peak, but the large variability in the lower frequencies
indicates that the rider&#8217;s choice is not so constant. This may be explained by
the fact that it is more critical for the roll rate loop to exhibit the
neuromuscular peaking and the differences in the three rider&#8217;s behavior. I&#8217;ve
previously shown in Chapter <a class="reference internal" href="control.html#control"><em>Control</em></a> that there are not necessarily
unique gains in the first two loops to achieve the correct peaking in the roll
rate loop.</p>
<div class="figure align-center" id="figalldeltadeltac">
<a class="reference external image-reference" href="_images/all-delta_deltac-4.png"><img alt="_images/all-delta_deltac-4.png" src="_images/all-delta_deltac-4.png" style="width: 4in;" /></a>
<p class="caption">Frequency responses of the closed steer angle loop around 4 m/s. The grey
lines plot the response of each individual run in the speed bin while the
solid black lines give the mean gain and phase bounded by the dotted black
lines which indicate one standard deviation.</p>
</div>
<p><a class="reference internal" href="#figallphidotphidotc"><em>Figure 11.26</em></a> shows the frequency response of the
closed roll rate loop <span class="math">\(\frac{\dot{\phi}}{\dot{\phi}_c}(s)\)</span>. As was just
pointed out, the theory is that this loop, which completes the inner control
loop, must exhibit this typical neuromuscular peaking seen in human-machine
control tasks. The mean magnitude plots indicates that this is the case and
that the riders do choose their steer and roll rate gains such that the inner
loops exhibit the typical response.</p>
<div class="figure align-center" id="figallphidotphidotc">
<a class="reference external image-reference" href="_images/all-phiDot_phiDotc-4.png"><img alt="_images/all-phiDot_phiDotc-4.png" src="_images/all-phiDot_phiDotc-4.png" style="width: 4in;" /></a>
<p class="caption">Frequency responses of the closed roll rate loop around 4 m/s. The grey
lines plot the response of each individual run in the speed bin while the
solid black line give the mean gain and phase bounded by the dotted black
lines which indicate the one sigma standard deviation.</p>
</div>
<p>Our theory for the selection of the remaining three gains suggests that the
loops follow the dictates of the crossover model (i.e. 20 db slope around
crossover) and that the crossover frequencies start at 2 and each successive
loop is closed at half the previous crossover frequency such that the roll
angle, heading and lateral deviation loops are closed in that order. Figures
<a class="reference internal" href="#figallphiephi"><em>11.27</em></a>, <a class="reference internal" href="#figallpsiepsi"><em>11.28</em></a>, and
<a class="reference internal" href="#figallyqeyq"><em>11.29</em></a> show the empirically derived frequency responses for
the remaining loops.</p>
<div class="figure align-center" id="figallphiephi">
<a class="reference external image-reference" href="_images/all-phi_ePhi-4.png"><img alt="_images/all-phi_ePhi-4.png" src="_images/all-phi_ePhi-4.png" style="width: 4in;" /></a>
<p class="caption">Frequency responses of the open roll angle loop around 4 m/s. The grey lines
plot the response of each individual run in the speed bin while the solid
blacks line give the mean gain and phase bounded by the dotted black lines
which indicate one standard deviation.</p>
</div>
<div class="figure align-center" id="figallpsiepsi">
<a class="reference external image-reference" href="_images/all-psi_ePsi-4.png"><img alt="_images/all-psi_ePsi-4.png" src="_images/all-psi_ePsi-4.png" style="width: 4in;" /></a>
<p class="caption">Frequency responses of the open heading loop around 4 m/s. The grey lines
plot the response of each individual run in the speed bin while the solid
blacks line give the mean gain and phase bounded by the dotted black lines
which indicate one standard deviation.</p>
</div>
<div class="figure align-center" id="figallyqeyq">
<a class="reference external image-reference" href="_images/all-yQ_eyQ-4.png"><img alt="_images/all-yQ_eyQ-4.png" src="_images/all-yQ_eyQ-4.png" style="width: 4in;" /></a>
<p class="caption">Frequency responses of the open lateral deviation loop around 4 m/s. The
grey lines plot the response of each individual run in the speed bin while
the solid black lines give the mean gain and phase bounded by the dotted
black lines which indicate one standard deviation.</p>
</div>
<p>The median crossover frequencies for this 4 m/s speed bin are
<span class="math">\(\omega_{\phi c}=3.66\)</span>, <span class="math">\(\omega_{\psi c}= 0.98\)</span>, and
<span class="math">\(\omega_{y_q c}=1.06\)</span>. This indicates that the rider is more aggressive
than our theory predicts with the higher roll crossover frequency in the roll
angle loop. Also, the riders do not crossover at half the previous frequency,
with the two outer loops crossing over at about the same frequency indicating
that the lateral deviation tracking is more pertinent to the rider than the
theory suggests. This may be partially due to the narrowness of the treadmill
which constitutes 80% of the data.</p>
<p>Our hypothesis is that the crossover frequencies are constant with respect to
speed, so the distribution of the crossover frequencies for all runs should
have a tight distribution regardless of speed. Secondly, we postulated that the
rider crosses over the roll angle loop around 2 rad/s. <a class="reference internal" href="#figcrossover"><em>Figure
11.30</em></a> shows the distribution of the crossover frequencies for
each loop where the median values of the crossover frequencies are
<span class="math">\(w_{\phi c}=3.31\)</span>, <span class="math">\(w_{\psi c}= 1.20\)</span>, and <span class="math">\(w_{y_q c}=0.98\)</span>,
all with somewhat large standard deviations.</p>
<div class="figure align-center" id="figcrossover">
<a class="reference external image-reference" href="_images/crossover-all.png"><img alt="_images/crossover-all.png" src="_images/crossover-all.png" style="width: 3in;" /></a>
<p class="caption">Median crossover frequencies in rad/s for the open outer loops for all runs
at all speeds.</p>
</div>
<p>If the medians are any indication of the true crossover frequency the rider is
more aggressive than predicted and the two outer loop crossover frequencies are
much closer in value than predicted. The one-half rule of thumb does seem to
hold for the inner two loops.</p>
</div>
<div class="section" id="full-system-response">
<h4>Full System Response<a class="headerlink" href="#full-system-response" title="Permalink to this headline">¶</a></h4>
<p>Once the loops are all closed the system output response to the two inputs
<span class="math">\(F_B\)</span> and <span class="math">\(y_{qc}\)</span> can be examined. Given a commanded input
<span class="math">\(y_{qc}\)</span>, the tracking performance can be gauged by the closed loop Bode
plot <span class="math">\(\frac{y_q}{y_{qc}}(s)\)</span> given in <a class="reference internal" href="#figallyqyqc"><em>Figure 11.31</em></a>.
Notice that in general, the response is well behaved with a 0 dB magnitude out
to about 10 rad/s, all poles are stable and the phase lag increases gradually
with frequency.</p>
<div class="figure align-center" id="figallyqyqc">
<a class="reference external image-reference" href="_images/all-yQ_yQc-4.png"><img alt="_images/all-yQ_yQc-4.png" src="_images/all-yQ_yQc-4.png" style="width: 4in;" /></a>
<p class="caption">Frequency responses of the closed loop system lateral deviation tracking
response around 4 m/s. The grey lines plot the response of each individual
run in the speed bin while the solid black lines give the mean gain and
phase bounded by the dotted black lines which indicate one standard
deviation.</p>
</div>
<p>Similarly, the system&#8217;s response to the lateral disturbance force <a class="reference internal" href="#figallyqfb"><em>Figure
11.32</em></a> is favorable for all the identified models and shows good
disturbance rejection.</p>
<div class="figure align-center" id="figallyqfb">
<a class="reference external image-reference" href="_images/all-yQ_fB-4.png"><img alt="_images/all-yQ_fB-4.png" src="_images/all-yQ_fB-4.png" style="width: 4in;" /></a>
<p class="caption">Frequency responses of the closed loop system disturbance rejection response
around 4 m/s. The grey lines plot the response of each individual run in the
speed bin while the solid black lines give the mean gain and phase bounded
by the dotted black lines which indicate one standard deviation.</p>
</div>
<p>The reader may note that some of the Bode plots among Figures
<a class="reference internal" href="#figalldeltadeltac"><em>11.25</em></a>-<a class="reference internal" href="#figallyqeyq"><em>11.29</em></a> indicate instability
in that amplitude and phase characteristics synonymous with quadratic poles
with small, positive damping ratios are in evidence. For example, one can see
the evidence of such poles around 1-2 rad/s in <a class="reference internal" href="#figalldeltadeltac"><em>Figure
11.25</em></a> and 10 rad/s in <a class="reference internal" href="#figallphidotphidotc"><em>Figure
11.26</em></a>. It should be emphasized that these Bode plots
represent either (1) open-loop transfer functions, or (2) inner, closed loop
transfer functions. Hence, they do not imply final, outer closed loop
instabilities. Indeed, the Bode plots of the outer-most, closed loop transfer
function of <a class="reference internal" href="#figallyqyqc"><em>Figure 11.31</em></a> (lateral deviation) do not
indicate any such quadratic poles with small positive damping ratios. The gain
selection procedure in Chapter <a class="reference internal" href="control.html#control"><em>Control</em></a> attempted to insure stability at
least by closing of the roll angle loop, but these plots show that may not
always be required for adequate performance for the complete system.</p>
</div>
</div>
<div class="section" id="id85">
<h3>Conclusion<a class="headerlink" href="#id85" title="Permalink to this headline">¶</a></h3>
<p>I have shown that a simple rider controller can be identified from the
collected data given that the plant model of the bicycle/rider system is
properly chosen, in my case identified separately from the same data. In
addition these basic conclusion arise:</p>
<ul class="simple">
<li>The fundamental, remnant-free, control response of the rider under lateral
perturbations can be described reasonably well by the simple five gain
sequential loop closure and an eighth order closed loop system. No time
delays are needed and the continuous formulation is adequate for good
prediction.</li>
<li>The identified gains seem to exhibit linear trends with respect to speed as
predicted by theory and the identified neuromuscular frequency seems to be
constant with a median around the theoretical prediction of 30 rad/s.</li>
<li>The identified parameters show resemblance to the patterns in the theoretical
loop closure techniques, especially in that the rider selects their gains
such that the closed roll rate loop exhibits a 10 dB peak around 10-11 rad/s
and that the riders cross over the outer three loops in the predicted order.</li>
<li>The crossover frequencies of the three outer loops are relatively constant
with respect to speed and point to a speed independence of system response
bandwidth selection among riders in this task.</li>
<li>The parameters do not seem to be uniquely identified if the neuromuscular
damping ratio is included as a free parameter.</li>
</ul>
<p>All of these conclusions are based on a preliminary statistical view of the
data. I believe the spread in the results can be tightened up significantly
with further data processing and the use of both simple and more complex
statistical methods. In my view, the data set still has a lot more tell with
further analysis but it has also revealed the need for further simplified
experiments. The following are some thoughts on improving the analysis:</p>
<dl class="docutils">
<dt>Improving the bicycle model.</dt>
<dd>To have any hope of identifying a realistic and accurate controller, the
plant must have a very good representative model. The bicycle is an
excellent platform for testing the human&#8217;s control system due to it&#8217;s low
speed instability and the fact that non-trivial control is needed to
stabilize and direct the non-minimum phase system, but the first principles
models for bicycle/rider biomechanics are not yet adequate or descriptive
enough to describe the plant. This is mostly due to poor understanding of
the tire to ground interaction and the rider&#8217;s complicated coupling to the
bicycle frames in which the rider is free to use more than one actuation
for control. But, as has been shown here, system identification can be used
to develop a realistic plant model for specific bicycles and even small
variations in riders. A data driven model is currently the best choice until
the first principles models are able to catch up and may, in fact, be able
to provide more robust models due to the inherent complexity of describing
all of the system with first principles.</dd>
<dt>Estimating the process noise matrix.</dt>
<dd>The better one can estimate the process noise in the system, the more
accurate the parameter predictions will get. In all of my attempts I had
little success in ever estimating the optimal model when some or all of the
process noise parameters were free. For the controller portion, the process
noise is not awfully different in magnitudes than the rider&#8217;s control
actions with respect to the disturbance and it is very apparent in the low
speed runs. This type of noise is much more difficult to properly account
for. The parameter estimates from the output error structures used in this
study are susceptible to the model fitting the noise and the control actions
as opposed to just the control actions. The identifications fortunately were
able to fit the control actions and not the noise and this is much more
apparent and true in the treadmill runs. It may be possible to develop
estimates of the process and measurement noise covariance matrices from the
undisturbed runs where the human&#8217;s remnant is the dominant source of
variability in the outputs.</dd>
<dt>Fixing the neuromuscular model.</dt>
<dd>The results give some indication that the neuromuscular model is an
appropriate choice. The gain identification could possibly be improved by
fixing both the neuromuscular frequency and damping ratio, and only
estimating the gains. In general, the more parameters you can be confident
about via first principles, the more the identified parameters may
be able to tell you about the system with higher certainty.</dd>
<dt>Removing outliers.</dt>
<dd>A more systematic approach to the removal of outlier data using criteria
from the resulting fit variance, parameters, and frequency responses would
help tighten up the data. The outliers are quite apparent in the data I&#8217;ve
shown and a detailed look at why they are outliers may allow many of them to
be removed.</dd>
<dt>Mixed effects modeling.</dt>
<dd>There are statistical methods available that can account for all of the
factors and repeated experiments. One such method is mixed effects or
multilevel modeling. I explored the use of these in a preliminary fashion
but need more time to understand the methods so that I apply them correctly.
This would provide models based on the many factors in the experiments and
give stronger comparisons with respect to them, such as variations among
riders and environments.</dd>
<dt>First Principles Checks</dt>
<dd>There are potentially some simpler checks that can be run with respect to
the first principles models. For example, the Whipple equations of motion
can be formulated with no nonholonomic lateral and longitudinal wheel
constraints leaving only unknown tire forces. The data I&#8217;ve collected, in
particular the lateral accelerations and roll, yaw, steer angles and rates,
can be used to calculate the in-ground-plane forces at the tire contact
points. If these forces aren&#8217;t the same as the nonholonomic constraints
predict, then tire slip must be occurring. This validation and others can be
performed with the data set I&#8217;ve collected, potentially answering some
important questions.</dd>
</dl>
<p>If I had unlimited time, I would work on these ideas more thoroughly. I hope to
be able to explore the data in more detail with better methodologies and ideas
in the future, but that may or may not happen. Fortunately the data is
available if others would like to try out different methods, plant models,
bicycle models, etc. and my methods, software, and methodologies are hopefully
detailed enough for reuse.</p>
<p class="rubric">Footnotes</p>
<table class="docutils footnote" frame="void" id="firstprinciples" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id3">[1]</a></td><td>First principles here means any modeling techniques that
use fundamental &#8220;known&#8221; building blocks to create a dynamic model. These
buildling blocks can include items such as Newton&#8217;s laws of motion, the laws
of thermodynamics, friction and contact models, electrical components, etc.</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="overdamped" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id43">[2]</a></td><td>This overdamped low bandwidth neuromuscular model is very
different than what we assumed and ultimately identified.</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="pavilionfloor" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id50">[3]</a></td><td>The floor is a product called &#8220;pulastic&#8221; which is
manufactured by <a class="reference external" href="http://www.robbinsfloor.com">Robbins Sport Surfaces</a>.</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="mixedeffects" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id69">[4]</a></td><td>I spent some time trying to regress models to each of the
speed dependent coefficients in the state space model by assuming either a
constant, linear, or quadratic line. I tried simple regression techniques
and also some mixed effects techniques to obviate the fact that some of the
speed bins had many more runs than others. This method may be used to
generate a speed independent model based on all of the runs, but needs more
work.</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="symmetry" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id73">[5]</a></td><td>It is also possible to solve the roll and steer equations
simultaneously and enforce the symmetry, which is probably a better idea.</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="neurodamp" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id83">[6]</a></td><td>The nueromuscaulr damping ratio was fixed to 0.707 as per
<a class="reference internal" href="zreferences.html#magdaleno1971">[MM71]</a>. The uniqueness of the identifiablity of the parameters is
questionable if this is not fixed, as wildly different solutions for the
neuromuscular frequency were often found if the damping ratio was left free.</td></tr>
</tbody>
</table>
</div>
</div>
</div>


<!--
<script type="text/javascript">
	var disqus_developer = 1;
</script>
-->
<h2>Comments</h2>
<div id="disqus_thread"></div>
<script type="text/javascript">
  /**
    * var disqus_identifier; [Optional but recommended: Define a unique identifier (e.g. post id or slug) for this thread]
    */
  (function() {
   var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
   dsq.src = 'http://jkm-dissertation.disqus.com/embed.js';
   (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>
<noscript>Please enable JavaScript to view the <a
		href="http://disqus.com/?ref_noscript=jkm-dissertation">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">blog comments powered by <span class="logo-disqus">Disqus</span></a>


      </div>
      <div class="bottomnav">
      
        <p>
        «&#160;&#160;<a href="control.html">Control</a>
        &#160;&#160;::&#160;&#160;
        <a class="uplink" href="index.html">Contents</a>
        &#160;&#160;::&#160;&#160;
        <a href="zreferences.html">References</a>&#160;&#160;»
        </p>

      </div>


    <div class="footer">
        &copy; Copyright 2012, Jason K. Moore.
      Last updated on Jan 19, 2013.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.
    </div>
<script type="text/javascript">
var disqus_shortname = 'jkm-dissertation';
(function () {
  var s = document.createElement('script'); s.async = true;
  s.src = 'http://disqus.com/forums/jkm-dissertation/count.js';
  (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
}());
</script>

<div align="center">
<a rel="license" href="http://creativecommons.org/licenses/by/3.0/">
	<img
	alt="Creative Commons License" style="border-width:0"
	src="http://i.creativecommons.org/l/by/3.0/88x31.png" />
</a>
<br />
This work is licensed under a <a rel="license"
href="http://creativecommons.org/licenses/by/3.0/">Creative Commons
Attribution 3.0 Unported License</a>
</div>


  </body>
</html>